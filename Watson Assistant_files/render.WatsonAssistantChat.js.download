/*!
 * 
 * (C) Copyright IBM Corp. 2017 - 2020. All Rights Reserved.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 * 
 * watson-web-channel 3.2.0
 * Contributors: Ethan Winters, Raymond Chu, Karen Harris, Ashley Lord, Amy Zhong, Ryan Simpson, Anthony Wong, Wilson Wong, David G Terry, Simon Burns, Damon Lundin, John Engstrom, Neil Mallinar
 * Built: Oct 27 2020 1:20 pm +00:00
 * 
 * 
 */
(window.webpackJsonpWatsonAssistantChat=window.webpackJsonpWatsonAssistantChat||[]).push([[67],{596:function(e,t,n){"use strict";n.r(t);var a=n(87),r=n.n(a),o=n(369),s=n.n(o),i=n(358),c=n(372),l=n.n(c),u=n(11),p=n.n(u),d=n(12),m=n.n(d),g=n(1),_=n.n(g),h=n(340),f=n.n(h),C=n(341),v=n.n(C),A=(n(467),n(342)),E=n.n(A),b=n(349),y=n(38),S=r.a.createContext(null),W=r.a.createContext(null);function N(){return Object(a.useContext)(W)}var w,O=n(421),P=n.n(O),T=n(51),R=n.n(T),M=n(23),I=n.n(M),k=n(53),B=n(371),D=(w=function(e,t){return(w=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}w(e,t),e.prototype=null===t?f()(t):(n.prototype=t.prototype,new n)}),L=new l.a(["button","date","datetime-local","email","file","month","number","range","reset","search","submit","tel","text","time","url","week"]),H=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ref1=r.a.createRef(),t.ref2=r.a.createRef(),t.useRef1=!0,t.doAnnouncements=function(){var e,n=[];I()(e=t.pendingValues).call(e,(function(e){"string"==typeof e?n.push(e):function e(t,n){if(Object(k.f)(t)){var a;if("none"!==window.getComputedStyle(t).display&&"true"!==t.getAttribute("aria-hidden"))x(t.getAttribute("aria-label"),n),Object(k.h)(t)&&L.has(t.type.toLowerCase())?""===t.value?x(t.placeholder,n):x(t.value,n):Object(k.j)(t)?""===t.value&&x(t.placeholder,n):Object(k.g)(t)&&x(t.alt,n),I()(a=t.childNodes).call(a,(function(t){e(t,n)}))}else Object(k.k)(t)&&x(t.data,n)}(e,n)})),(t.useRef1?t.ref1.current:t.ref2.current).innerText=n.join(" "),(t.useRef1?t.ref2.current:t.ref1.current).innerHTML="",t.useRef1=!t.useRef1,t.pendingValues=null},t}return D(t,e),t.prototype.announceValue=function(e){if(e)if(this.pendingValues||(this.pendingValues=[],R()(this.doAnnouncements)),"string"==typeof e||function(e){return void 0!==e.nodeType}(e))this.pendingValues.push(e);else if(e.messageID){var t=this.props.intl.formatMessage({id:e.messageID},e.messageValues);this.pendingValues.push(t)}else this.pendingValues.push(e.messageText)},t.prototype.render=function(){return r.a.createElement(B.a,{className:"WACAriaAnnouncer"},r.a.createElement("div",{ref:this.ref1,"aria-live":"polite"}),r.a.createElement("div",{ref:this.ref2,"aria-live":"polite"}))},t}(r.a.PureComponent);function x(e,t){e&&(e=P()(e).call(e))&&t.push(e)}function F(e){var t=Object(b.useIntl)(),n=N().store,o=Object(a.useRef)(),s=Object(a.useCallback)((function(e){return o.current.announceValue(e)}),[]),i=Object(a.useRef)();return Object(a.useEffect)((function(){return n.subscribe((function(){var e=n.getState().announceMessage;e!==i.current&&(s(e),i.current=e)}))}),[n,s]),r.a.createElement(S.Provider,{value:s},e.children,r.a.createElement(H,{intl:t,ref:o}))}var V=n(534),j=n(0),U=n(352),z=n(92),G=n.n(z),q=n(101);function K(e,t){var n=e[0],a=e[1],r=t[0],o=t[1];if(n===r&&a===o)return!0;if(n.length!==r.length)return!1;for(var s=0;s<=n.length;s++){var i=n[s],c=r[s];if(i!==c)return!1;if(a[i]!==o[c])return!1}return!0}var Y=n(88),J=n(2),X=n(350),Q=n(530),Z=n(370),$=n(34);function ee(e){var t,n,a,o,s,i,c,l,u,p=e.publicConfig,d=e.isCitizenHomeScreenOn,m=e.isHydrationAnimationComplete,g=e.homeScreenConfig;return r.a.createElement("div",{className:E()("WAC__HeaderCitizen",{"WAC__HeaderCitizen--closed":!d||(null===(t=g)||void 0===t?void 0:t.is_on),"WAC__HeaderCitizen--open":d&&!(null===(n=g)||void 0===n?void 0:n.is_on),"WAC__HeaderCitizen--withHomeScreen":null===(a=g)||void 0===a?void 0:a.is_on,"WAC__HeaderCitizen--isHydrationAnimationComplete":m})},d&&r.a.createElement("style",null,"\n            #WACContainer.WACContainer .WACBotContainer .WAC__header-name.WAC__header-name--citizen {\n              opacity: 0;\n            }\n            #WACContainer.WACContainer .WAC__button-holder ul li {\n              display: block;\n            }\n            #WACContainer.WACContainer .WAC__button-holder ul li button {\n              font-size: 14px;\n              line-height: 18px;\n              margin-bottom: 8px;\n              letter-spacing: 0.16px;\n            }\n            "+(m?function(){for(var e=[],t=2;t<6;t++)e.push("\n    #WACContainer.WACContainer .WAC__message--welcome .WAC__message:nth-child("+t+") {\n      animation: WACFadeInUp 400ms cubic-bezier(0, 0, 0.3, 1) "+(.07*t+.21)+"s both;\n    }\n    ");for(t=1;t<6;t++)e.push("\n    #WACContainer.WACContainer .WAC__button-holder ul li:nth-child("+t+") {\n      animation: WACFadeInUp 400ms cubic-bezier(0, 0, 0.3, 1) "+(.07*t+.28)+"s both;\n    }\n    ");return e.join(" ")}():" #WACContainer.WACContainer .WAC__messages-holder { opacity: 0; }\n                    #WACContainer.WACContainer .WAC__messages div {\n                      overflow-y: hidden;\n                    }")+"\n            "),r.a.createElement("div",{className:"WAC__HeaderCitizen-content"},r.a.createElement("div",{className:"WAC__HeaderCitizen_icon_holder"},r.a.createElement("div",{className:"WAC__HeaderCitizen_icon",style:{backgroundImage:'url("'+Object($.g)(p)+'/citizen/watson_animated.png")'}})),r.a.createElement("div",{className:E()({WAC__hidden:!d})},r.a.createElement(Z.a,{className:"WAC__HeaderCitizen_greeting",canBeDangerous:!(null===(o=p.__ibm__)||void 0===o?void 0:o.isPreviewLink),html:null===(i=null===(s=p.__ibm__)||void 0===s?void 0:s.citizenIntegrationHomeScreen)||void 0===i?void 0:i.greeting}),r.a.createElement(Z.a,{className:"WAC__HeaderCitizen_watson_assistant",canBeDangerous:!(null===(c=p.__ibm__)||void 0===c?void 0:c.isPreviewLink),html:null===(u=null===(l=p.__ibm__)||void 0===l?void 0:l.citizenIntegrationHomeScreen)||void 0===u?void 0:u.watson_assistant}))))}var te=n(354),ne=n(526);function ae(e){var t,n,o,s,i,c=e.agentProfile,l=e.languagePack,u=e.width,p=e.height,d=(null===(t=c)||void 0===t?void 0:t.nickname)||(null===(n=c)||void 0===n?void 0:n.full_name),m={width:u,height:p},g=null===(o=c)||void 0===o?void 0:o.profile_picture_url,_=Object(a.useState)(!1),h=_[0],f=_[1];return Object(a.useEffect)((function(){f(!1)}),[g]),i=!h&&g?r.a.createElement("img",{src:g,alt:l.agent_ariaAgentAvatar,onError:function(){return f(!0)}}):(null===(s=d)||void 0===s?void 0:s.match(/^[\x20-\xFE]+$/))?r.a.createElement("div",{"aria-label":l.agent_ariaAgentAvatar,className:"WAC__agentAvatar--circle",style:m},r.a.createElement("div",{className:"WAC__agentAvatar--letter"},d.charAt(0))):r.a.createElement(ne.a,{width:u?Number(u.replace("px","")):void 0,height:p?Number(p.replace("px","")):void 0,"aria-label":l.agent_ariaAgentAvatar}),r.a.createElement("div",{className:"WAC__agentAvatar"},i)}var re=r.a.createContext(null),oe=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),se=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={attachedToHost:null},t.modalElement=document.createElement("div"),t}return oe(t,e),t.prototype.componentDidMount=function(){this.attachIfNeeded()},t.prototype.componentDidUpdate=function(){this.attachIfNeeded()},t.prototype.componentWillUnmount=function(){this.state.attachedToHost&&this.state.attachedToHost.removeChild(this.modalElement)},t.prototype.attachIfNeeded=function(){var e=this.context;e&&!this.state.attachedToHost&&(this.setState({attachedToHost:e}),e.appendChild(this.modalElement))},t.prototype.render=function(){return this.state.attachedToHost?s.a.createPortal(this.props.children,this.modalElement):null},t.contextType=re,t}(a.Component),ie=n(91),ce=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),le=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={renderTooltip:!1,allowAutoShow:t.props.withHumanAgent},t.timeout=null,t}return ce(t,e),t.prototype.componentDidMount=function(){this.doUpdate(!1)},t.prototype.componentDidUpdate=function(e){this.doUpdate(e.mouseOverTarget)},t.prototype.doUpdate=function(e){var t=this,n=!1,a=!1;if(ie.c)n=!1;else if(this.props.agentState.isPanelOpen!==this.props.withHumanAgent)n=!1;else if(this.props.mouseOverTarget&&!this.state.renderTooltip)n=!0;else if(e&&!this.props.mouseOverTarget)n=!1;else{if(this.state.renderTooltip||!this.state.allowAutoShow)return;n=!0,a=!0}n&&!this.state.renderTooltip?(this.setState({renderTooltip:!0,allowAutoShow:!1}),a&&(this.timeout=R()((function(){t.setState({renderTooltip:!1})}),5e3))):!n&&this.state.renderTooltip&&this.setState({renderTooltip:!1})},t.prototype.componentWillUnmount=function(){this.timeout&&clearTimeout(this.timeout)},t.prototype.render=function(){var e,t=this.props,n=t.botName,a=t.intl,o=t.withHumanAgent,s=t.realignArrow;e=o?"agent_ariaToggleViewAgent":"agent_ariaToggleViewBot";var i=a.formatMessage({id:e},{botName:n});return this.state.renderTooltip&&r.a.createElement(se,null,r.a.createElement("div",{className:"WACModal__backToBotTooltip"},r.a.createElement("div",{className:"WACModal__backToBotTooltipSizer"},r.a.createElement("div",{className:"WACModal__backToBotTooltipPadding"}),r.a.createElement("div",{className:"WACModal__backToBotTooltipBubbleContainer"},r.a.createElement("div",{className:"WACModal__backToBotTooltipBubble"},r.a.createElement("div",{className:"WACModal__backToBotTooltipText WACWidget__breakWord"},i)))),r.a.createElement("div",{className:E()("WACModal__backToBotTooltipArrow",{"WACModal__backToBotTooltipArrow--realigned":s})},r.a.createElement("div",{className:"WACModal__backToBotTooltipArrowPointer"}))))},t}(a.PureComponent),ue=Object(b.injectIntl)(le),pe=n(533),de=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),me=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.buttonRef=r.a.createRef(),t.localOnClose=function(){(0,t.props.onClose)();t.props.serviceManager.actions.track({eventName:"Widget Closed",eventDescription:"User has closed the widget."})},t}return de(t,e),t.prototype.requestFocus=function(){this.buttonRef.current&&this.buttonRef.current.focus()},t.prototype.render=function(){var e=this.props.languagePack;return r.a.createElement("div",{className:"WAC__headerButtonContainer"},r.a.createElement("button",{ref:this.buttonRef,className:"WAC__header-close WAC__headerButton WAC__button--base WAC__button--ghost",id:"WAC__header-close","aria-label":e.launcher_isOpen,onClick:this.localOnClose,type:"button"},r.a.createElement(pe.a,null)))},t}(a.PureComponent),ge=n(532),_e=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),he=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _e(t,e),t.prototype.render=function(){var e=this.props,t=e.languagePack,n=e.onReset;return r.a.createElement("div",{className:"WAC__headerButtonContainer"},r.a.createElement("button",{className:"WAC__header-reset WAC__headerButton WAC__button--base WAC__button--ghost",id:"WAC__header-reset","aria-label":t.buttons_reset,onClick:n,type:"button"},r.a.createElement(ge.a,null)))},t}(a.PureComponent);var fe=r.a.memo((function(e){var t=e.element,n=e.id,o=e.className,s=Object(a.useRef)();return Object(a.useEffect)((function(){var e=s.current;return t&&e.appendChild(t),function(){e&&t&&e.contains(t)&&e.removeChild(t)}}),[t]),t&&r.a.createElement("div",{ref:s,className:o,id:n})})),Ce=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),ve=function(e){function t(t){var n=e.call(this,t)||this;return n.closeRef=r.a.createRef(),n.toggleAgentRef=r.a.createRef(),n.onMouseOverBackToBotButton=function(){n.setState({mouseOverBackToBot:!0})},n.onMouseOutBackToBotButton=function(){n.setState({mouseOverBackToBot:!1})},n.onAvatarLoadError=function(){n.setState({hideAvatar:!0})},n.onClickClose=function(){n.props.onToggleProcessView(null)},n.state={mouseOverBackToBot:!1,hideAvatar:!1},n}return Ce(t,e),t.prototype.requestDefaultFocus=function(){this.toggleAgentRef.current?this.toggleAgentRef.current.focus():this.closeRef.current&&this.closeRef.current.requestFocus()},t.prototype.renderBotName=function(){var e=this.props,t=e.botName,n=void 0===t?null:t,a=e.showCitizenHomeScreen,o=e.isCitizenIntegration,s=this.getHeaderType(),i=s===j.a.BOT?"WAC__header-name":"WAC__header-name-"+s;return r.a.createElement("div",{id:i,className:E()("WAC__header-name","WACWidget__textEllipsis",{"WAC__header-name--citizen":a,"WAC__header-name--citizen-with-default-homescreen":o})},s!==j.b.DISCLAIMER&&n)},t.prototype.renderProcessInfo=function(){var e=this.props,t=e.processesByID[e.processState.currentViewedProcessId].processTitle;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"WAC__headerButtons"},r.a.createElement("div",{className:"WAC__headerButtonContainer"},r.a.createElement("button",{type:"button",className:"WAC__headerButton WAC__button--base WAC__button--ghost",onClick:this.onClickClose,"aria-label":this.props.languagePack.thread_closeButton},r.a.createElement("svg",{className:"WAC__header-closeSVG",preserveAspectRatio:"xMidYMid meet",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 32 32","aria-hidden":"true"},r.a.createElement("path",{d:"M13 26l1.41-1.41L6.83 17H29v-2H6.83l7.58-7.59L13 6 3 16l10 10z"}))))),r.a.createElement("span",{className:"WAC__header-name"},t))},t.prototype.renderAgentInfo=function(){var e,t,n=this.props,a=n.languagePack,o=n.agentState,s=o.agentProfile,i=(null===(e=s)||void 0===e?void 0:e.nickname)||(null===(t=s)||void 0===t?void 0:t.full_name)||a.agent_agentNoNameTitle,c=o.isConnected,l=c?a.agent_ariaAgentConnected:a.agent_ariaAgentNotConnected;return r.a.createElement("div",{className:"WAC__headerAgentInfo"},r.a.createElement(ae,{agentProfile:s,languagePack:a,width:"32px",height:"32px"}),r.a.createElement("div",{className:"WACWidget__textEllipsis WAC__header-name"},i),r.a.createElement("div",{className:E()("WAC__headerAgentOnlineStatus",{"WAC__headerAgentOnlineStatus--offline":!c}),title:l}))},t.prototype.getHeaderType=function(){var e=this.props,t=e.withHumanAgent,n=e.isProcess,a=e.isHomeScreen,r=e.isDisclaimer;return a?j.b.HOME_SCREEN:r?j.b.DISCLAIMER:Object(Y.g)(t,n)},t.prototype.renderAgentChatButton=function(){var e,t=this.props,n=t.languagePack,a=t.withHumanAgent,o=t.onToggleAgentView,s=t.agentState,i=t.intl,c=t.botName,l=s.numUnreadMessages,u=!a&&0!==l;return a?e=i.formatMessage({id:"agent_ariaToggleViewAgent"},{botName:c}):(e=n.agent_ariaToggleViewBot,u&&(e+=". "+i.formatMessage({id:"icon_ariaUnreadMessages"},{count:l}))),r.a.createElement("div",{className:"WAC__headerButtonContainer"},r.a.createElement("button",{ref:this.toggleAgentRef,type:"button",className:"WAC__headerButton WAC__button--base WAC__button--ghost",onClick:o,onMouseOver:this.onMouseOverBackToBotButton,onMouseOut:this.onMouseOutBackToBotButton,"aria-label":e},r.a.createElement(Q.a,null)),u&&r.a.createElement("div",{className:"WAC__countIndicator"},l))},t.prototype.renderBotAvatar=function(){var e=this.props,t=e.botAvatarURL,n=e.intl,a=e.withHumanAgent,o=e.isProcess,s=e.botName,i=e.isCitizenIntegration;return this.getHeaderType()!==j.b.DISCLAIMER&&!a&&!o&&(t||i)&&!this.state.hideAvatar?i?r.a.createElement("div",{className:"WAC__header-avatar"}):r.a.createElement("img",{className:"WAC__header-avatar",src:t,onError:this.onAvatarLoadError,alt:n.formatMessage({id:"header_ariaBotAvatar"},{botName:s})}):null},t.prototype.render=function(){var e,t=this.props,n=t.serviceManager,a=t.languagePack,o=t.onClose,s=t.hideCloseButton,i=t.agentState,c=t.withHumanAgent,l=t.isProcess,u=t.botName,p=t.onReset,d=t.homeScreenConfig,m=t.isCitizenIntegration,g=t.showCitizenHomeScreen,_=t.isHydrationAnimationComplete,h=t.featureSet,f=t.isHomeScreen,C=null===(e=i)||void 0===e?void 0:e.wasConnected,v=this.getHeaderType(),A=v===j.a.BOT?"WAC__header":"WAC__header-"+v;return r.a.createElement("div",{className:"WAC__headerContainer"},r.a.createElement("div",{id:A,className:E()("WAC__header",{"WAC__header--padded":!l})},this.renderBotAvatar(),!c&&!l&&this.renderBotName(),i&&r.a.createElement(ue,{realignArrow:s,withHumanAgent:c,agentState:i,botName:u,languagePack:a,mouseOverTarget:this.state.mouseOverBackToBot}),c&&this.renderAgentInfo(),l&&this.renderProcessInfo(),r.a.createElement("div",{className:"WAC__headerButtons"},h[te.a.RESET_BUTTON]&&r.a.createElement(he,{languagePack:a,onReset:p}),C&&this.renderAgentChatButton(),!s&&r.a.createElement(me,{ref:this.closeRef,serviceManager:n,languagePack:a,onClose:o}))),(v===j.a.BOT||f)&&r.a.createElement(r.a.Fragment,null,m&&r.a.createElement(ee,{publicConfig:n.store.getState().config.public,isCitizenHomeScreenOn:g,isHydrationAnimationComplete:_,homeScreenConfig:d}),v===j.a.BOT&&r.a.createElement(fe,{id:"headerBottomElement",className:"WAC__RichText",element:n.writeableElements[j.f.HEADER_BOTTOM_ELEMENT]})))},t}(a.PureComponent),Ae=Object(b.injectIntl)(ve,{forwardRef:!0}),Ee=n(525);function be(e){return r.a.createElement(Ee.a,{className:E()("WACErrorIcon",e.className)})}var ye=function(e){var t=e.text;return r.a.createElement("div",{className:"WAC__inlineError"},r.a.createElement("div",{className:"WAC__inlineError--iconHolder"},r.a.createElement(be,{className:"WAC__inlineError--icon"})),r.a.createElement("div",{className:"WAC__inlineError--text"},t))},Se=n(13),We=n.n(Se);function Ne(e,t){var n=Object(a.useRef)(!1);Object(a.useLayoutEffect)((function(){if(n.current)return e();n.current=!0}),t)}var we=n(30);function Oe(e,t,n,a){if(e)if(e.classList.add(t),"number"==typeof n)R()((function(){e.classList.remove(t),a&&a()}),n);else{var r=function r(o){n&&o.animationName!==n||(e.removeEventListener("animationend",r),e.removeEventListener("animationcancel",r),e.classList.remove(t),a&&a())};e.addEventListener("animationend",r),e.addEventListener("animationcancel",r)}}var Pe=n(524);function Te(e){return r.a.createElement("svg",{className:e.className,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12.75 20.64"},r.a.createElement("circle",{cx:"6.07",cy:"18.82",r:"1.82"}),r.a.createElement("path",{d:"M7.28,0H5.46A5.45,5.45,0,0,0,0,5.44v.63H2.43V5.46a3,3,0,0,1,3-3H7.28a3,3,0,1,1,0,6.07H4.86V14H7.28v-3A5.47,5.47,0,1,0,7.28,0Z"}))}function Re(e){var t=N(),n=e.isOpen,o=e.numStrikes,s=Object(a.useRef)(e),i=Object(a.useRef)(),c=t.store.getState().languagePack,l=n?c.suggestions_ariaButtonToClose:c.suggestions_ariaButtonToOpen;Ne((function(){var t=s.current,a=t.isOpen,r=t.numStrikes,c=o!==r&&0!==o;n!==a?n&&c?Oe(i.current,"WACAlternateSuggestionsButton--animate-open-strike",1998):Oe(i.current,n?"WACAlternateSuggestionsButton--animate-open":"WACAlternateSuggestionsButton--animate-close",666):c&&Oe(i.current,"WACAlternateSuggestionsButton--animate-strike"),s.current=e}));return r.a.createElement("button",{type:"button",className:E()("WACAlternateSuggestionsButton WAC__button--base WAC__button--secondary",{"WACAlternateSuggestionsButton--open":n,"WACAlternateSuggestionsButton--closed":!n}),ref:i,onClick:function(){t.store.dispatch(we.G.setAlternateSuggestionsOpen(!n,"User"))},"aria-label":l},r.a.createElement("span",null,r.a.createElement(Pe.a,{className:"WACAlternateSuggestionsButton__XButton"}),r.a.createElement(Te,{className:"WACAlternateSuggestionsButton__Lightning"})))}function Me(e){var t=e.sourceResponse,n=e.suggestionListItems,o=e.requestInputFocus,s=e.isOpen,i=N(),c=i.store.getState().languagePack.suggestions_ariaListLabel,l=Object(a.useRef)();Ne((function(){if(k.b){var e=s?"WAC__AlternateSuggestionsOptionsPanel--animate-in":"WAC__AlternateSuggestionsOptionsPanel--animate-out";Oe(l.current,e,1e3)}}),[s]);return r.a.createElement("div",{className:"WAC__AlternateSuggestionsOptionsPanel"},r.a.createElement("div",{className:"WAC__button-holder"},r.a.createElement("ul",{ref:l,"aria-label":c},n&&G()(n).call(n,(function(e,n){return r.a.createElement("li",{key:e.option.label},r.a.createElement("button",{type:"button",className:"WAC__button--base WAC__button--round "+(e.isSelected?"WAC__button--selected":""),disabled:e.isSelected,onClick:function(){return function(e,n){i.actions.sendSuggestionChoice(e,t,n),o()}(e,n)}},e.option.label))})))),r.a.createElement("div",{className:"WAC__buttons"}))}var Ie,ke=function(){return(ke=We.a||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Be=((Ie={})["data-wac-alternate-suggestions-exclude"]="true",Ie);var De=r.a.memo((function(e){var t=e.requestInputFocus,n=N(),o=Object(i.useSelector)((function(e){return e.alternateSuggestionsState})),s=Object(a.useRef)(o),c=o.isOpen,l=o.showButton,u=o.suggestionListItems,p=o.sourceResponse,d=o.numStrikes,m=Object(a.useRef)(),g=Object(a.useRef)(),_=Object(a.useRef)(),h=Object(a.useRef)();return Ne((function(){if(k.b){var e=s.current,t=e.isOpen,a=e.showButton,r=e.numStrikes;if(l&&d!==r&&0!==d&&Oe(_.current,"WACAlternateSuggestionsContainer__Button--animate-strike","WACFadeIn"),c!==t||l!==a){var i=m.current.offsetHeight+"px";h.current.style.display=a?"block":"none",_.current.style.display=a?"block":"none",g.current.style.display=t?"block":"none";var u=m.current.offsetHeight+"px";if(h.current.style.display=null,_.current.style.display=null,g.current.style.display=null,m.current.style.setProperty("--WatsonAssistantChat-Animate-Start-Height",u),m.current.style.setProperty("--WatsonAssistantChat-Animate-End-Height",i),n.store.dispatch(we.G.setAppStateValue("suspendScrollDetection",!0)),Oe(m.current,"WACAlternateSuggestionsContainer--animate",333,(function(){m.current.style.height=null,n.store.dispatch(we.G.setAppStateValue("suspendScrollDetection",!1))})),l!==a){var p=l?"WACAlternateSuggestionsContainer__Button--animate-in":"WACAlternateSuggestionsContainer__Button--animate-out";Oe(_.current,p,l?771:333)}}s.current=o}})),r.a.createElement("div",ke({className:E()("WACAlternateSuggestionsContainer",{"WACAlternateSuggestionsContainer--open":c,"WACAlternateSuggestionsContainer--closed":!c,"WACAlternateSuggestionsContainer--showButton":l,"WACAlternateSuggestionsContainer--hideButton":!l})},Be,{ref:m}),r.a.createElement("div",{className:"WACAlternateSuggestionsContainer__Padding",ref:h},r.a.createElement("div",{className:"WACAlternateSuggestionsContainer__Panel",ref:g},r.a.createElement(Me,{sourceResponse:p,requestInputFocus:t,suggestionListItems:u,isOpen:c})),r.a.createElement("div",{className:"WACAlternateSuggestionsContainer__Button",ref:_},r.a.createElement(Re,{isOpen:c,numStrikes:d}))))})),Le=n(531),He=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),xe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.textAreaRef=r.a.createRef(),t}return He(t,e),t.prototype.takeFocus=function(){this.textAreaRef.current.focus()},t.prototype.render=function(){var e=this.props,t=e.isRequired,n=e.name,a=e.id,o=e.onBlur,s=e.onClick,i=e.onChange,c=e.onKeyDown,l=e.rows,u=e.value,p=e.autoSize,d=e.maxLength,m=e.disabled,g=e.placeholder,_=e.ariaLabel;return r.a.createElement("div",{className:E()("WAC__TextArea",{"WAC__TextArea--autoSize":p,"WAC__TextArea--disabled":m})},r.a.createElement("textarea",{ref:this.textAreaRef,"aria-label":_,"aria-required":t,className:"WAC__TextArea-textarea",disabled:m,id:a,maxLength:d,name:n,onBlur:o,onClick:s,onChange:i,onKeyDown:c,placeholder:g,rows:l,value:u||"","data-enable-grammarly":!1}),p&&r.a.createElement("div",{className:"WAC__TextArea-sizer"},u||" "))},t.defaultProps={isRequired:!1,maxLength:1e4},t}(a.PureComponent),Fe=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),Ve=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={inputValue:"",enableFadeOut:!1},t.textAreaRef=r.a.createRef(),t.onKeyDown=function(e){"Enter"===e.key&&(t.props.disableSend?e.preventDefault():t.send(e))},t.onChange=function(e){t.setState({inputValue:e.target.value,enableFadeOut:!0})},t.send=function(e){var n=t.state.inputValue;e.preventDefault();var a=P()(n).call(n);a.length>0&&(t.props.onSendInput(a),t.setState({inputValue:""}),t.textAreaRef.current.takeFocus())},t}return Fe(t,e),t.prototype.takeFocus=function(){ie.c||this.textAreaRef.current.takeFocus()},t.prototype.getElementId=function(e){var t=this.props,n=t.namespace,a=t.withHumanAgent,r=t.isProcess,o=Object(Y.g)(a,r);return(o===j.a.BOT?e:e+"-"+o)+(n?"--"+n:"")},t.prototype.render=function(){var e=this.props,t=e.disableInput,n=e.disableSend,a=e.languagePack,o=(e.namespace,e.withHumanAgent,e.isProcess,a.input_buttonLabel),s=a.input_placeholder,i=this.state,c=i.inputValue,l=i.enableFadeOut,u=t?"":c,p=!c||t||n,d=t?void 0:s;return r.a.createElement("div",{id:this.getElementId("WAC__inputContainer"),className:"WAC__inputContainer"},r.a.createElement("label",{id:this.getElementId("WAC__inputLabel"),className:"WAC__inputLabel","aria-hidden":"true"},s),r.a.createElement("div",{id:this.getElementId("WAC__inputContainer-TextAreaContainer"),className:"WAC__inputContainer-TextAreaContainer"},r.a.createElement(xe,{autoSize:!0,ariaLabel:d,disabled:t,maxLength:300,onChange:this.onChange,onKeyDown:this.onKeyDown,placeholder:d,value:u,ref:this.textAreaRef,id:this.getElementId("WAC__inputContainer-TextArea")}),r.a.createElement("button",{className:E()({"WAC__send-button WAC__button--base WAC__button--primary disabled":!u,"WAC__send-button WAC__button--base WAC__button--primary disabled fade-out":l&&!u,"WAC__send-button WAC__button--base WAC__button--primary ":u}),id:this.getElementId("WAC__send-button"),type:"button",onClick:this.send,"aria-label":o,disabled:p},r.a.createElement(Le.a,null))))},t}(a.Component),je=n(471),Ue=function(){return(Ue=We.a||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function ze(e){return r.a.forwardRef((function(t,n){var o=Object(a.useContext)(W);return r.a.createElement(e,Ue({},t,{ref:n,serviceManager:o}))}))}var Ge=n(18);function qe(e){return null==e}var Ke=function(){return(Ke=We.a||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function Ye(e){return r.a.forwardRef((function(t,n){var o=Object(a.useContext)(S);return r.a.createElement(e,Ke({},t,{ref:n,ariaAnnouncer:o}))}))}var Je=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),Xe=Ye(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isMounted:!1},t.onceAnnounced=!1,t}return Je(t,e),t.prototype.componentDidMount=function(){var e=this;this.setState({isMounted:!0}),this.onceAnnounced||(this.props.announceOnce&&R()((function(){e.props.ariaAnnouncer(e.props.announceOnce)})),this.onceAnnounced=!0)},t.prototype.render=function(){return r.a.createElement("div",{"aria-live":"polite"},this.state.isMounted&&this.props.children)},t}(a.PureComponent)),Qe=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),Ze=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onCancelClick=function(){t.props.serviceManager.humanAgentService.endChat()},t}return Qe(t,e),t.prototype.render=function(){var e,t,n=this.props,a=n.availability,o=n.intl.messages.agent_ariaConnectingCancel;return a&&!qe(a.estimated_wait_time)?(e="agent_connectingMinutes",t={time:a.estimated_wait_time}):a&&!qe(a.position_in_queue)?(e="agent_connectingQueue",t={position:a.position_in_queue}):(e="agent_connecting",t={}),r.a.createElement("div",{className:"WAC__agentBanner"},r.a.createElement("div",{className:"WAC__agentBanner-text"},r.a.createElement(Xe,{announceOnce:o},r.a.createElement(b.FormattedHTMLMessage,{id:e,values:t}))),r.a.createElement("div",{className:"WAC__agentBanner-buttonContainer"},r.a.createElement("button",{type:"button",className:"WAC__agentBanner-button WAC__button--base WAC__button--ghost","aria-label":o,onClick:this.onCancelClick},r.a.createElement(b.FormattedMessage,{id:"buttons_cancel"}))))},t}(r.a.PureComponent);var $e=ze(Object(b.injectIntl)(Object(i.connect)((function(e){return{availability:e.agentState.availability}}))(Ze)));function et(e,t){var n,a=t.ui_state.agentProfile,r=a?a.nickname||a.full_name:null;switch(t.message.response_type){case Ge.a.AGENT_JOINED:n=r?"agent_agentJoinedName":"agent_agentJoinedNoName";break;case Ge.a.AGENT_LEFT_CHAT:n=r?"agent_agentLeftChat":"agent_agentLeftChatNoName";break;case Ge.a.AGENT_ENDED_CHAT:n=r?"agent_agentEndedChat":"agent_agentEndedChatNoName";break;case Ge.a.TRANSFER_TO_AGENT:n=r?"agent_transferring":"agent_transferringNoName";break;case Ge.a.USER_ENDED_CHAT:n="agent_youEndedChat";break;case Ge.a.DISCONNECTED:n="agent_disconnected";break;case Ge.a.RECONNECTED:n="agent_reconnected";break;default:return""}return n&&e.formatMessage({id:n},{personName:r})}var tt=Object(b.injectIntl)((function(e){return r.a.createElement(a.Fragment,null,et(e.intl,e.message))}));var nt=r.a.memo((function(e){var t=Object(a.useContext)(S);return Object(a.useEffect)((function(){t(e.message)}),[t,e.message]),r.a.createElement("div",null)})),at=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),rt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return at(t,e),t.prototype.render=function(){var e,t=this.props,n=t.message,a=t.languagePack,o=t.onToggleAgentView,s=n.ui_state.agentProfile,i=n.message.response_type;e=i===Ge.a.AGENT_JOINED||i===Ge.a.AGENT_LEFT_CHAT||i===Ge.a.AGENT_ENDED_CHAT||i===Ge.a.DISCONNECTED||i===Ge.a.RECONNECTED||i===Ge.a.TRANSFER_TO_AGENT?et(this.props.intl,n):n.message.text;var c=this.props.intl.formatMessage({id:"agent_ariaAgentNewMessage"},{messageText:e});return r.a.createElement(Xe,null,r.a.createElement("div",{className:"WAC__agentBanner WAC__agentMessageBanner"},r.a.createElement(ae,{agentProfile:s,languagePack:a,height:"24px",width:"24px"}),r.a.createElement(nt,{message:c}),r.a.createElement("div",{className:"WAC__agentBanner-text"},r.a.createElement("div",{className:"WAC__agentBanner-textInner"},r.a.createElement("button",{type:"button",className:"WAC__agentMessageBanner-textButton WAC__button--link WACWidget__textEllipsis",onClick:o,"aria-label":a.agent_ariaToggleViewBot},r.a.createElement("span",null,e))))))},t}(r.a.PureComponent),ot=Object(b.injectIntl)(rt),st=n(37),it=n.n(st);var ct=function(e){var t=e.timestamp;return r.a.createElement("div",{className:"WAC__date"},it()(t).format("LLLL"))};var lt=r.a.memo((function(e){var t=e.welcomeNodeBeforeElement,n=e.children,o=Object(a.useRef)();return Object(a.useEffect)((function(){var e=o.current;return e.appendChild(t),function(){e.removeChild(t)}}),[t]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{ref:o,className:"WAC__RichText",id:"welcomeNodeBeforeElement"}),n)}));function ut(){return r.a.createElement("span",{"aria-hidden":"true"},r.a.createElement("span",{className:"WAC__loading-ball"}),r.a.createElement("span",{className:"WAC__loading-ball"}),r.a.createElement("span",{className:"WAC__loading-ball"}))}var pt=n(527),dt=n(7),mt=n(353),gt=n(425),_t=n(417),ht=n(402),ft=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),Ct=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onSelect=function(e,n){var a=t.props,r=a.localMessage,o=a.serviceManager,s=r.originalMessage,i=s.thread_id,c=s.id,l=Object(Y.b)(n.item,i,c),u=r.ui_state.id,p={eventName:"Assistant Message Received from User",eventDescription:"User clicks on one of the disamb options.",type:"disambiguation",optionSelected:n.index+1};o.actions.send(l,{trackEventProps:p,setValueSelectedForMessageID:u}),t.props.requestInputFocus()},t}return ft(t,e),t.prototype.render=function(){var e,t=this,n=this.props,o=n.localMessage,s=n.disableUserInputs,i=n.serviceManager,c=o.message,l=c.suggestions,u=c.title,p=i.store.getState().config.public,d=o.ui_state.optionSelected;return r.a.createElement(a.Fragment,null,r.a.createElement(ht.a,{description:u,canBeDangerous:!(null===(e=p.__ibm__)||void 0===e?void 0:e.isPreviewLink)}),r.a.createElement("div",{className:"WAC__button-holder"},r.a.createElement("ul",null,G()(l).call(l,(function(e,n){return r.a.createElement("li",{key:e.label},r.a.createElement(_t.a,{className:"WAC__button--base WAC__button--round",boundParameter:{index:n,item:e},id:"WAC__disambigButton-"+n,disabled:s,selected:d&&e.value.input.suggestion_id===d.input.suggestion_id,onClick:t.onSelect},e.label))})))))},t}(a.Component),vt=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),At=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vt(t,e),t.prototype.render=function(){var e=this.props,t=e.messageToHuman,n=e.languagePack,a=n.agent_mockTitle,o=n.agent_mockDescription,s=n.agent_mockMessageLabel,i=t?r.a.createElement("span",null,r.a.createElement("br",null),r.a.createElement("br",null),s,r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("em",null,t)):null;return r.a.createElement("div",{className:"WAC__connectToAgentHolder"},r.a.createElement("div",{className:"WAC__connectToAgent--textHolder WAC__connectToAgent--preview"},r.a.createElement("div",{className:"WAC__connectToAgent--title"},a),r.a.createElement("div",{className:"WAC__connectToAgent--description"},o," ",i)))},t}(a.PureComponent),Et=n(528),bt=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),yt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isDisabled:!1},t.onClick=function(){var e=t.props,n=e.localMessage,a=e.requestInputFocus,r=e.serviceManager.humanAgentService,o=n.originalMessage;t.setState({isDisabled:!0}),r.startChat(o),a()},t}return bt(t,e),t.prototype.render=function(){var e,t,n,a,o,s=this.state.isDisabled,i=this.props,c=i.languagePack,l=i.disableUserInputs,u=i.showRequestSent,p=i.config,d=i.localMessage,m=c.agent_reason_error,g=c.agent_chatTitle,_=c.agent_startChat,h=c.agent_chatRequested,f=c.default_agent_availableMessage,C=c.default_agent_unavailableMessage;if(!Object(Y.i)(p))throw new Error('The widget attempted to render a "connect_to_agent" message but there is no service desk configured. Check your assistant configuration.');if(!1!==(null===(e=d.ui_state)||void 0===e?void 0:e.agentAvailability)){var v=u?h:_,A=u||l||s,E=void 0;switch(null===(n=null===(t=d.message.transfer_info)||void 0===t?void 0:t.reason)||void 0===n?void 0:n.type){case y.a.GENERAL_ERROR:case y.a.TRANSFER_FAILURE:E=m;break;default:E=(null===(a=d.message.agent_available)||void 0===a?void 0:a.message)||f}return r.a.createElement("div",{className:"WAC__connectToAgentHolder"},r.a.createElement("div",{className:"WAC__connectToAgent--textHolder"},r.a.createElement("div",{className:"WAC__connectToAgent--title"},r.a.createElement(Q.a,null),r.a.createElement("span",null,g)),r.a.createElement("div",{className:"WAC__connectToAgent--description"},E),r.a.createElement("button",{type:"button",className:"WAC__connectToAgent--link",onClick:this.onClick,disabled:A},r.a.createElement("div",{className:"WAC__connectToAgent--link-text"},v),!u&&r.a.createElement(Et.a,null))))}var b=(null===(o=d.message.agent_unavailable)||void 0===o?void 0:o.message)||C;return r.a.createElement("div",null,b)},t}(a.PureComponent),St=r.a.memo(yt),Wt=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),Nt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Wt(t,e),t.prototype.render=function(){var e=this.props,t=e.languagePack,n=e.localMessage,a=e.isPreviewLink,o=e.serviceManager,s=e.agentState,i=e.requestInputFocus,c=e.disableStartChat,l=e.config,u=n.message.message_to_human_agent,p=c||s.isConnected||s.isConnecting||l.public.isAgentApp,d=s.isConnecting||s.isConnected;return r.a.createElement("div",null,a&&r.a.createElement(At,{languagePack:t,messageToHuman:u}),!a&&r.a.createElement(St,{localMessage:n,serviceManager:o,languagePack:t,disableUserInputs:p,requestInputFocus:i,config:l,showRequestSent:d}))},t}(a.PureComponent);var wt=r.a.memo((function(e){var t=e.serviceManager.customElementRegistry.get(e.messageID),n=Object(a.useRef)();return Object(a.useEffect)((function(){var e=n.current;if(t)return e.appendChild(t),function(){e.removeChild(t)}})),r.a.createElement("div",{ref:n,className:"WAC__message-customResponse WAC__RichText"})})),Ot=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),Pt=Ye(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={loaded:!1,error:!1,announceOnLoad:t.props.needsAnnouncement},t.image=r.a.createRef(),t.ref=r.a.createRef(),t}return Ot(t,e),t.prototype.componentDidMount=function(){var e=this,t=function t(){e.setState({error:!0}),e.image.current&&(e.image.current.removeEventListener("load",n),e.image.current.removeEventListener("error",t))},n=function n(){e.state.announceOnLoad&&e.props.ariaAnnouncer(e.ref.current),e.setState({loaded:!0,announceOnLoad:!1}),e.image.current&&(e.image.current.removeEventListener("load",n),e.image.current.removeEventListener("error",t))};this.image.current.complete?n():this.image.current&&(this.image.current.addEventListener("load",n),this.image.current.addEventListener("error",t))},t.prototype.render=function(){var e=this.props,t=e.imageError,n=e.source,o=e.title,s=e.description,i=this.state,c=i.loaded,l=i.error;return r.a.createElement("div",{ref:this.ref},!c&&r.a.createElement(a.Fragment,null,l?r.a.createElement(ye,{text:t}):r.a.createElement("div",{className:"WAC__imageHolder"},r.a.createElement("div",{className:"WAC_skeletonLoading WAC__image--loading"}),(o||s)&&r.a.createElement("div",{className:"WAC__image--textHolder"},o&&r.a.createElement("p",{className:"WAC_skeletonLoading WAC_skeletonLoading--text"}),s&&r.a.createElement(a.Fragment,null,r.a.createElement("p",{className:"WAC_skeletonLoading WAC_skeletonLoading--text"}),r.a.createElement("p",{className:"WAC_skeletonLoading WAC_skeletonLoading--text"}))))),!l&&r.a.createElement("div",{className:"WAC__imageHolder"},r.a.createElement("img",{className:E()("WAC__image",{"WAC__image--loaded":c,"WAC__image--error":l,"WAC__image--text":o||s,"WAC__image--no-text":!o&&!s}),src:n,alt:o||s||"",ref:this.image,style:{display:c?"block":"none"}}),(o||s)&&c&&r.a.createElement("div",{className:"WAC__image--textHolder"},o&&r.a.createElement("div",{className:"WAC__image--title"},o),s&&r.a.createElement("div",{className:E()("WAC__image--description",{"WAC__image--description-margin":o&&s})},s))))},t}(a.PureComponent)),Tt=n(416),Rt=n(420),Mt=n.n(Rt),It=n(476),kt=n.n(It);var Bt=n(481),Dt=n.n(Bt),Lt=n(50),Ht=n.n(Lt),xt=n(389),Ft=n(522),Vt=n(523),jt=n(529),Ut=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),zt={eventName:"Assistant Message Received from User",eventDescription:"User clicks on search link.",type:"search"},Gt=function(e){function t(t){var n=e.call(this,t)||this;return n.toggleExpandedState=function(){n.setState((function(e){return{expanded:!e.expanded}}))},n.state={expanded:!1},n}return Ut(t,e),t.prototype.render=function(){var e=this.props,t=e.title,n=e.body,a=e.shouldTruncateBody,o=e.urlIsValid,s=e.languagePack,i=e.url,c=e.serviceManager,l=e.innerRef,u=s.showLess,p=s.showMore,d=this.state.expanded,m=r.a.createElement("span",{className:"WACWidget__textEllipsis"},t),g=r.a.createElement("a",{onClick:function(){return c.actions.track(zt)},className:"WAC__searchResponseTitle-anchor",href:i,target:"_blank",rel:"noopener noreferrer"},m);return r.a.createElement("div",{className:"WAC__searchResult",ref:l},r.a.createElement("div",{className:"WAC__searchResult--padding"},n&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:E()({WAC__searchResponseBody:a,"WAC__searchResponseBody--full":d})},n),a&&r.a.createElement("button",{type:"button",onClick:this.toggleExpandedState,className:"WAC__button--link WAC__searchResponseBody-moreToggle"},r.a.createElement("span",{className:"WAC__searchResponseBody-moreToggle-text"},d?u:p),d?r.a.createElement(Ft.a,{className:"WAC__searchResponseBody-moreToggle-icon"}):r.a.createElement(Vt.a,{className:"WAC__searchResponseBody-moreToggle-icon"}))),t&&r.a.createElement("div",{className:E()("WAC__searchResponseTitle",{"WAC__searchResponseTitle--noBody":!n})},r.a.createElement(jt.a,{className:"WAC__Link-svg"}),o?g:m)))},t}(a.PureComponent),qt=200,Kt=750;function Yt(e){if("string"==typeof e&&Ht()(e).call(e,'["')&&Dt()(e).call(e,'"]'))try{e=JSON.parse(e)[0]}catch(e){}return e}function Jt(e){return"null"===e?null:e}var Xt=function(e){var t,n,o,s,i,c=e.serviceManager,l=e.searchResult,u=e.languagePack,p=e.announceOnMount,d=l.url,m=(d=d?Yt(d):void 0)&&Object(xt.b)(d),g=Object(a.useRef)(),_=Object(a.useContext)(S);Object(a.useEffect)((function(){g.current&&p&&_(g.current)}),[p,_]);var h,f,C,v=(null===(n=null===(t=l.highlight)||void 0===t?void 0:t.title)||void 0===n?void 0:n[0])?(h=Jt(l.highlight.title[0]))?h.replace(new RegExp("<em>|</em>","g"),""):null:Yt(Jt(l.title));function A(){f=Yt(Jt(l.body)),C=l.body.length>qt}return(null===(o=l.body)||void 0===o?void 0:o.length)<=Kt?A():(null===(i=null===(s=l.highlight)||void 0===s?void 0:s.body)||void 0===i?void 0:i[0])?(f=function(e){var t=e.split(new RegExp("<em>|</em>","g"));return t.length%2!=1?[t.join("")]:G()(t).call(t,(function(e,t){var n="formatHighlightFields-"+e+"-"+t;return t%2!=1?e:r.a.createElement("em",{key:n},e)}))}(Jt(l.highlight.body[0])),C=l.highlight.body[0].length>qt):l.body&&A(),!v&&m&&(v=d),(v||f)&&r.a.createElement(Gt,{title:v,body:f,shouldTruncateBody:C,urlIsValid:m,languagePack:u,url:d,serviceManager:c,innerRef:g})},Qt=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),Zt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={showMoreResults:!1},t.sortedResults=Object(q.a)((function(e){return function(e){var t;return e?kt()(t=Mt()(e).call(e)).call(t,$t):[]}(e)})),t.displayMoreResults=function(){t.setState({showMoreResults:!0})},t}return Qt(t,e),t.prototype.getSearchResultComponents=function(e,t,n){for(var a=this.props,o=a.serviceManager,s=a.languagePack,i=[],c=0;c<t;c++){var l=e[c],u=r.a.createElement(Xt,{serviceManager:o,languagePack:s,searchResult:l,announceOnMount:n});i.push(r.a.createElement("li",{key:c},u))}return i},t.prototype.renderSearchResults=function(){var e,t,n=this.props.message,a=n.primary_results,r=void 0===a?[]:a,o=n.results,s=void 0===o?[]:o;return r.length>0?(e=this.sortedResults(r),t=r.length):(e=this.sortedResults(s),t=Math.min(s.length,3)),this.getSearchResultComponents(e,t,!1)},t.prototype.renderAdditionalResults=function(){var e=this.props,t=e.languagePack,n=e.message.additional_results,a=void 0===n?[]:n;if(!this.state.showMoreResults)return r.a.createElement("button",{onClick:this.displayMoreResults,className:"WAC__button--base WAC__button--ghost",type:"button"},t.showMoreResults);var o=this.sortedResults(a),s=this.getSearchResultComponents(o,o.length,!0);return r.a.createElement("ul",null,s)},t.prototype.render=function(){var e=this.props,t=e.message,n=e.languagePack,a=t.header,o=t.title,s=t.additional_results,i=void 0===s?[]:s;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"WAC__searchMessage--metablock"},a||o||n.messages_searchResults),r.a.createElement("ul",null,this.renderSearchResults()),i.length>0&&this.renderAdditionalResults())},t}(a.PureComponent);function $t(e,t){var n,a,r=e&&e.result_metadata?e.result_metadata.confidence:0,o=t&&t.result_metadata?t.result_metadata.confidence:0;return-((n=r)<(a=o)?-1:n>a?1:0)}var en=r.a.memo(Zt),tn=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),nn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return tn(t,e),t.prototype.renderSpecificMessage=function(e){if(Object(Y.s)(e))return this.renderCustomResponse(e);switch(e.message.response_type){case dt.b.TEXT:return this.renderText(e);case dt.b.IMAGE:return this.renderImage(e);case dt.b.OPTION:return this.renderOption(e);case dt.b.CONNECT_TO_AGENT:return this.renderConnectToAgent(e);case dt.b.SUGGESTION:return this.renderSuggestion(e);case dt.b.SEARCH:return this.renderSearch(e);case Ge.b.INLINE_ERROR:return this.renderInlineError(e);case Ge.a.AGENT_JOINED:case Ge.a.TRANSFER_TO_AGENT:case Ge.a.USER_ENDED_CHAT:case Ge.a.AGENT_LEFT_CHAT:case Ge.a.AGENT_ENDED_CHAT:case Ge.a.DISCONNECTED:case Ge.a.RECONNECTED:return this.renderAgentStatusMessage(e);default:return this.renderCustomResponse(e)}},t.prototype.renderText=function(e){var t,n,a=(null===(t=e.originalMessage.history)||void 0===t?void 0:t.label)||e.message.text;if(Object(Y.l)(e)){var o=e.ui_state.originalUserText||a;return r.a.createElement("div",null,o)}return r.a.createElement(Tt.a,{text:a,canBeDangerous:!(null===(n=this.props.config.public.__ibm__)||void 0===n?void 0:n.isPreviewLink)})},t.prototype.renderOption=function(e){var t=this.props,n=t.languagePack,a=t.requestInputFocus,o=t.serviceManager,s=t.disableUserInputs;return r.a.createElement(gt.a,{localMessage:e,languagePack:n,disableUserInputs:s,requestInputFocus:a,serviceManager:o})},t.prototype.renderSuggestion=function(e){var t=this.props,n=t.requestInputFocus,a=t.serviceManager,o=t.disableUserInputs;return r.a.createElement(Ct,{localMessage:e,serviceManager:a,disableUserInputs:o,requestInputFocus:n})},t.prototype.renderImage=function(e){var t=this.props.languagePack;return r.a.createElement(Pt,{imageError:t.errors_imageSource,source:e.message.source,title:e.message.title,description:e.message.description,needsAnnouncement:e.ui_state.needsAnnouncement})},t.prototype.renderSearch=function(e){var t=this.props,n=t.serviceManager,a=t.languagePack;return r.a.createElement(en,{serviceManager:n,message:e.message,languagePack:a})},t.prototype.renderInlineError=function(e){return r.a.createElement(ye,{text:e.message.text})},t.prototype.renderAgentStatusMessage=function(e){return r.a.createElement(tt,{message:e})},t.prototype.renderCustomResponse=function(e){var t=this.props.serviceManager;return r.a.createElement(wt,{messageID:e.ui_state.id,serviceManager:t})},t.prototype.renderConnectToAgent=function(e){var t=this.props,n=t.languagePack,a=t.serviceManager,o=t.isPreviewLink,s=t.agentState,i=t.requestInputFocus,c=t.disableUserInputs,l=t.config;return r.a.createElement(Nt,{serviceManager:a,localMessage:e,languagePack:n,isPreviewLink:o,agentState:s,requestInputFocus:i,disableStartChat:c,config:l})},t.prototype.render=function(){return this.renderSpecificMessage(this.props.rootMessage)},t}(a.Component);function an(e){var t=e.text;return r.a.createElement("div",null,t)}var rn=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),on=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(){var e=t.props,n=e.processStatus,a=e.currentOngoingProcessId,r=e.currentOngoingProcessStatus;a&&n!==X.a.PROCESS_CANCELLED&&n!==X.a.PROCESS_COMPLETED&&r===X.a.PROCESS_ONGOING&&a!==t.props.localMessage.originalMessage.thread_id?t.props.onConfirmEndChat(t.props.localMessage.originalMessage.thread_id):t.props.onToggleProcessView(t.props.localMessage.originalMessage.thread_id)},t}return rn(t,e),t.prototype.render=function(){var e,t=this.props,n=t.title,o=t.processStatus,s=t.languagePack,i=s.thread_getStartedButton,c=s.thread_continueButton,l=s.thread_reviewButton,u=s.thread_cancelledButton,p=!1;switch(o){case X.a.PROCESS_COMPLETED:e=l;break;case X.a.PROCESS_CANCELLED:e=u;break;case X.a.PROCESS_NOT_STARTED:e=i,p=!0;break;default:e=c,p=!0}return r.a.createElement(a.Fragment,null,r.a.createElement(an,{text:n}),r.a.createElement("div",{className:"WAC__process-launcher"},r.a.createElement("div",{className:"WAC__button-holder"},r.a.createElement("button",{type:"button",className:"WAC__button--base WAC__button--round",onClick:this.onClick},e,p&&r.a.createElement(Et.a,null)))))},t}(a.PureComponent),sn=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),cn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={didRenderErrorOccur:!1},t.ref=r.a.createRef(),t}return sn(t,e),t.prototype.getWidgetSaidMessage=function(){var e,t=this.props,n=t.withHumanAgent,a=t.intl,r=t.botName,o=t.localMessage;return n?o.message.response_type===dt.b.TEXT&&(e="messages_agentSaid"):e="messages_botSaid",e?a.formatMessage({id:e},{botName:r}):null},t.prototype.componentDidCatch=function(){this.setState({didRenderErrorOccur:!0})},t.prototype.componentDidMount=function(){var e=this.props.localMessage.ui_state;e.needsAnnouncement&&(this.props.ariaAnnouncer(this.ref.current),this.props.serviceManager.store.dispatch(we.G.setMessageWasAnnounced(e.id)))},t.prototype.renderFailedRenderMessage=function(){return r.a.createElement("div",{className:"WAC__message WAC__message--inlineError",ref:this.ref},r.a.createElement("div",{className:"WAC__message--padding"},r.a.createElement("div",{className:"WAC__bot-message"},r.a.createElement(B.a,null,this.getWidgetSaidMessage()),r.a.createElement("div",{className:"WAC__bot-bar"}),r.a.createElement("div",{className:"WAC__received WAC__received--text"},r.a.createElement(ye,{text:this.props.languagePack.errors_singleMessage})))))},t.prototype.renderAvatar=function(e,t){var n,a=this.props,o=a.withHumanAgent,s=a.languagePack;if(o)switch(e.message.response_type){case Ge.a.AGENT_JOINED:case Ge.a.AGENT_LEFT_CHAT:case Ge.a.AGENT_ENDED_CHAT:case Ge.a.TRANSFER_TO_AGENT:case Ge.a.USER_ENDED_CHAT:case Ge.a.DISCONNECTED:case Ge.a.RECONNECTED:case Ge.b.INLINE_ERROR:n=!1;break;default:n=!0}else n=t;if(!n)return r.a.createElement("div",{className:"WAC__bot-bar--hidden"});if(o){var i=e.ui_state.agentProfile;return r.a.createElement("div",{className:"WAC__agentMessageAvatar"},r.a.createElement(ae,{agentProfile:i,languagePack:s,width:"24px",height:"24px"}))}return r.a.createElement("div",{className:t?"WAC__bot-bar":"WAC__bot-bar--hidden"})},t.prototype.renderErrorState=function(e){var t,n,a=this.props.languagePack;switch(e){case mt.a.FAILED:t=r.a.createElement(Ee.a,{"aria-label":a.errors_ariaMessageFailed}),n="WAC__message-error-failed";break;case mt.a.RETRYING:t=r.a.createElement(pt.a,{"aria-label":a.errors_ariaMessageRetrying}),n="WAC__message-error-retrying"}return t&&r.a.createElement("div",{className:"WAC__message-error "+n},t)},t.prototype.render=function(){if(this.state.didRenderErrorOccur)return this.renderFailedRenderMessage();var e=this.props,t=e.serviceManager,n=e.config,a=e.localMessage,o=e.languagePack,s=e.requestInputFocus,i=e.isPreviewLink,c=e.messagesIndex,l=e.agentState,u=e.onConfirmEndChat,p=e.onToggleProcessView,d=e.isProcess,m=e.processStatus,g=e.isLatestWelcomeNodesActive,_=e.currentOngoingProcessId,h=e.currentOngoingProcessStatus,f=e.disableUserInputs,C=e.showBotMarker,v=e.className,A=e.withHumanAgent,b=e.featureSet,y=a.message.response_type;if(Object(Y.o)(a.message))return!1;var S=a.ui_state,W=S.errorState,N=S.processLauncher,w=S.partOfMessageID,O=S.id,P=S.fromHistory,T=w===O,R=b[te.a.THREADS]&&N&&!d,M=f||m===X.a.PROCESS_CANCELLED||m===X.a.PROCESS_COMPLETED||n.public.isAgentApp,I=R?r.a.createElement(on,{title:Object(X.d)(a.originalMessage),processStatus:m,localMessage:a,serviceManager:t,languagePack:o,currentOngoingProcessId:_,currentOngoingProcessStatus:h,onConfirmEndChat:u,onToggleProcessView:p}):r.a.createElement(nn,{serviceManager:t,isPreviewLink:i,languagePack:o,requestInputFocus:s,rootMessage:a,agentState:l,disableUserInputs:M,config:n}),k=Object(Y.s)(a),D="";return A?D="agent-":d&&(D="thread-"),r.a.createElement("div",{id:"WAC__"+D+"message-"+c,className:E()("WAC__message WAC__message-"+c,v,{"WAC__message--no-animation":a.ui_state.isLatestWelcomeNode&&!g,"WAC__message--custom":k,"WAC__message--disabled-inputs":M}),ref:this.ref},r.a.createElement("div",{className:"WAC__message--padding"},Object(Y.m)(a)&&r.a.createElement("div",{className:"WAC__bot-message"},T&&r.a.createElement(B.a,null,this.getWidgetSaidMessage()),this.renderAvatar(a,C&&!k),r.a.createElement("div",{className:E()("WAC__received",{"WAC__received--text":"text"===y||R,"WAC__received--image":"image"===y,"WAC__received--options":"option"===y,"WAC__received--search":"search"===y,"WAC__received--suggestion":"suggestion"===y,"WAC__received--welcome":"welcome"===y,"WAC__received--inlineError":y===Ge.b.INLINE_ERROR,"WAC__received--previewAgent":"connect_to_agent"===y&&i,"WAC__received--agentStatusMessage":y===Ge.a.AGENT_JOINED||y===Ge.a.AGENT_LEFT_CHAT||y===Ge.a.AGENT_ENDED_CHAT||y===Ge.a.TRANSFER_TO_AGENT||y===Ge.a.USER_ENDED_CHAT||y===Ge.a.DISCONNECTED||y===Ge.a.RECONNECTED,"WAC__message--historical":P})},I)),Object(Y.l)(a)&&r.a.createElement("div",{className:"WAC__sentAndError-container"},r.a.createElement("div",{className:E()("WAC__sent",{"WAC__sent--error":W===mt.a.FAILED,"WAC__sent--retrying":W===mt.a.RETRYING,"WAC__sent--waiting":W===mt.a.WAITING})},r.a.createElement(B.a,null,o.messages_youSaid),I),W!==mt.a.NONE&&this.renderErrorState(W))))},t}(a.PureComponent),ln=Ye(Object(b.injectIntl)(cn,{forwardRef:!0})),un=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),pn=Object(q.a)((function(){return{right:Object(k.a)(),width:"calc(100% - "+Object(k.a)()}}));var dn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={scrollHandleHasFocus:!1},t.messageRefs=[],t.endChatContainerRef=r.a.createRef(),t.scrollingContainerRef=r.a.createRef(),t.scrollHandleRef=r.a.createRef(),t.onResize=function(){if(t.props.messageState.isScrollAnchored){var e=t.scrollingContainerRef.current;e&&(e.scrollTop=e.scrollHeight)}},t}return un(t,e),t.prototype.componentDidMount=function(){var e=this;this.doAutoScroll(),this.scrollPanelObserver=new je.a(this.onResize),this.scrollPanelObserver.observe(this.scrollingContainerRef.current),this.scrollingContainerRef.current.addEventListener("scroll",(function(){return e.checkScrollAnchor()})),this.scrollHandleRef.current.addEventListener("focus",(function(){return e.setState({scrollHandleHasFocus:!0})})),this.scrollHandleRef.current.addEventListener("blur",(function(){return e.setState({scrollHandleHasFocus:!1})})),this.previousScrollOffsetHeight=this.scrollingContainerRef.current.offsetHeight},t.prototype.componentDidUpdate=function(e){e.messages.length===this.props.messages.length&&e.messageState.isTypingCounter===this.props.messageState.isTypingCounter||this.doAutoScroll()},t.prototype.componentWillUnmount=function(){this.scrollPanelObserver.unobserve(this.scrollingContainerRef.current)},t.prototype.checkScrollAnchor=function(e,t){var n=this.scrollingContainerRef.current;if(e||this.previousScrollOffsetHeight===n.offsetHeight&&!this.props.suspendScrollDetection){var a=(void 0!==t?t:n.scrollTop)>=n.scrollHeight-n.offsetHeight;if(a!==this.props.messageState.isScrollAnchored){var r=Object(Y.g)(this.props.withHumanAgent,this.props.isProcess);this.props.serviceManager.store.dispatch(we.G.setIsScrollAnchored(a,e,r))}}this.previousScrollOffsetHeight=n.offsetHeight},t.prototype.doAutoScroll=function(){try{var e=this.props,t=e.messages,n=e.messageState.isTypingCounter,a=this.scrollingContainerRef.current,r=!0,o=void 0,s=t.length-1,i=t.length?t[s]:null,c=i&&i.ui_state.isLatestWelcomeNode?this.findFirstWelcomeNodeIndex(t):-1;if(i)if(i.ui_state.fromHistory)r=!1,o=a.scrollHeight;else if(-1!==c){r=!1,o=this.messageRefs[c].ref.current.offsetTop}else if(0===n&&Object(Y.l)(i)){o=this.messageRefs[s].ref.current.offsetTop}else if(n>0&&Object(Y.l)(i))o=a.scrollHeight;else{for(var l=t.length-2,u=void 0;l>=0;){var p=t[l];if(Object(Y.l)(p)){u=this.messageRefs[l];break}l--}if(u){var d=u.ref.current;o=d.offsetTop+d.offsetHeight+1}else o=-1}else r=!1,o=0;-1!==o&&(this.endChatContainerRef.current&&(o-=this.endChatContainerRef.current.offsetHeight),o>=a.scrollTop&&(Object(k.d)(a,o,0,r),this.checkScrollAnchor(!0,o)))}catch(e){Object(J.b)("An error occurred while attempting to scroll.",e)}},t.prototype.findFirstWelcomeNodeIndex=function(e){for(var t=e.length-1;t>=0;){if(0===t&&e[t].ui_state.isLatestWelcomeNode)return t;if(t>0&&!e[t-1].ui_state.isLatestWelcomeNode)return t;t--}return e.length-1},t.prototype.shouldShowDate=function(e){var t=this.props.messages;if(t.length>1){var n=t[e-1],a=t[e];if(function(e,t){return!!(e&&e.ui_state&&e.ui_state.localizedDate&&t&&t.ui_state&&t.ui_state.localizedDate)}(a,n))return a.ui_state.localizedDate!==n.ui_state.localizedDate}return!1},t.prototype.shouldShowBotMarker=function(e,t,n){return e.ui_state.id===n&&e.message.response_type!==Ge.b.INLINE_ERROR},t.prototype.renderTypingIndicator=function(e){return r.a.createElement("div",{className:"WAC__message"},e&&r.a.createElement(nt,{message:e}),r.a.createElement("div",{className:"WAC__bot-message"},r.a.createElement("div",{className:"WAC__bot-bar--hidden"}),r.a.createElement("div",{className:"WAC__received--loading"},r.a.createElement(ut,null))))},t.prototype.renderMessage=function(e,t,n,o,s,i){var c,l,u=this,p=this.props,d=p.agentState,m=p.serviceManager,g=p.config,_=p.languagePack,h=p.requestInputFocus,f=p.isPreviewLink,C=p.withHumanAgent,v=p.persistedToBrowserStorage,A=p.processesByID,E=p.botName,b=p.onConfirmEndChat,y=p.onToggleProcessView,S=p.isProcess,W=p.featureSet,N=e.originalMessage,w=v.processState,O=A[w.currentOngoingProcessId];O&&(c=O.processStatus);var P=A[N.thread_id];P&&(l=P.processStatus);var T=0===t?"WAC__message--firstMessage":void 0,R=r.a.createElement(r.a.Fragment,null,!e.ui_state.isLatestWelcomeNode&&N.history&&this.shouldShowDate(t)&&r.a.createElement(ct,{timestamp:N.history.timestamp}),r.a.createElement(ln,{ref:function(e){u.messageRefs[t]=e},className:T,isLatestWelcomeNodesActive:n,config:g,localMessage:e,languagePack:_,requestInputFocus:h,serviceManager:m,isPreviewLink:f,messagesIndex:t,withHumanAgent:C,onConfirmEndChat:b,agentState:d,processStatus:l,botName:E,onToggleProcessView:y,isProcess:S,currentOngoingProcessId:w.currentOngoingProcessId,currentOngoingProcessStatus:c,disableUserInputs:o,showBotMarker:s,featureSet:W}));return i?r.a.createElement(lt,{welcomeNodeBeforeElement:m.writeableElements[j.f.WELCOME_NODE_BEFORE_ELEMENT],key:t},R):r.a.createElement(a.Fragment,{key:t},R)},t.prototype.renderAgentConnectingBanner=function(){return this.props.agentState.isConnecting&&r.a.createElement($e,null)},t.prototype.renderScrollHandle=function(){var e=this.props.languagePack.messages_scrollHandle;return r.a.createElement("div",{className:"WACMessages-scrollHandle",ref:this.scrollHandleRef,tabIndex:0,"aria-label":e})},t.prototype.renderAgentMessageBanner=function(){var e=this.props,t=e.agentState,n=e.withHumanAgent,a=e.languagePack,o=e.onToggleAgentView;return!n&&t.lastUnreadMessage&&r.a.createElement(ot,{message:t.lastUnreadMessage,languagePack:a,onToggleAgentView:o})},t.prototype.renderEndChat=function(){var e=this.props,t=e.agentState,n=e.withHumanAgent,a=e.languagePack,o=e.onConfirmEndChat;return n&&(t.isConnected||t.isConnecting)?r.a.createElement("div",{className:"WAC__messagesEndChatPadding",ref:this.endChatContainerRef,style:pn()},r.a.createElement("div",{className:"WAC__messagesEndChatContainer"},r.a.createElement("button",{type:"button",className:"WAC__messagesEndChatButton WAC__button--base WAC__button--round",onClick:o},a.agent_endChat))):null},t.prototype.isMostRecentWelcomeNodeFirstMessage=function(e){var t=this.props.messages[e];return t.ui_state.isLatestWelcomeNode&&t.ui_state.partOfMessageID===t.ui_state.id},t.prototype.renderMessages=function(e,t,n,a,r){for(var o=this.props.messages,s=[],i=e;i<o.length;i++){var c=o[i];if(t&&c.ui_state.isLatestWelcomeNode)break;var l=c.ui_state.partOfMessageID!==a,u=this.shouldShowBotMarker(c,i,r),p=this.isMostRecentWelcomeNodeFirstMessage(i);s.push(this.renderMessage(c,i,n,l,u,p))}return s},t.prototype.render=function(){var e,t,n,a=this.props,o=a.messages,s=a.messageState,i=a.withHumanAgent,c=a.intl,l=a.botName,u=a.isProcess,p=s.isTypingCounter,d=this.state.scrollHandleHasFocus,m=o[o.length-1];this.messageRefs.length=o.length;var g,_=this.renderEndChat(),h=null===(e=m)||void 0===e?void 0:e.ui_state.partOfMessageID,f=null===(t=Object(U.d)(o,Y.m))||void 0===t?void 0:t.ui_state.partOfMessageID,C=null===(n=m)||void 0===n?void 0:n.ui_state.isLatestWelcomeNode,v=this.renderMessages(0,C,!1,h,f),A=null;if(v.length!==o.length&&(A=this.renderMessages(v.length,!1,!0,h,f)),p){var b=i?"messages_agentIsTyping":"messages_botIsTyping";g=c.formatMessage({id:b},{botName:l})}var y=Object(Y.g)(i,u),S=y===j.a.BOT?"WAC__messages-holder":"WAC__messages-holder-"+y,W=y===j.a.BOT?"WAC__messages":"WAC__messages-"+y;return r.a.createElement("div",{id:S,className:"WAC__messages-holder"},this.renderAgentConnectingBanner(),this.renderAgentMessageBanner(),r.a.createElement("div",{id:W,className:E()("WAC__messages",{WAC__messagesWithEndChat:Boolean(_),"WAC__messages--scrollHandleHasFocus":d}),ref:this.scrollingContainerRef},this.renderScrollHandle(),_,v,A&&A.length>0&&r.a.createElement("div",{className:E()("WAC__message--welcome",{"WAC__message--welcome--typing":p})},A,p>0&&this.renderTypingIndicator(g)),p>0&&!A&&this.renderTypingIndicator(g)))},t}(a.PureComponent),mn=ze(Object(i.connect)((function(e){return e}),null,null,{forwardRef:!0})(dn)),gn=n(419);function _n(e){var t=Object(b.useIntl)(),n=e.botName,a=e.errorType===gn.a.THROTTLED?"errors_busy":"errors_communicating",o=t.formatMessage({id:a},{botName:n});return r.a.createElement("div",{id:"WAC__messages-holder",className:"WAC__messages-holder WAC__messages-error"},r.a.createElement(ye,{text:o}))}var hn=n(491),fn=n.n(hn),Cn=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),vn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onYesClick=function(){t.props.onConfirm()},t.onNoClick=function(){t.props.onCancel()},t.onKeyDown=function(e){"Escape"===e.key&&t.props.onCancel()},t}return Cn(t,e),t.prototype.render=function(){var e=this.props,t=e.title,n=e.message,a=e.cancelButtonLabel,o=e.confirmButtonLabel,s=e.modalAnnounceMessage;return r.a.createElement(se,null,r.a.createElement(fn.a,null,r.a.createElement("div",{className:"WACConfirmModal",role:"dialog","aria-labelledby":"WACConfirmModal__title","aria-describedby":"WACConfirmModal__message"},r.a.createElement("div",{className:"WACConfirmModal__container"},r.a.createElement(nt,{message:s}),r.a.createElement("div",{className:"WACConfirmModal__title",id:"WACConfirmModal__title"},t),r.a.createElement("div",{className:"WACConfirmModal__message",id:"WACConfirmModal__message"},n),r.a.createElement("div",{className:"WACConfirmModal__buttonContainer"},r.a.createElement("button",{type:"button",className:"WAC__button--base WAC__button--secondary",onClick:this.onNoClick,onKeyDown:this.onKeyDown},a),r.a.createElement("button",{type:"button",className:"WAC__button--base WAC__button--primary",onClick:this.onYesClick,onKeyDown:this.onKeyDown},o))))))},t}(a.Component),An=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),En=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onResume=function(){t.props.onToggleProcessView(t.props.currentProcessId)},t.onCancel=function(){t.props.onConfirmEndChat()},t}return An(t,e),t.prototype.render=function(){var e=this.props,t=e.currentProcessId,n=e.process,a=e.languagePack;if(!t||!n||0===n.messageIDs.length||n.processStatus===X.a.PROCESS_COMPLETED||n.processStatus===X.a.PROCESS_CANCELLED||n.processStatus===X.a.PROCESS_NOT_STARTED)return null;var o=a.thread_label,s=a.thread_resumeButton,i=a.thread_cancelButton,c=a.thread_in_progress_announce,l=a.thread_in_progress_resume_description,u=a.thread_in_progress_cancel_description;return r.a.createElement("div",{className:"WAC__process-in-progress"},r.a.createElement(nt,{message:c}),r.a.createElement("div",{className:"WAC__process-in-progress-text"},o,"",r.a.createElement("b",{className:"WACWidget__textEllipsis"},n.processTitle)),r.a.createElement("button",{type:"button",className:"WAC__button--base WAC__button--ghost",onClick:this.onResume,"aria-label":l},s),r.a.createElement("button",{type:"button",className:"WAC__button--base WAC__button--ghost",onClick:this.onCancel,"aria-label":u},i))},t}(a.Component);function bn(e){var t,n,o=e.progress,s=void 0===o?0:o,i=(t=s,n=Object(a.useRef)(),Object(a.useEffect)((function(){n.current=t})),n.current||0)<=s;return r.a.createElement("div",{className:"WAC__SentMessageProgress"},i&&r.a.createElement("div",{className:"WAC__SentMessageProgress_Bar",style:{width:s+"%"}}))}var yn=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),Sn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={showEndChatConfirmation:!1,endChatConfirmationID:null,hasCaughtError:!1},t.inputRef=r.a.createRef(),t.headerRef=r.a.createRef(),t.messagesRef=r.a.createRef(),t.processDoneButtonRef=r.a.createRef(),t.messagesToArray=Object(q.a)((function(e,t){return G()(e).call(e,(function(e){return t[e]}))}),K),t.onSendInputInThread=function(e){var n=t.props;(0,n.onSendInput)(e,n.threadID)},t.hideConfirmEndChat=function(){t.setState({showEndChatConfirmation:!1,endChatConfirmationID:null}),t.requestInputFocus()},t.showConfirmEndChat=function(e){t.setState({showEndChatConfirmation:!0,endChatConfirmationID:e})},t.confirmAgentEndChat=function(){t.props.serviceManager.humanAgentService.endChat().then(t.hideConfirmEndChat)},t.confirmProcessEndChat=function(){t.props.onToggleProcessView(t.state.endChatConfirmationID),t.hideConfirmEndChat()},t.confirmProcessCancelChat=function(){t.props.serviceManager.actions.cancelProcess(t.props.processState.currentOngoingProcessId),t.hideConfirmEndChat()},t.onClickDone=function(){t.props.onToggleProcessView(null)},t.requestInputFocus=function(){!t.shouldDisableInput()&&t.inputRef.current?t.inputRef.current.takeFocus():t.headerRef.current&&t.headerRef.current.requestDefaultFocus()},t.doAutoScroll=function(){t.messagesRef.current&&t.messagesRef.current.doAutoScroll()},t}return yn(t,e),t.prototype.componentDidUpdate=function(e){var t=this.props,n=t.isProcess,a=t.processState;if(this.props.isVisible&&!e.isVisible)n&&this.isProcessEnded()?this.focusProcessDoneButton():this.requestInputFocus();else if(n&&a.isProcessPanelOpen){var r=e.processesByID[a.currentViewedProcessId];this.isProcessEnded()&&r.processStatus!==X.a.PROCESS_COMPLETED&&r.processStatus!==X.a.PROCESS_CANCELLED&&this.focusProcessDoneButton()}},t.prototype.componentDidCatch=function(e,t){Object(J.b)("Chat.componentDidCatch",e,t),this.setState({hasCaughtError:!0})},t.prototype.getBotName=function(){var e=this.props,t=e.languagePack,n=e.botName;return e.isPreviewLink?t.header_previewLinkTitle:n},t.prototype.focusProcessDoneButton=function(){this.processDoneButtonRef&&this.processDoneButtonRef.current&&this.processDoneButtonRef.current.focus()},t.prototype.isProcessEnded=function(){var e=this.props,t=e.processState,n=e.processesByID[t.currentViewedProcessId];return n&&(n.processStatus===X.a.PROCESS_COMPLETED||n.processStatus===X.a.PROCESS_CANCELLED)},t.prototype.shouldDisableInput=function(){var e=this.props,t=e.withHumanAgent,n=e.agentState,a=e.processState,r=e.allMessagesByID,o=e.isProcess,s=e.processesByID[a.currentViewedProcessId];if(o&&s){var i=Object(U.f)(s.messageIDs,r,Y.m);if(Object(Y.n)(i))return!0}return t&&!n.allowUserInput},t.prototype.shouldDisableSend=function(){var e=this.props.isHydrated;return this.shouldDisableInput()||!e},t.prototype.renderMessagesAndInput=function(){var e=this.props,t=e.languagePack,n=e.isPreviewLink,a=e.onToggleAgentView,o=e.onToggleProcessView,s=e.withHumanAgent,i=e.isProcess,c=e.messageState,l=e.intl,u=e.allMessagesByID,p=e.isHydrated,d=e.showWelcomeError,m=e.sentMessagePercentage,g=e.serviceManager,_=(e.alternateSuggestionsState,e.config),h=this.getBotName();if(d)return r.a.createElement(_n,{botName:h,errorType:d});var f=t.thread_doneButton;return r.a.createElement(r.a.Fragment,null,p&&r.a.createElement("div",{className:"WACMessagesContainer__NonInputContainer"},r.a.createElement(mn,{ref:this.messagesRef,messageState:c,messages:this.messagesToArray(c.messageIDs,u),requestInputFocus:this.requestInputFocus,isPreviewLink:n,withHumanAgent:s,onToggleAgentView:a,onConfirmEndChat:this.showConfirmEndChat,botName:h,intl:l,onToggleProcessView:o,isProcess:i}),(!i||!this.isProcessEnded())&&r.a.createElement(r.a.Fragment,null,!s&&r.a.createElement(De,{requestInputFocus:this.requestInputFocus}),r.a.createElement(bn,{progress:m}))),!s&&!i&&r.a.createElement(fe,{id:"beforeInputElement",className:"WAC__RichText",element:g.writeableElements[j.f.BEFORE_INPUT_ELEMENT]}),!_.public.isAgentApp&&(!i||!this.isProcessEnded())&&r.a.createElement(Ve,{ref:this.inputRef,languagePack:t,serviceManager:g,disableInput:this.shouldDisableInput(),disableSend:this.shouldDisableSend(),onSendInput:this.onSendInputInThread,withHumanAgent:s,isProcess:i}),s&&this.state.showEndChatConfirmation&&r.a.createElement(vn,{title:t.agent_endChat,message:t.agent_confirmEndChat,onConfirm:this.confirmAgentEndChat,onCancel:this.hideConfirmEndChat,cancelButtonLabel:t.agent_confirmEndChatNo,confirmButtonLabel:t.agent_confirmEndChatYes,modalAnnounceMessage:t.agent_confirmEndChat}),!s&&this.state.showEndChatConfirmation&&this.state.endChatConfirmationID&&r.a.createElement(vn,{title:t.thread_confirmModalTitle,message:t.thread_confirmModalDescription,onConfirm:this.confirmProcessEndChat,onCancel:this.hideConfirmEndChat,cancelButtonLabel:t.thread_confirmModalNo,confirmButtonLabel:t.thread_confirmModalYes,modalAnnounceMessage:t.thread_confirmNewThread}),!s&&this.state.showEndChatConfirmation&&!this.state.endChatConfirmationID&&r.a.createElement(vn,{title:t.thread_cancelModalTitle,message:t.thread_cancelModalDescription,onConfirm:this.confirmProcessCancelChat,onCancel:this.hideConfirmEndChat,cancelButtonLabel:t.thread_confirmModalNo,confirmButtonLabel:t.thread_confirmModalYes,modalAnnounceMessage:t.thread_confirmNewThread}),i&&this.isProcessEnded()&&r.a.createElement("button",{type:"button",className:"WAC__button--base WAC__button--primary WAC__process-wizard-done-button",onClick:this.onClickDone,ref:this.processDoneButtonRef},f))},t.prototype.render=function(){var e,t=this,n=this.props,a=n.serviceManager,o=n.botAvatarURL,s=n.languagePack,i=n.hideCloseButton,c=n.onClose,l=n.onToggleAgentView,u=n.onToggleProcessView,p=n.withHumanAgent,d=n.intl,m=n.isProcess,g=n.agentState,_=n.processState,h=n.processesByID,f=n.onReset,C=n.featureSet,v=n.isCitizenIntegration,A=n.showCitizenHomeScreen,E=n.isHydrationAnimationComplete,b=n.alternateSuggestionsState,y=n.homeScreenConfig,S=n.config,W=this.state.hasCaughtError,N=this.getBotName(),w=h[_.currentOngoingProcessId],O=(null===(e=b)||void 0===e||e.showButton,Object(Y.g)(p,m)),P="WAC "+(S.public.isAgentApp?"WACAgentApp":"");return r.a.createElement("div",{className:P},r.a.createElement(Ae,{ref:this.headerRef,serviceManager:a,botName:N,botAvatarURL:o,languagePack:s,hideCloseButton:i,onClose:c,onToggleAgentView:l,onToggleProcessView:u,agentState:g,processState:_,withHumanAgent:p,isProcess:m,isDisclaimer:!1,isHomeScreen:!1,processesByID:h,onReset:f,featureSet:C,isCitizenIntegration:v,showCitizenHomeScreen:A,isHydrationAnimationComplete:E,homeScreenConfig:y}),W&&r.a.createElement("div",{className:"WAC__MessagesErrorHandler"},r.a.createElement(ye,{text:d.formatMessage({id:"errors_communicating"},{botName:N})}),r.a.createElement("button",{className:"WAC__button--base WAC__button--ghost WAC__button--reset",id:"WAC__error-reset"+(O===j.a.BOT?"":"-"+O),"aria-label":s.buttons_reset,onClick:function(){f(),t.setState({hasCaughtError:!1})},type:"button"},r.a.createElement(V.a,{className:"WAC__button--resetSVG"}))),!W&&!p&&!m&&!this.state.showEndChatConfirmation&&r.a.createElement(En,{currentProcessId:_.currentOngoingProcessId,process:w,onToggleProcessView:u,onConfirmEndChat:this.showConfirmEndChat,languagePack:s}),!W&&r.a.createElement("div",{className:"WAC__messagesAndInputContainer"},this.renderMessagesAndInput()))},t}(a.Component),Wn=Object(b.injectIntl)(Sn,{forwardRef:!0}),Nn=function(e){var t,n=e.languagePack,a=e.onAcceptDisclaimer,o=e.onClose,s=e.disclaimerHTML,i=e.serviceManager,c=e.botName,l=e.botAvatarURL,u=e.hideCloseButton,p=e.onReset,d=e.featureSet,m=e.disclaimerAcceptButtonRef,g=e.publicConfig;return r.a.createElement("div",{className:"WACDisclaimerContainer"},r.a.createElement("div",{className:"WAC__disclaimer"},r.a.createElement(Ae,{serviceManager:i,botName:c,botAvatarURL:l,languagePack:n,hideCloseButton:u,onClose:o,onReset:p,isDisclaimer:!0,featureSet:d}),r.a.createElement("div",{className:"WAC__disclaimer-content"},g.__ibm__.isCitizenIntegration&&r.a.createElement("div",{className:"WAC__disclaimer-citizen_icon_holder"},r.a.createElement("div",{className:"WAC__disclaimer-citizen_icon",style:{backgroundImage:'url("'+Object($.g)(g)+'/citizen/watson_animated.png")'}})),r.a.createElement("h1",{className:"WAC__disclaimer-title"},n.disclaimer_title),r.a.createElement(Z.a,{className:"WAC__disclaimer-description",canBeDangerous:!(null===(t=g.__ibm__)||void 0===t?void 0:t.isPreviewLink),html:s})),r.a.createElement("div",{className:"WAC__disclaimer-buttons"},r.a.createElement("button",{type:"button",ref:m,onClick:a,className:"WAC__button--base WAC__button--round"},n.disclaimer_accept),r.a.createElement("button",{type:"button",onClick:o,className:"WAC__button--base WAC__button--round"},n.disclaimer_decline))))},wn=n(535),On=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),Pn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.doSendInput=function(e){var n=t.props,a=n.onSendInput;n.serviceManager.trackService.track({eventName:"Home screen input message sent",eventDescription:"The user sent a query by using the input field on the home screen"}),a(e,y.b)},t.onButtonClick=function(e){var n=t.props,a=n.onSendButtonInput;n.serviceManager.trackService.track({eventName:"Home screen starter button sent",eventDescription:"The user sent a query by using one of the conversation starters on the home screen"}),a({label:e.label,value:{input:{text:e.label}}},y.b)},t}return On(t,e),t.prototype.render=function(){var e,t,n,a,o,s,i,c=this,l=this.props,u=l.languagePack,p=l.onClose,d=l.serviceManager,m=l.homeScreenConfig,g=l.botName,_=l.botAvatarURL,h=l.hideCloseButton,f=l.onToggleAgentView,C=l.onToggleProcessView,v=l.agentState,A=l.processState,b=l.withHumanAgent,y=l.processesByID,S=l.onReset,W=l.featureSet,N=l.isCitizenIntegration,w=l.isHydrationAnimationComplete,O=l.homeScreenMessageInputRef;return r.a.createElement("div",{className:"WACHomeScreenContainer"},r.a.createElement("div",{className:E()("WAC__homeScreen",{"WAC__homeScreen--withStarters":null===(a=null===(n=null===(t=m)||void 0===t?void 0:t.starters)||void 0===n?void 0:n.buttons)||void 0===a?void 0:a.length,"WAC__homeScreen--hydrationAnimationComplete":w})},r.a.createElement(Ae,{serviceManager:d,botName:g,botAvatarURL:_,languagePack:u,hideCloseButton:h,onClose:p,onToggleAgentView:f,onToggleProcessView:C,agentState:v,processState:A,withHumanAgent:b,isProcess:!1,processesByID:y,onReset:S,isHomeScreen:!0,isDisclaimer:!1,featureSet:W,isCitizenIntegration:N,homeScreenConfig:m}),r.a.createElement("div",{className:E()("WAC__homeScreen-content",{"WAC__homeScreen-content--withStarters":null===(o=m.starters)||void 0===o?void 0:o.is_on})},r.a.createElement("div",{className:"WAC__homeScreen-body"},r.a.createElement("div",{className:"WAC__homeScreen-greeting"},m.greeting),r.a.createElement("div",{className:"WAC__homeScreen-input"},r.a.createElement(Ve,{ref:O,languagePack:u,disableInput:!1,disableSend:!1,onSendInput:this.doSendInput,serviceManager:d,namespace:"homeScreen"}))),(null===(s=m.starters)||void 0===s?void 0:s.is_on)&&(null===(i=m.starters.buttons)||void 0===i?void 0:i.length)&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"ibm-web-chat-card-home-screen__title-outer"},u.homeScreen_conversationStarterLabel),r.a.createElement("div",{className:"ibm-web-chat-card-home-screen WAC__homeScreen-starters"},G()(e=m.starters.buttons).call(e,(function(e,t){return r.a.createElement("div",{className:"WAC__homeScreen-starter",key:t},r.a.createElement("button",{type:"button",id:"WAC__homeScreen-starter-button-"+t,className:"WAC__button--base WAC__button--ghost",onClick:function(){return c.onButtonClick(e)}},r.a.createElement("span",{className:"WAC__homeScreen-starter-text"},e.label),r.a.createElement(wn.a,{className:"WAC__homeScreen-starter-icon"})))})))),r.a.createElement(fe,{id:"homeScreenAfterStartersElement",element:d.writeableElements[j.f.HOME_SCREEN_AFTER_STARTERS_ELEMENT]}))))},t}(a.Component),Tn=function(){return(Tn=We.a||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};var Rn,Mn,In=function(e){var t=e.className?"WAC__LoadingSpinner "+e.className:"WAC__LoadingSpinner";return r.a.createElement("div",Tn({},e,{className:t}),r.a.createElement("svg",{viewBox:"-18 -18 36 36",focusable:"false","aria-hidden":"true"},r.a.createElement("circle",{strokeWidth:"4",cx:"0",cy:"0",r:"16"})))},kn=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),Bn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={showChildren:!1},t}return kn(t,e),t.prototype.componentDidMount=function(){var e=this;this.onComponentDidMount=R()((function(){e.setState({showChildren:!0})}),this.props.delay)},t.prototype.componentWillUnmount=function(){clearTimeout(this.onComponentDidMount),this.onComponentDidMount=void 0},t.prototype.render=function(){return!!this.state.showChildren&&this.props.children},t.defaultProps={delay:500},t}(a.PureComponent);function Dn(e){var t=e.homeScreenConfig,n=e.isCitizenIntegration;return r.a.createElement("div",{className:E()("WAC__hydrating",{"WAC__hydrating--homeScreen":t.is_on||n})},!t.is_on&&!n&&r.a.createElement(Bn,null,r.a.createElement(In,null)))}!function(e){e.NONE="none",e.FADE_IN="fadeIn",e.SLIDE_IN_FROM_LEFT="slideInFromLeft",e.SLIDE_IN_FROM_RIGHT="slideInFromRight"}(Rn||(Rn={})),function(e){e.NONE="none",e.FADE_OUT="fadeOut",e.SLIDE_OUT_TO_LEFT="slideOutToLeft",e.SLIDE_OUT_TO_RIGHT="slideOutToRight",e.SLIDE_OUT_TO_TOP="slideOutToTop"}(Mn||(Mn={}));var Ln,Hn,xn=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}();!function(e){e.DISCLAIMER="disclaimer",e.HOME_SCREEN="homeScreen",e.AGENT="agent",e.THREAD="thread",e.HYDRATING="hydrating"}(Hn||(Hn={}));var Fn=((Ln={})[Hn.DISCLAIMER]=99,Ln[Hn.HYDRATING]=90,Ln[Hn.HOME_SCREEN]=30,Ln[Hn.AGENT]=20,Ln[Hn.THREAD]=10,Ln),Vn=450,jn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isClosing:!1,isOpening:!1},t.openPanelTimeout=null,t.closePanelTimeout=null,t.openPanel=function(){var e=t.props,n=e.onOpenEnd,a=e.onOpenStart,r=e.animationOnOpen;a&&a(),t.setState({isClosing:!1,isOpening:!0});var o=r===Rn.NONE?0:Vn;t.openPanelTimeout=R()((function(){t.setState({isClosing:!1,isOpening:!1}),n&&n()}),o)},t.closePanel=function(){var e=t.props,n=e.onCloseEnd,a=e.onCloseStart,r=e.animationOnClose;a&&a(),t.setState({isClosing:!0,isOpening:!1});var o=r===Mn.NONE?0:Vn;t.closePanelTimeout=R()((function(){t.setState({isClosing:!1,isOpening:!1}),n&&n()}),o)},t}return xn(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.shouldOpen,n=e.onOpenStart,a=e.onOpenEnd;t&&(n&&n(),a&&a())},t.prototype.componentDidUpdate=function(e){var t=this.props.shouldOpen;t!==e.shouldOpen&&(t?this.openPanel():this.closePanel())},t.prototype.componentWillUnmount=function(){this.openPanelTimeout&&clearTimeout(this.openPanelTimeout),this.closePanelTimeout&&clearTimeout(this.closePanelTimeout)},t.prototype.render=function(){var e,t=this.props,n=t.children,a=t.className,o=t.shouldOpen,s=t.animationOnClose,i=t.animationOnOpen,c=t.overlayPanelName,l=this.state,u=l.isClosing,p=l.isOpening;return r.a.createElement("div",{className:E()("WAC__overlay-panel"+(a?" "+a:""),(e={WAC__hidden:!u&&!o},e["WAC__overlay-panel--closing--"+s]=u,e["WAC__overlay-panel--closed"]=!u&&!o,e["WAC__overlay-panel--opening--"+i]=p,e["WAC__overlay-panel--open"]=!p&&o,e)),style:{zIndex:Fn[c]}},n)},t}(a.PureComponent),Un=r.a.createContext(null),zn=n(363),Gn=n(536),qn=r.a.createContext(null),Kn=n(15),Yn=n(347),Jn=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),Xn=function(e,t,n,a){return new(n||(n=_.a))((function(r,o){function s(e){try{c(a.next(e))}catch(e){o(e)}}function i(e){try{c(a.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}c((a=a.apply(e,t||[])).next())}))},Qn=function(e,t){var n,a,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof m.a&&(o[p.a]=function(){return this}),o;function i(o){return function(i){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,a&&(r=2&o[0]?a.return:o[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,o[1])).done)return r;switch(a=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,a=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],a=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}},Zn=function(e){function t(t){var n=e.call(this,t)||this;n.buttonRef=r.a.createRef(),n.loadRevealAnimation=function(){return Xn(n,void 0,void 0,(function(){return Qn(this,(function(e){switch(e.label){case 0:return[4,Object(Yn.b)(300)];case 1:return e.sent(),this.setState({revealAnimationClass:"open"}),[4,Object(Yn.b)(1e4)];case 2:return e.sent(),this.setState({revealAnimationClass:"closing"}),[4,Object(Yn.b)(200)];case 3:return e.sent(),this.setState({revealAnimationClass:"closed"}),[2]}}))}))},n.requestFocus=function(){Object(k.c)(n.buttonRef,!0)},n.toggleLauncher=function(){n.props.onToggleOpen(),n.props.serviceManager.actions.track({eventName:"Widget Opened",eventDescription:"User has opened the widget.",launcherType:n.getActiveLauncherType()})},n.getActiveLauncherType=function(){var e,t,a,r=n.props.publicConfig;return(null===(e=r.__ibm__)||void 0===e?void 0:e.isCitizenIntegration)&&(null===(a=null===(t=r.__ibm__)||void 0===t?void 0:t.citizenIntegrationLauncherConfig)||void 0===a?void 0:a.is_on)?ie.c?Kn.b.SMALL:r.__ibm__.citizenIntegrationLauncherConfig.type||Kn.b.SMALL:"DEFAULT"};var a=n.getActiveLauncherType();return n.state={revealAnimationClass:a===Kn.b.REVEAL?"opening":null},n}return Jn(t,e),t.prototype.componentDidMount=function(){this.props.serviceManager.actions.track({eventName:"Widget Loaded",eventDescription:"The launcher button is rendered."}),this.getActiveLauncherType()===Kn.b.REVEAL&&this.loadRevealAnimation()},t.prototype.render=function(){var e,t,n,a,o,s,i=this.props,c=i.uuid,l=i.isOpen,u=i.languagePack,p=i.unreadAgentCount,d=i.intl,m=i.publicConfig,g=this.state.revealAnimationClass,_=l?u.launcher_isOpen:u.launcher_isClosed;0!==p&&(_+=". "+d.formatMessage({id:"icon_ariaUnreadMessages"},{count:p}));var h=this.getActiveLauncherType();return r.a.createElement("div",{className:E()("WACLauncher__ButtonContainer",{"WACLauncher__ButtonContainer--open":l})},r.a.createElement("button",{"aria-label":_,className:E()("WACLauncher__Button WACLauncher--"+c,"WAC__button--base","WAC__button--primary",{"WACLauncher__Button--small":h===Kn.b.SMALL,"WACLauncher__Button--large":h===Kn.b.LARGE||h===Kn.b.REVEAL,"WACLauncher__Button--reveal":h===Kn.b.REVEAL,"WACLauncher__Button--reveal--opening":h===Kn.b.REVEAL&&"opening"===g,"WACLauncher__Button--reveal--open":h===Kn.b.REVEAL&&"open"===g,"WACLauncher__Button--reveal--closing":h===Kn.b.REVEAL&&"closing"===g,"WACLauncher__Button--reveal--closed":h===Kn.b.REVEAL&&"closed"===g}),id:"WACLauncher__Button",type:"button",onClick:this.toggleLauncher,ref:this.buttonRef,style:"DEFAULT"!==h?{backgroundImage:"url('"+Object($.g)(m)+"/citizen/launcher.gif')"}:{}},"DEFAULT"===h&&r.a.createElement(Gn.a,{className:E()("WACLauncher__svg",{"WACLauncher__svg--open":l})}),(h===Kn.b.LARGE||h===Kn.b.REVEAL)&&r.a.createElement("div",{className:"WACLauncher__Button--launcher_text"},r.a.createElement(Z.a,{className:"WACLauncher__Button--launcher_title",canBeDangerous:!(null===(e=m.__ibm__)||void 0===e?void 0:e.isPreviewLink),html:null===(n=null===(t=m.__ibm__)||void 0===t?void 0:t.citizenIntegrationLauncherConfig)||void 0===n?void 0:n.title}),r.a.createElement(Z.a,{className:"WACLauncher__Button--launcher_body",canBeDangerous:!(null===(a=m.__ibm__)||void 0===a?void 0:a.isPreviewLink),html:null===(s=null===(o=m.__ibm__)||void 0===o?void 0:o.citizenIntegrationLauncherConfig)||void 0===s?void 0:s.body})),0!==p&&r.a.createElement("div",{className:"WAC__countIndicator"},p)))},t.contextType=qn,t}(a.PureComponent),$n=Object(b.injectIntl)(Zn,{forwardRef:!0}),ea=function(){var e=function(t,n){return(e=v.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?f()(n):(a.prototype=n.prototype,new a)}}(),ta=function(e,t,n,a){return new(n||(n=_.a))((function(r,o){function s(e){try{c(a.next(e))}catch(e){o(e)}}function i(e){try{c(a.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}c((a=a.apply(e,t||[])).next())}))},na=function(e,t){var n,a,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof m.a&&(o[p.a]=function(){return this}),o;function i(o){return function(i){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,a&&(r=2&o[0]?a.return:o[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,o[1])).done)return r;switch(a=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,a=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],a=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}},aa=new l.a(["Tab","Shift","Control","Alt","Meta","CapsLock","Fn"]),ra=function(e){function t(){var t,n=e.apply(this,arguments)||this;return n.state={closing:!1,open:n.props.persistedToBrowserStorage.isOpen,openedOnce:n.props.persistedToBrowserStorage.isOpen||n.props.config.public.openChatByDefault,modalPortalHostElement:null,numPanelsOpen:0,isHydrationAnimationComplete:n.props.isHydrated,shouldAutoFocus:!(null===(t=n.props.config.public.__ibm__)||void 0===t?void 0:t.isToolingPreview)},n.containerRef=r.a.createRef(),n.botChatRef=r.a.createRef(),n.agentChatRef=r.a.createRef(),n.processChatRef=r.a.createRef(),n.launcherRef=r.a.createRef(),n.homeScreenRef=r.a.createRef(),n.disclaimerRef=r.a.createRef(),n.previousBodyStyle=void 0,n.updateBody=function(){var e;ie.b&&((window.screen.width<=500||window.screen.height<=500)&&n.props.persistedToBrowserStorage.isOpen?(n.previousBodyStyle=null!=(e=document.body.getAttribute("style"))?e:null,document.body.style.setProperty("visibility","hidden","important"),document.body.style.setProperty("position","fixed","important")):void 0!==n.previousBodyStyle&&(null===n.previousBodyStyle?document.body.removeAttribute("style"):document.body.setAttribute("style",n.previousBodyStyle),n.previousBodyStyle=void 0))},n.onVisualViewportResize=function(){n.updateFromVisualViewport()},n.updateFromVisualViewport=function(){var e=n.props.wacContainerElement,t=window.visualViewport;if(t)e.style.setProperty("--WatsonAssistantChat-viewport-height",t.height+"px"),e.style.setProperty("--WatsonAssistantChat-viewport-width",t.width+"px"),e.style.setProperty("--WatsonAssistantChat-viewport-offsetTop",t.offsetTop+"px"),e.style.setProperty("--WatsonAssistantChat-viewport-offsetLeft",t.offsetLeft+"px");else{var a="100vh";if(ie.b)a="calc(100vh - "+Object(ie.e)()+"px)";e.style.setProperty("--WatsonAssistantChat-viewport-height",a),e.style.setProperty("--WatsonAssistantChat-viewport-width","100vw"),e.style.setProperty("--WatsonAssistantChat-viewport-offsetTop","0"),e.style.setProperty("--WatsonAssistantChat-viewport-offsetLeft","0")}},n.setModalPortalHostElement=function(e){n.state.modalPortalHostElement!==e&&n.setState({modalPortalHostElement:e})},n.onSendBotInput=function(e,t){var a=Object(Y.c)(e,t);n.props.serviceManager.actions.send(a,{trackEventProps:{eventName:"Assistant Message Received from User",eventDescription:"Dialog event for user giving input to bot.",type:"text"}})},n.onSendButtonInput=function(e,t){var a=Object(Y.b)(e,t);n.props.serviceManager.actions.send(a,{trackEventProps:{eventName:"Assistant Message Received from User",eventDescription:"Dialog event for user giving input to bot.",type:"text"}})},n.onSendAgentInput=function(e){var t=n.props.serviceManager,a=Object(Y.c)(e,j.c);t.humanAgentService.sendMessageToAgent(a)},n.removeChatFromDom=function(){n.containerRef.current.removeEventListener("animationend",n.removeChatFromDom),n.setState({open:!1,closing:!1})},n.onReset=function(){return ta(n,void 0,void 0,(function(){return na(this,(function(e){switch(e.label){case 0:return[4,this.props.serviceManager.actions.resetChat()];case 1:return e.sent(),this.doDefaultFocus(),[2]}}))}))},n.onToggleOpen=function(){return ta(n,void 0,void 0,(function(){return na(this,(function(e){switch(e.label){case 0:return[4,this.props.serviceManager.actions.toggleOpen()];case 1:return e.sent(),[2]}}))}))},n.onClose=function(){return ta(n,void 0,void 0,(function(){return na(this,(function(e){switch(e.label){case 0:return[4,this.props.serviceManager.actions.closeWindow()];case 1:return e.sent(),[2]}}))}))},n.onToggleAgentView=function(){n.props.setPanelOpen(!n.props.agentState.isPanelOpen);var e={eventName:"Human Chat Toggled",eventDescription:"User toggled chat between bot and human agent.",direction:n.props.agentState.isPanelOpen?"To agent":"To bot"};n.props.serviceManager.actions.track(e)},n.onToggleProcessView=function(e){var t=n.props.persistedToBrowserStorage;if(e||t.processState.isProcessPanelOpen){e&&n.props.serviceManager.actions.setCurrentProcess(e),t.processState.isProcessPanelOpen?n.props.serviceManager.actions.closeProcess():n.props.serviceManager.actions.openProcess(e);var a={eventName:"Process Toggled",eventDescription:"User toggled between main chat and a process.",direction:n.props.persistedToBrowserStorage.processState.isProcessPanelOpen?"To process":"To main chat"};n.props.serviceManager.actions.track(a)}},n.onClick=function(e){n.props.alternateSuggestionsState.isOpen&&(n.isInAlternateSuggestionsExclude(e.target)||n.props.serviceManager.store.dispatch(we.G.setAlternateSuggestionsOpen(!1,"Event")))},n.onKeyDown=function(e){n.props.alternateSuggestionsState.isOpen&&(aa.has(e.key)||n.isInAlternateSuggestionsExclude(e.target)||n.props.serviceManager.store.dispatch(we.G.setAlternateSuggestionsOpen(!1,"Event")))},n.doDefaultFocus=function(){n.state.shouldAutoFocus&&(n.props.persistedToBrowserStorage.isOpen?n.getShowDisclaimer()?n.disclaimerRef.current&&n.disclaimerRef.current.focus():n.getShowHomeScreen()?n.homeScreenRef.current&&n.homeScreenRef.current.takeFocus():n.props.agentState.isPanelOpen?n.agentChatRef.current&&n.agentChatRef.current.requestInputFocus():n.botChatRef.current&&n.botChatRef.current.requestInputFocus():n.launcherRef.current&&n.launcherRef.current.requestFocus())},n.onAcceptDisclaimer=function(){n.props.serviceManager.store.dispatch(we.G.acceptDisclaimer())},n.onPanelOpenStart=function(){n.setState((function(e){return{numPanelsOpen:e.numPanelsOpen+1}}),n.doDefaultFocus)},n.onPanelCloseStart=function(){n.setState((function(e){return{numPanelsOpen:e.numPanelsOpen-1}}),n.doDefaultFocus)},n.onHydrationPanelClose=function(){n.setState({isHydrationAnimationComplete:!0})},n}return ea(t,e),t.prototype.componentDidMount=function(){if(ie.c&&!this.props.config.public.disableCustomElementMobileEnhancements){var e=window.visualViewport;e&&(e.addEventListener("resize",this.onVisualViewportResize),e.addEventListener("scroll",this.updateFromVisualViewport)),this.updateFromVisualViewport(),this.updateBody()}},t.prototype.componentWillUnmount=function(){if(ie.c&&!this.props.config.public.disableCustomElementMobileEnhancements){var e=window.visualViewport;e&&(e.removeEventListener("resize",this.onVisualViewportResize),e.removeEventListener("scroll",this.updateFromVisualViewport))}},t.prototype.componentDidUpdate=function(e,t){var n,a=this,r=this.props,o=r.persistedToBrowserStorage,s=r.useCustomHostElement,i=this.state.open;o.isOpen!==e.persistedToBrowserStorage.isOpen&&(this.updateBody(),this.updateFromVisualViewport()),!o.isOpen||e.persistedToBrowserStorage.isOpen&&i?!o.isOpen&&e.persistedToBrowserStorage.isOpen&&t.open&&i&&(this.setState({closing:!0}),s?this.removeChatFromDom():this.containerRef.current.addEventListener("animationend",this.removeChatFromDom)):this.setState({open:!0,openedOnce:!0},(function(){a.doDefaultFocus()})),(null===(n=this.props.config.public.__ibm__)||void 0===n?void 0:n.isToolingPreview)&&(e.persistedToBrowserStorage.hasSentNonWelcomeMessage||!this.props.persistedToBrowserStorage.hasSentNonWelcomeMessage||this.state.shouldAutoFocus?e.botMessageState.messageIDs.length>this.props.botMessageState.messageIDs.length&&this.state.shouldAutoFocus&&this.setState({shouldAutoFocus:!1}):this.setState({shouldAutoFocus:!0}))},t.prototype.isInAlternateSuggestionsExclude=function(e){return Object(k.i)(e,"data-wac-alternate-suggestions-exclude","true",this.containerRef.current)},t.prototype.getShowHomeScreen=function(){return this.props.homeScreenConfig.is_on&&this.props.persistedToBrowserStorage.homeScreenState.isHomeScreenOpen&&!this.getShowDisclaimer()},t.prototype.getShowDisclaimer=function(){var e;return(null===(e=this.props.config.public.disclaimer)||void 0===e?void 0:e.isOn)&&!this.props.persistedToBrowserStorage.disclaimersAccepted[window.location.hostname]},t.prototype.getHideCloseButton=function(){var e=this.props.config;return e.public&&e.public.hideCloseButton||e.public.__ibm__.isPreviewLink},t.prototype.doAutoScroll=function(){var e;(e=this.props.agentState.isPanelOpen?this.agentChatRef.current:this.processChatRef.current?this.processChatRef.current:this.botChatRef.current)&&e.doAutoScroll()},t.prototype.renderChat=function(){var e=this.props.isHydrated;return r.a.createElement(r.a.Fragment,null,this.renderHydrationPanel(),this.renderDisclaimerPanel(),this.renderHomeScreenPanel(),e&&this.renderAgentPanel(),e&&this.renderThreadPanel(),this.renderBotChat())},t.prototype.renderBotChat=function(){var e=this.props,t=e.botName,n=e.botAvatarURL,a=e.languagePack,o=e.config,s=e.serviceManager,i=e.uuid,c=e.botMessageState,l=e.agentState,u=e.persistedToBrowserStorage,p=e.processesByID,d=e.allMessagesByID,m=e.showWelcomeError,g=e.sentMessagePercentage,_=e.featureSet,h=e.isHydrated,f=e.homeScreenConfig,C=e.alternateSuggestionsState,v=this.state,A=v.numPanelsOpen,b=v.isHydrationAnimationComplete,S=this.getHideCloseButton(),W=this.getShowDisclaimer(),N=A>0,w=o.public.__ibm__.isCitizenIntegration&&!f.is_on&&!u.hasSentNonWelcomeMessage&&!this.props.config.public.isAgentApp;return r.a.createElement("div",{className:E()("WACBotContainer",{WAC__hidden:N})},r.a.createElement(Wn,{botName:t,botAvatarURL:n,ref:this.botChatRef,languagePack:a,config:o,serviceManager:s,isPreviewLink:o.public.__ibm__.isPreviewLink,uuid:i,hideCloseButton:S,onClose:this.onClose,onToggleAgentView:this.onToggleAgentView,onToggleProcessView:this.onToggleProcessView,withHumanAgent:!1,isProcess:!1,threadID:y.b,messageState:c,onSendInput:this.onSendBotInput,agentState:l,processState:u.processState,processesByID:p,isVisible:!l.isPanelOpen,allMessagesByID:d,showWelcomeError:m,sentMessagePercentage:g,onReset:this.onReset,alternateSuggestionsState:C,featureSet:_,isHydrated:h,isHydrationAnimationComplete:b&&!W,isCitizenIntegration:o.public.__ibm__.isCitizenIntegration,showCitizenHomeScreen:w,homeScreenConfig:f}))},t.prototype.renderHydrationPanel=function(){var e=this.props,t=e.homeScreenConfig,n=e.isHydrated,a=e.config,o=e.showWelcomeError,s=e.serviceManager;return r.a.createElement(jn,{onOpenStart:this.onPanelOpenStart,onCloseStart:this.onPanelCloseStart,onCloseEnd:this.onHydrationPanelClose,animationOnOpen:Rn.NONE,animationOnClose:t.is_on||a.public.__ibm__.isCitizenIntegration?Mn.SLIDE_OUT_TO_TOP:Mn.FADE_OUT,shouldOpen:!n&&!o,serviceManager:s,overlayPanelName:Hn.HYDRATING},r.a.createElement(Dn,{homeScreenConfig:t,isCitizenIntegration:a.public.__ibm__.isCitizenIntegration}))},t.prototype.renderDisclaimerPanel=function(){var e,t,n=this.props,a=n.featureSet,o=n.serviceManager,s=n.languagePack,i=n.botName,c=n.botAvatarURL,l=n.config,u=this.getShowDisclaimer(),p=this.getHideCloseButton();return(null===(e=l.public.disclaimer)||void 0===e?void 0:e.isOn)&&r.a.createElement(jn,{onOpenStart:this.onPanelOpenStart,onCloseStart:this.onPanelCloseStart,animationOnOpen:Rn.NONE,animationOnClose:Mn.FADE_OUT,shouldOpen:u,serviceManager:o,overlayPanelName:Hn.DISCLAIMER},r.a.createElement(Nn,{onAcceptDisclaimer:this.onAcceptDisclaimer,onClose:this.onClose,languagePack:s,disclaimerHTML:null===(t=l.public.disclaimer)||void 0===t?void 0:t.disclaimerHTML,serviceManager:o,botName:i,botAvatarURL:c,hideCloseButton:p,onReset:this.onReset,publicConfig:l.public,featureSet:a,disclaimerAcceptButtonRef:this.disclaimerRef}))},t.prototype.renderHomeScreenPanel=function(){var e,t=this.props,n=t.serviceManager,a=t.languagePack,o=t.homeScreenConfig,s=t.botName,i=t.botAvatarURL,c=t.agentState,l=t.persistedToBrowserStorage,u=t.processesByID,p=t.config,d=t.featureSet,m=this.state.isHydrationAnimationComplete,g=this.getHideCloseButton(),_=this.getShowHomeScreen();return r.a.createElement(jn,{onOpenStart:this.onPanelOpenStart,onCloseStart:this.onPanelCloseStart,animationOnOpen:Rn.NONE,animationOnClose:Mn.FADE_OUT,shouldOpen:_,serviceManager:n,overlayPanelName:Hn.HOME_SCREEN},r.a.createElement(Pn,{onClose:this.onClose,languagePack:a,serviceManager:n,homeScreenConfig:o,onSendInput:this.onSendBotInput,onSendButtonInput:this.onSendButtonInput,botName:s,botAvatarURL:i,hideCloseButton:g,onToggleAgentView:this.onToggleAgentView,onToggleProcessView:this.onToggleProcessView,withHumanAgent:!1,isProcess:!1,agentState:c,processState:l.processState,processesByID:u,onReset:this.onReset,isCitizenIntegration:null===(e=p.public.__ibm__)||void 0===e?void 0:e.isCitizenIntegration,featureSet:d,isHydrationAnimationComplete:m,homeScreenMessageInputRef:this.homeScreenRef}))},t.prototype.renderAgentPanel=function(){var e=this.props,t=e.serviceManager,n=e.botName,a=e.botAvatarURL,o=e.languagePack,s=e.config,i=e.agentMessageState,c=e.agentState,l=e.persistedToBrowserStorage,u=e.processesByID,p=e.allMessagesByID,d=e.featureSet,m=e.sentMessagePercentage,g=e.uuid,_=this.getHideCloseButton();return r.a.createElement(r.a.Fragment,null,r.a.createElement(jn,{onOpenStart:this.onPanelOpenStart,onCloseStart:this.onPanelCloseStart,animationOnOpen:Rn.SLIDE_IN_FROM_RIGHT,animationOnClose:Mn.SLIDE_OUT_TO_RIGHT,shouldOpen:c.isPanelOpen,serviceManager:t,overlayPanelName:Hn.AGENT,className:"WACAgentContainer"},r.a.createElement(Wn,{botName:n,botAvatarURL:a,ref:this.agentChatRef,languagePack:o,config:s,serviceManager:t,isPreviewLink:s.public.__ibm__.isPreviewLink,uuid:g,isHydrated:!0,hideCloseButton:_,onClose:this.onClose,onToggleAgentView:this.onToggleAgentView,onToggleProcessView:this.onToggleProcessView,withHumanAgent:!0,isProcess:!1,threadID:j.c,messageState:i,onSendInput:this.onSendAgentInput,agentState:c,processState:l.processState,processesByID:u,isVisible:c.isPanelOpen,allMessagesByID:p,showWelcomeError:null,sentMessagePercentage:m,onReset:this.onReset,featureSet:d,alternateSuggestionsState:null})))},t.prototype.renderThreadPanel=function(){var e=this.props,t=e.serviceManager,n=e.botName,a=e.botAvatarURL,o=e.agentState,s=e.languagePack,i=e.persistedToBrowserStorage,c=e.processesByID,l=e.config,u=e.featureSet,p=e.uuid,d=e.allMessagesByID,m=e.showWelcomeError,g=e.sentMessagePercentage;return u[te.a.THREADS]&&r.a.createElement(jn,{onOpenStart:this.onPanelOpenStart,onCloseStart:this.onPanelCloseStart,animationOnOpen:Rn.SLIDE_IN_FROM_RIGHT,animationOnClose:Mn.SLIDE_OUT_TO_RIGHT,shouldOpen:i.processState.isProcessPanelOpen,serviceManager:t,overlayPanelName:Hn.THREAD,className:"WACProcessContainer"},i.processState.currentViewedProcessId&&r.a.createElement(Wn,{botName:n,botAvatarURL:a,ref:this.processChatRef,languagePack:s,config:l,serviceManager:t,isPreviewLink:l.public.__ibm__.isPreviewLink,uuid:p,hideCloseButton:!0,isHydrated:!0,onClose:this.onClose,onToggleAgentView:this.onToggleAgentView,onToggleProcessView:this.onToggleProcessView,withHumanAgent:!1,isProcess:!0,threadID:i.processState.currentViewedProcessId,messageState:c[i.processState.currentViewedProcessId],onSendInput:this.onSendBotInput,agentState:o,processState:i.processState,processesByID:c,isVisible:i.processState.isProcessPanelOpen,allMessagesByID:d,showWelcomeError:m,sentMessagePercentage:g,onReset:this.onReset,featureSet:u,alternateSuggestionsState:null}))},t.prototype.renderWithContexts=function(){var e=this.props,t=e.agentState,n=e.serviceManager,a=e.config,o=e.useCustomHostElement,s=e.languagePack,i=e.uuid,c=this.state,l=c.closing,u=c.open,p=c.openedOnce,d=a.public;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{id:"WACWidget",className:E()("WACWidget",{"WACWidget--defaultElement":!o,"WACWidget--launched":!l,"WACWidget--closing":l,"WACWidget--closed":!u}),"aria-label":s.window_title,ref:this.containerRef,onClick:this.onClick,onKeyDown:this.onKeyDown},r.a.createElement("div",{className:"WACWidget__animationContainer"},p&&this.renderChat()),r.a.createElement("div",{className:"WACWidget__modalPortalHost",ref:this.setModalPortalHostElement})),d&&d.showLauncher&&r.a.createElement($n,{serviceManager:n,ref:this.launcherRef,uuid:i,languagePack:s,isOpen:this.props.persistedToBrowserStorage.isOpen,onToggleOpen:this.onToggleOpen,unreadAgentCount:t.numUnreadMessages,publicConfig:d}))},t.prototype.render=function(){var e=this.props,t=e.languagePack,n=e.locale,a=this.state.modalPortalHostElement;return r.a.createElement(b.IntlProvider,{locale:n,messages:t},r.a.createElement(Un.Provider,{value:t},r.a.createElement(re.Provider,{value:a},r.a.createElement(F,null,this.renderWithContexts()))),r.a.createElement(B.a,{id:"a11y-status-message",role:"status","aria-live":"polite","aria-relevant":"additions text"}))},t}(a.Component),oa=Object(i.connect)((function(e){return e}),{setPanelOpen:zn.r},null,{forwardRef:!0})(ra),sa=n(414);function ia(e,t,n,a,o,c){var l=e.store.getState(),u=l.userID,p=l.persistedToBrowserStorage,d=l.config,m=p.sessionID,g=d.public.__ibm__.isPreviewLink,_=d.remote.initConfig.service_instance_id||d.public.serviceInstanceID||sa.a,h=e.trackService.getTrackID(_,u,m);s.a.render(r.a.createElement(i.Provider,{store:e.store},r.a.createElement(W.Provider,{value:e},r.a.createElement(qn.Provider,{value:{trackUserID:h,isPreviewLink:g}},r.a.createElement(oa,{ref:c,useCustomHostElement:t,uuid:o,serviceManager:e,wacContainerElement:a})))),n)}Object(J.a)(ia);t.default=ia}}]);