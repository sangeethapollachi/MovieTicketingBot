/*!
 * 
 * (C) Copyright IBM Corp. 2017 - 2020. All Rights Reserved.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 * 
 * watson-web-channel 3.2.0
 * Contributors: Ethan Winters, Raymond Chu, Karen Harris, Ashley Lord, Amy Zhong, Ryan Simpson, Anthony Wong, Wilson Wong, David G Terry, Simon Burns, Damon Lundin, John Engstrom, Neil Mallinar
 * Built: Oct 27 2020 1:20 pm +00:00
 * 
 * 
 */
(window.webpackJsonpWatsonAssistantChat=window.webpackJsonpWatsonAssistantChat||[]).push([[68],{356:function(e,t,n){"use strict";n.d(t,"b",(function(){return f})),n.d(t,"a",(function(){return v}));var s,r=n(11),a=n.n(r),i=n(12),o=n.n(i),c=n(1),u=n.n(c),l=n(37),d=n.n(l),g=n(2),p=function(e,t,n,s){return new(n||(n=u.a))((function(r,a){function i(e){try{c(s.next(e))}catch(e){a(e)}}function o(e){try{c(s.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,o)}c((s=s.apply(e,t||[])).next())}))},h=function(e,t){var n,s,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof o.a&&(i[a.a]=function(){return this}),i;function u(a){return function(i){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,s&&(r=2&a[0]?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++,s=a[1],a=[0];continue;case 7:a=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){c=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){c.label=a[1];break}if(6===a[0]&&c.label<r[1]){c.label=r[1],r=a;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(a);break}r[2]&&c.ops.pop(),c.trys.pop();continue}a=t.call(e,c)}catch(e){a=[6,e],s=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}};function f(e){return d()(e).format("LL")}function v(){var e;return p(this,void 0,void 0,(function(){var t;return h(this,(function(r){switch(r.label){case 0:return s?[3,3]:(t=(null===(e=Intl)||void 0===e?void 0:e.DateTimeFormat)&&"function"==typeof Intl.DateTimeFormat().resolvedOptions?Intl.DateTimeFormat().resolvedOptions().timeZone:void 0)?(s=t,[3,3]):[3,1];case 1:return[4,n.e(8).then(n.t.bind(null,423,7)).then((function(e){return e.default.determine().name()})).catch((function(e){Object(g.b)("[getTimeZoneLegacy]",e)}))];case 2:s=r.sent(),r.label=3;case 3:return[2,s]}}))}))}},357:function(e,t,n){"use strict";var s;n.d(t,"a",(function(){return s})),function(e){e.NEVER="never",e.ALWAYS="always",e.ONE_STRIKE="one_strike"}(s||(s={}))},364:function(e,t,n){"use strict";n.d(t,"c",(function(){return l})),n.d(t,"b",(function(){return d})),n.d(t,"a",(function(){return g}));var s=n(351),r=n.n(s),a=n(353),i=n(18),o=n(21),c=n(28),u=n(356);function l(e,t,n,s,i){var l=Object(o.a)(c.a.LOCAL_MESSAGE);t.history||(t.history={}),t.history.timestamp||(t.history.timestamp=r()());var d={ui_state:{id:l,partOfMessageID:i||l,localizedDate:Object(u.b)(t.history.timestamp),fromHistory:n,processLauncher:!1,errorState:a.a.NONE,needsAnnouncement:!n},message:e,originalMessage:t};return s&&(d.ui_state.isLatestWelcomeNode=!0),d}function d(e,t){var n={response_type:e};return l(n,{id:Object(o.a)(c.a.MESSAGE),request_id:null,thread_id:t,output:{generic:[n]}},!1,!1,null)}function g(e,t){var n={response_type:i.b.INLINE_ERROR,text:e};return l(n,{id:Object(o.a)(c.a.MESSAGE),request_id:null,thread_id:t,output:{generic:[n]}},!1,!1,null)}},365:function(e,t,n){"use strict";var s=n(351),r=n.n(s),a=n(13),i=n.n(a),o=n(7),c=n(353),u=n(21),l=n(28),d=n(356),g=function(){return(g=i.a||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};t.a=function(e,t,n,s){return void 0===s&&(s=Object(u.a)(l.a.LOCAL_MESSAGE)),e.history||(e.history={}),e.history.timestamp||(e.history.timestamp=r()()),{message:g({response_type:o.b.TEXT},e.input),ui_state:{id:s,partOfMessageID:s,localizedDate:Object(d.b)(e.history.timestamp),fromHistory:n,processLauncher:!1,errorState:c.a.NONE,originalUserText:t,needsAnnouncement:!1},originalMessage:e}}},366:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return c})),n.d(t,"d",(function(){return l})),n.d(t,"c",(function(){return u})),n.d(t,"e",(function(){return d}));var s=n(357),r=n(352),a=n(88),i=n(350),o=function(e){return{label:e,value:{input:{text:e}}}},c=function(e){return{isSelected:!1,isContactSuggestion:!0,option:o(e)}};function u(e,t){return e.contact_label||t.suggestions_connectToAgent}function l(e,t,n){return(2!==t.alternateSuggestionsState.numStrikes||!t.agentState.isConnecting&&!t.agentState.isConnected)&&(Object(a.j)(e)?(n&&(n.suggestionsStrikeReason="Anything Else"),!0):!!function(e,t){var n,s,o,c;if(Object(a.q)(t)){for(var u=e.allMessagesByID,l=e.botMessageState.messageIDs,d=l.length-1,g=void 0;d>=0;d--){var p=u[l[d]].originalMessage;if(p!==t&&Object(a.q)(p)){g=p;break}}if(g){var h=null===(s=Object(r.a)(null===(n=t.output.debug)||void 0===n?void 0:n.nodes_visited))||void 0===s?void 0:s.dialog_node,f=null===(c=Object(r.a)(null===(o=g.output.debug)||void 0===o?void 0:o.nodes_visited))||void 0===c?void 0:c.dialog_node;if(h&&h===f)return!Object(i.c)(t).digressed}}return!1}(t,e)&&(n&&(n.suggestionsStrikeReason="Bot Repeating"),!0))}function d(e,t){var n=t.alternateSuggestionsState,r=n.numStrikes,a=n.config;return a.is_on&&a.contact_option!==s.a.NEVER&&2===r&&l(e,t)}},367:function(e,t,n){"use strict";var s;n.d(t,"a",(function(){return s})),function(e){e.PRE_RECEIVE="pre:receive",e.RECEIVE="receive",e.PRE_SEND="pre:send",e.SEND="send",e.WINDOW_PRE_CLOSE="window:pre:close",e.WINDOW_OPEN="window:open",e.WINDOW_CLOSE="window:close",e.CUSTOM_RESPONSE="customResponse",e.ERROR="error",e.PROCESS_OPEN="process:open",e.PROCESS_CLOSE="process:close",e.PROCESS_CANCEL="process:cancel",e.HISTORY_BEGIN="history:begin",e.HISTORY_END="history:end",e.IDENTITY_EXPIRED="identityTokenExpired",e.PRE_RESET="pre:reset",e.RESET="reset",e.ALL_EVENTS="*"}(s||(s={}))},368:function(e,t,n){"use strict";var s=n(89),r=n.n(s),a=n(2),i=n(57),o=n.n(i),c={},u={getItem:function(e){return c[e]},setItem:function(e,t){c[e]=t},removeItem:function(e){delete c[e]},length:o()(c).length,clear:function(){c={}},key:function(e){return o()(c)[e]}};n.d(t,"e",(function(){return f})),n.d(t,"c",(function(){return g})),n.d(t,"a",(function(){return v})),n.d(t,"d",(function(){return p})),n.d(t,"b",(function(){return h}));var l="IBM_WAC_SESSION_ID_",d=window.sessionStorage||u;function g(e){void 0===e&&(e=null);try{var t=d.getItem(S(e));return t?JSON.parse(t):null}catch(t){return v(e),null}}function p(e,t){void 0===e&&(e=null);try{d.setItem(S(e),r()(t))}catch(e){Object(a.b)(e)}}function h(e){void 0===e&&(e=null);try{var t=d.getItem(S(e));return t?JSON.parse(t):null}catch(t){return v(e),null}}function f(e,t){void 0===e&&(e=null);try{d.setItem(S(e),r()(t))}catch(e){Object(a.b)(e)}}function v(e){void 0===e&&(e=null);try{d.removeItem(S(e))}catch(e){Object(a.b)(e)}}function S(e){return void 0===e&&(e=null),""+l+e}},376:function(e,t,n){e.exports=n(394)},377:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var s=n(1),r=n.n(s);function a(){var e,t,n=new r.a((function(n,s){e=n,t=s}));return n.doResolve=function(t){n.isResolved=!0,e(t)},n.doReject=function(e){n.isRejected=!0,t(e)},n.isResolved=!1,n.isRejected=!1,n}},378:function(e,t,n){"use strict";n.d(t,"b",(function(){return d})),n.d(t,"a",(function(){return p})),n.d(t,"d",(function(){return h})),n.d(t,"c",(function(){return g}));var s=n(23),r=n.n(s),a=n(38),i=n(368),o=n(357),c=n(366),u=n(88),l=n(30);function d(e){var t=e.store,n=0;return function(){var s=t.getState(),r=s.alternateSuggestionsState,i=r.numStrikes,l=r.config;if(3===i&&i!==n&&l.contact_option!==o.a.NEVER){var d=s.languagePack,g=Object(c.c)(l,d),p=Object(u.b)(Object(c.a)(g),a.b);e.actions.send(p,{silent:!0,isSuggestion:!0})}n=i}}function g(e){var t=e.humanAgentService,n=e.store,s=n.getState();return t.updateState({sessionID:s.persistedToBrowserStorage.sessionID,userID:s.userID,locale:s.locale}),function(){var e=n.getState();e.persistedToBrowserStorage.sessionID===s.persistedToBrowserStorage.sessionID&&e.userID===s.userID&&e.locale===s.locale||t.updateState({sessionID:e.persistedToBrowserStorage.sessionID,userID:e.userID,locale:e.locale}),s=e}}function p(e,t){var n=e.getState().persistedToBrowserStorage;return function(){var s=e.getState(),r=s.persistedToBrowserStorage,a=s.userID;if(n!==r)if(n=r,t){var o=r.disclaimersAccepted,c=r.version;Object(i.d)(a,{disclaimersAccepted:o,version:c})}else Object(i.e)(a,r)}}function h(e){var t=e.store;return function(){var n=t.getState().pendingLogs,s=n.trackEvents,a=n.autoLearning;(a.length||s.length)&&(r()(s).call(s,(function(t){e.trackService.track(t)})),r()(a).call(a,(function(t){e.messageService.sendAutoLearningMessage(t)})),t.dispatch(l.G.setAppStateValue("pendingLogs",{trackEvents:[],autoLearning:[]})))}}},394:function(e,t,n){e.exports=n(395)},395:function(e,t,n){n(396),n(99),n(97),n(68);var s=n(9);e.exports=s.Map},396:function(e,t,n){"use strict";var s=n(373),r=n(374);e.exports=s("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),r,!0)},397:function(e,t,n){"use strict";var s=n(398);function r(e){this.message=e}r.prototype=new Error,r.prototype.name="InvalidTokenError",e.exports=function(e,t){if("string"!=typeof e)throw new r("Invalid token specified");var n=!0===(t=t||{}).header?0:1;try{return JSON.parse(s(e.split(".")[n]))}catch(e){throw new r("Invalid token specified: "+e.message)}},e.exports.InvalidTokenError=r},398:function(e,t,n){var s=n(399);e.exports=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(s(e).replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(t)}catch(e){return s(t)}}},399:function(e,t){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function s(e){this.message=e}s.prototype=new Error,s.prototype.name="InvalidCharacterError",e.exports="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new s("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,a,i=0,o=0,c="";a=t.charAt(o++);~a&&(r=i%4?64*r+a:a,i++%4)?c+=String.fromCharCode(255&r>>(-2*i&6)):0)a=n.indexOf(a);return c}},400:function(e,t,n){"use strict";n.d(t,"c",(function(){return l})),n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return g}));var s=n(401),r=n.n(s),a=n(21),i=n(28),o=45,c="anonymous_IBMuid-",u="IBM_WAC_ANONYMOUS_USER_ID";function l(){var e,t,n,s;try{var a=null===(t=null===(e=window)||void 0===e?void 0:e.localStorage)||void 0===t?void 0:t.getItem(u);a&&(window.localStorage.removeItem(u),r.a.set(u,a,{expires:o,sameSite:"lax"}))}catch(e){}var i=(null===(s=null===(n=window)||void 0===n?void 0:n.sessionStorage)||void 0===s?void 0:s.getItem(u))||r.a.get(u);return i&&d(i),i||null}function d(e){var t;r.a.set(u,e,{expires:o,sameSite:"lax"}),!r.a.get(u)&&(null===(t=window)||void 0===t?void 0:t.sessionStorage)&&window.sessionStorage.setItem(u,e)}function g(){var e=""+c+Object(a.a)(i.a.USER);return d(e),e}function p(){var e;r.a.remove(u),(null===(e=window)||void 0===e?void 0:e.sessionStorage)&&window.sessionStorage.removeItem(u)}},401:function(e,t,n){var s,r;
/*!
 * JavaScript Cookie v2.2.1
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */!function(a){if(void 0===(r="function"==typeof(s=a)?s.call(t,n,t,e):s)||(e.exports=r),!0,e.exports=a(),!!0){var i=window.Cookies,o=window.Cookies=a();o.noConflict=function(){return window.Cookies=i,o}}}((function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var s in n)t[s]=n[s]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function n(s){function r(){}function a(t,n,a){if("undefined"!=typeof document){"number"==typeof(a=e({path:"/"},r.defaults,a)).expires&&(a.expires=new Date(1*new Date+864e5*a.expires)),a.expires=a.expires?a.expires.toUTCString():"";try{var i=JSON.stringify(n);/^[\{\[]/.test(i)&&(n=i)}catch(e){}n=s.write?s.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var o="";for(var c in a)a[c]&&(o+="; "+c,!0!==a[c]&&(o+="="+a[c].split(";")[0]));return document.cookie=t+"="+n+o}}function i(e,n){if("undefined"!=typeof document){for(var r={},a=document.cookie?document.cookie.split("; "):[],i=0;i<a.length;i++){var o=a[i].split("="),c=o.slice(1).join("=");n||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var u=t(o[0]);if(c=(s.read||s)(c,u)||t(c),n)try{c=JSON.parse(c)}catch(e){}if(r[u]=c,e===u)break}catch(e){}}return e?r[e]:r}}return r.set=a,r.get=function(e){return i(e,!1)},r.getJSON=function(e){return i(e,!0)},r.remove=function(t,n){a(t,"",e(n,{expires:-1}))},r.defaults={},r.withConverter=n,r}((function(){}))}))},422:function(e,t,n){"use strict";n.d(t,"a",(function(){return v})),n.d(t,"b",(function(){return S})),n.d(t,"c",(function(){return b}));var s=n(372),r=n.n(s),a=n(11),i=n.n(a),o=n(12),c=n.n(o),u=n(1),l=n.n(u),d=n(347),g=n(2),p=function(e,t,n,s){return new(n||(n=l.a))((function(r,a){function i(e){try{c(s.next(e))}catch(e){a(e)}}function o(e){try{c(s.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,o)}c((s=s.apply(e,t||[])).next())}))},h=function(e,t){var n,s,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof c.a&&(a[i.a]=function(){return this}),a;function u(a){return function(i){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,s&&(r=2&a[0]?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,s=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],s=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}},f=new r.a([200]);function v(e,t,n){return p(this,void 0,void 0,(function(){var s,r,a,i;return h(this,(function(o){switch(o.label){case 0:s=1,o.label=1;case 1:if(!(s-1<=t.length))return[3,9];o.label=2;case 2:return o.trys.push([2,4,,8]),[4,e(s)];case 3:return[2,o.sent()];case 4:if(r=o.sent(),s-1!==t.length)return[3,5];throw a='The operation "'+n+'" failed after '+s+" attempts and will not be retried.",Object(g.b)(a,r),new Error(a);case 5:return i=t[s-1],Object(g.b)('The operation "'+n+'" failed after '+s+" attempts will be retried in "+i+"ms.",r),[4,Object(d.b)(i)];case 6:o.sent(),o.label=7;case 7:return[3,8];case 8:return s++,[3,1];case 9:throw new Error('Unexpected retry state for operation "'+n+'".')}}))}))}function S(e,t,n,s){return p(this,void 0,void 0,(function(){return h(this,(function(r){return[2,Object(d.a)(v(e,t,n),s)]}))}))}function b(e,t){return void 0===t&&(t=f),p(this,void 0,void 0,(function(){var n;return h(this,(function(s){switch(s.label){case 0:return[4,e];case 1:if(n=s.sent(),!t.has(n.status))throw new Error("Status code error "+n.status);return[2,e]}}))}))}},507:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return ee}));var s=n(89),r=n.n(s),a=n(508),i=n.n(a),o=n(11),c=n.n(o),u=n(12),l=n.n(u),d=n(1),g=n.n(d),p=n(13),h=n.n(p),f=n(22),v=n.n(f),S=n(397),b=n.n(S),y=n(105),m=n.n(y),O=n(40),w=n.n(O),M=n(38),E=n(7),I=n(365),T=n(364),_=n(400),D=n(422),B=n(368),R=n(30),j=n(363),C=n(93),A=n(378),P=n(367),k=n(354),N=n(18),x=n(366),L=n(91),G=n(34),U=n(0),q=n(104),W=n(352),V=n(347),H=n(21),F=n(28),Y=n(88),z=n(2),J=n(350),X=n(110),Q=n(356),Z=function(){return(Z=h.a||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},K=function(e,t,n,s){return new(n||(n=g.a))((function(r,a){function i(e){try{c(s.next(e))}catch(e){a(e)}}function o(e){try{c(s.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,o)}c((s=s.apply(e,t||[])).next())}))},$=function(e,t){var n,s,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof l.a&&(a[c.a]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,s&&(r=2&a[0]?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,s=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(r=(r=i.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){i.label=a[1];break}if(6===a[0]&&i.label<r[1]){i.label=r[1],r=a;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(a);break}r[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],s=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}},ee=function(){function t(e){this.defaultSendTrackEventProps={eventName:"Send method called",eventDescription:"Data was sent to Watson Assistant and did not have a tracking event attached. Usually, this is someone calling via the API."},this.serviceManager=e}return t.prototype.hydrateChat=function(e){var t,n;return K(this,void 0,void 0,(function(){var s,r,a,o,c,u,l,d,p,h,f,v=this;return $(this,(function(S){switch(S.label){case 0:return s=function e(t,n){void 0===n&&(n=!0);var s,r;return K(this,void 0,void 0,(function(){var a,i,o,c,u,l,d,g,p;return $(this,(function(h){switch(h.label){case 0:return a=t.store.getState(),i=a.identityToken,o=a.config,c=o.public,null===(s=o.remote.initConfig.authorization)||void 0===s||!s.is_on||i?[3,2]:[4,te(t)];case 1:h.sent(),h.label=2;case 2:return u=Object(G.h)(c,!1),l={headers:Object(z.a)({accept:"application/json","X-Global-Transaction-ID":Object(H.a)()})},i&&(l.headers.authorization="Bearer "+i),[4,Object(D.a)((function(){return Object(G.f)(u,l)}),[100,1e3,2e3,5e3],"fetch main config")];case 3:if(!(d=h.sent())||d.ok)return[3,6];if(n)return[3,4];throw g='The configuration for integrationID "'+c.integrationID+'" requires a valid identityToken. The chat widget will not be displayed.',Object(z.b)(g),new Error(U.e+"  "+g);case 4:return[4,te(t)];case 5:return h.sent(),[2,e(t,!1)];case 6:if(!d)throw new Error(U.e+"  The main configuration data could not be loaded.");return[4,d.json()];case 7:return p=h.sent(),[2,(null===(r=p)||void 0===r?void 0:r.service_desk)?{service_desk:p.service_desk.config}:{}]}}))}))}(this.serviceManager),r=this.serviceManager.historyService.loadHistory(),a=this.serviceManager.store.getState(),[4,g.a.all([s,r])];case 1:return o=S.sent(),c=o[0],u=o[1],l=a.config,d=a.featureSet,p=a.userID,h=Object(B.c)(p),d[k.a.SESSION_HISTORY]&&(!u||h&&h.version!==U.d)&&this.serviceManager.store.dispatch(R.G.setAppStateValue("persistedToBrowserStorage",Z(Z({},C.e),{isOpen:this.serviceManager.store.getState().persistedToBrowserStorage.isOpen}))),u?[3,4]:(f=this.serviceManager.store.getState(),(null===(t=f.homeScreenConfig)||void 0===t?void 0:t.is_on)||(null===(n=f.botMessageState.messageIDs)||void 0===n?void 0:n.length)?[3,3]:[4,this.serviceManager.actions.send(Object(Y.e)())]);case 2:S.sent(),S.label=3;case 3:return[3,6];case 4:return[4,Object(W.c)(i()(u.allMessagesByID),(function(e){return v.createElementForCustomResponse(e)}))];case 5:S.sent(),this.serviceManager.store.dispatch(R.G.hydrateHistory(u)),S.label=6;case 6:return this.serviceManager.store.dispatch(R.G.chatWasHydrated(c)),l.public.isAgentApp||e||!this.serviceManager.humanAgentService?[3,8]:[4,this.serviceManager.humanAgentService.initialize()];case 7:S.sent(),this.serviceManager.store.subscribe(Object(A.c)(this.serviceManager)),S.label=8;case 8:return[2]}}))}))},t.prototype.addTimeZoneToMessage=function(e){return K(this,void 0,void 0,(function(){var t,n,s;return $(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),t=e.context.global.system,(n=e.context.global.system.timezone)?[3,2]:[4,Object(Q.a)()];case 1:n=r.sent(),r.label=2;case 2:return t.timezone=n,[3,4];case 3:return s=r.sent(),Object(z.b)("Unable to add local timezone to context.",s),[3,4];case 4:return[2]}}))}))},t.prototype.getLastResponse=function(e,t){var n,s=(null===(n=Object(C.l)(e,t))||void 0===n?void 0:n.originalMessages)||[];return Object(W.d)(s,Y.q)},t.prototype.copyPreviousContextToMessage=function(e){var t,n,s,a,i,o,c=this.serviceManager.store.getState(),u=e.history&&e.history.getWelcome,l=c.featureSet,d=c.persistedToBrowserStorage.processState.isProcessPanelOpen?U.a.THREAD:U.a.BOT,g=null===(s=this.getLastResponse(c,d))||void 0===s?void 0:s.context;if(u||!g){var p={global:{system:{}},skills:{"main skill":{system:{},user_defined:{}}}};e.context=w()({},p,e.context)}else{var h=Object(J.b)(g);p={global:{system:{}},skills:(t={},t[h]={system:{},user_defined:{}},t)};if(e.context=w()({},p,{skills:(n={},n[h]=(null===(i=null===(a=g)||void 0===a?void 0:a.skills)||void 0===i?void 0:i[h])||{},n)},{integrations:(null===(o=g)||void 0===o?void 0:o.integrations)||{}},e.context),l[k.a.THREADS]&&!c.persistedToBrowserStorage.processState.isProcessPanelOpen){var f=Object(J.c)(e);f.dialog_stack=[{dialog_node:E.a}],e.context.skills[h].system.state=btoa(r()(f)),delete e.context.global.system.turn_count}}},t.prototype.addBrowserInfo=function(e){w()({},{integrations:{chat:{browser_info:Object(L.d)()}}},e.context)},t.prototype.send=function(e,t){var n,s,r,a;return void 0===t&&(t={}),K(this,void 0,void 0,(function(){var i,o,c,u,l,d,g;return $(this,(function(p){switch(p.label){case 0:return i=this.serviceManager.store,o=i.getState(),c=o.alternateSuggestionsState,u=o.featureSet,l=(null===(n=e.history)||void 0===n?void 0:n.label)||e.input.text,t.dontCopyContext||this.copyPreviousContextToMessage(e),this.addBrowserInfo(e),[4,this.addTimeZoneToMessage(e)];case 1:return p.sent(),u[k.a.THREADS]||(d=this.getLastResponse(o,U.a.BOT))&&!(null===(r=null===(s=d.output)||void 0===s?void 0:s.debug)||void 0===r?void 0:r.branch_exited)&&(e.thread_id=d.thread_id),e.input.options=Z(Z({},e.input.options),{export:!0,debug:!0,return_context:!0,alternate_responses:c.config.is_on,disambiguation:Z(Z({},null===(a=e.input.options)||void 0===a?void 0:a.disambiguation),{alternate_responses:c.config.is_on})}),t.additionalInputOptions&&w()(e.input.options,t.additionalInputOptions),e.history=e.history||{},t.trackEventProps||(t.trackEventProps=this.defaultSendTrackEventProps),t.silent&&(e.history.silent=!0),t.isSuggestion&&(e.history.isSuggestion=!0),g=Object(I.a)(e,l,!1),e.history.silent||(i.getState().persistedToBrowserStorage.processState.isProcessPanelOpen?i.dispatch(R.G.addProcessMessage(g,g.originalMessage.thread_id)):i.dispatch(R.G.addMessage(g))),t.setValueSelectedForMessageID&&i.dispatch(R.G.messageSetOptionSelected(t.setValueSelectedForMessageID,e)),this.track(t.trackEventProps),v()(e),[4,this.serviceManager.messageService.send(g.ui_state.id,m()(e))];case 2:return p.sent(),[2]}}))}))},t.prototype.receive=function(t,n,s){return void 0===n&&(n=!1),K(this,void 0,void 0,(function(){var r,a,i;return $(this,(function(o){switch(o.label){case 0:return r=this.serviceManager.store,Object(x.e)(t,r.getState())?(r.dispatch(R.G.setAlternateSuggestionsThirdStrike()),[2]):n?[3,2]:(this.serviceManager.store.dispatch(R.G.addIsTypingCounter(1)),this.serviceManager.store.dispatch(R.G.setPersistedToBrowserStorageValue("hasSentNonWelcomeMessage",!0)),e.env.JEST_WORKER_ID?[3,2]:[4,Object(V.b)(2e3)]);case 1:o.sent(),o.label=2;case 2:return[4,this.serviceManager.eventBus.fire({type:P.a.PRE_RECEIVE,data:t})];case 3:return o.sent(),a=this.serviceManager.store.getState().languagePack,Object(Y.q)(t)?this.processMessageResponse(t,n,s):(i=Object(Y.d)(a.errors_singleMessage,t.thread_id,N.b.INLINE_ERROR),this.receive(i,!1)),this.serviceManager.trackService&&this.serviceManager.trackService.trackResponse(t,n),v()(t),n||this.serviceManager.store.dispatch(R.G.addIsTypingCounter(-1)),[4,this.serviceManager.eventBus.fire({type:P.a.RECEIVE,data:t})];case 4:return o.sent(),[2]}}))}))},t.prototype.track=function(e){this.serviceManager.trackService&&this.serviceManager.trackService.track(e)},t.prototype.addMessageToStoreIfRequired=function(e){var t;return K(this,void 0,void 0,(function(){return $(this,(function(n){switch(n.label){case 0:return[4,this.createElementForCustomResponse(e)];case 1:return n.sent(),(null===(t=e.message.user_defined)||void 0===t?void 0:t.silent)||this.serviceManager.store.dispatch(R.G.addMessage(e)),[2]}}))}))},t.prototype.createElementForCustomResponse=function(e){var t;return K(this,void 0,void 0,(function(){var n;return $(this,(function(s){switch(s.label){case 0:return Object(Y.s)(e)?(n=void 0,(null===(t=e.message.user_defined)||void 0===t?void 0:t.silent)||((n=document.createElement("div")).className="WACCustomResponseElement",this.serviceManager.customElementRegistry.set(e.ui_state.id,n)),[4,this.serviceManager.eventBus.fire({type:P.a.CUSTOM_RESPONSE,data:{message:e.message,element:n}})]):[3,2];case 1:s.sent(),s.label=2;case 2:return[2]}}))}))},t.prototype.processMessageResponse=function(e,t,n){var s,r;return K(this,void 0,void 0,(function(){var a,i,o,c,u,l,d,g,p,h,f,v,S,b,y,m,O,w,E,I,_;return $(this,(function(D){switch(D.label){case 0:a=e.output.generic,i=e.thread_id,o=null===(s=n)||void 0===s?void 0:s.thread_id,c=i!==M.b,u=c&&e.thread_status===M.c.STARTED,l=c&&e.thread_status===M.c.ENDED,d=this.serviceManager.store,g=d.getState().featureSet,p=g[k.a.THREADS],e.request=n,d.dispatch(R.G.addOriginalMessage(e,p&&c?U.a.THREAD:U.a.BOT)),h=null,f=0,D.label=1;case 1:return f<a.length?(v=a[f])?(S=Object(Y.o)(v),b=Object(Y.k)(v),y=Object(T.c)(v,e,!1,t,h),h||S||(h=y.ui_state.id),b?(d.dispatch(R.G.addIsTypingCounter(1)),[4,null===(r=this.serviceManager.humanAgentService)||void 0===r?void 0:r.areAnyAgentsOnline(e)]):[3,3]):[3,15]:[3,16];case 2:m=D.sent(),y.ui_state.agentAvailability=null!=m?m:null,d.dispatch(R.G.addIsTypingCounter(-1)),D.label=3;case 3:return S?((O=Object(Y.r)(v))&&d.dispatch(R.G.addIsTypingCounter(1)),[4,Object(V.b)(v.time)]):[3,5];case 4:return D.sent(),O&&d.dispatch(R.G.addIsTypingCounter(-1)),[3,15];case 5:return p?(w=Object(J.c)(e),c&&w.digressed?(E=this.findLastMessageResponse(),d.dispatch(R.G.addProcessMessage(E,E.originalMessage.thread_id)),[3,16]):[3,6]):[3,13];case 6:return u?(y.ui_state.processLauncher=!0,d.dispatch(R.G.initializeProcess(i,Object(J.d)(e))),I=Object(H.a)(F.a.THREAD),_=Z(Z({},y),{ui_state:Z(Z({},y.ui_state),{id:I,partOfMessageID:I})}),d.dispatch(R.G.addProcessMessage(_,i)),[4,this.addMessageToStoreIfRequired(y)]):[3,8];case 7:return D.sent(),[3,12];case 8:return l?(d.dispatch(R.G.addMessage(y)),d.dispatch(R.G.addProcessMessage(y,o)),d.dispatch(R.G.completeProcess(o)),[3,12]):[3,9];case 9:return d.getState().persistedToBrowserStorage.processState.isProcessPanelOpen?(d.dispatch(R.G.addProcessMessage(y,i)),[3,12]):[3,10];case 10:return[4,this.addMessageToStoreIfRequired(y)];case 11:D.sent(),D.label=12;case 12:return[3,15];case 13:return[4,this.addMessageToStoreIfRequired(y)];case 14:D.sent(),D.label=15;case 15:return f++,[3,1];case 16:return[2]}}))}))},t.prototype.findLastMessageResponse=function(){var e=this.serviceManager.store.getState(),t=e.allMessagesByID,n=e.processesByID[e.persistedToBrowserStorage.processState.currentOngoingProcessId].messageIDs,s=Object(W.d)(n,(function(e){return Object(Y.m)(t[e])}));return t[s]},t.prototype.updateLocale=function(e){this.serviceManager.store.dispatch(R.G.updateLocale(e))},t.prototype.updateLanguagePack=function(e){this.serviceManager.store.dispatch(R.G.updateLanguagePack(e))},t.prototype.updateUserID=function(e,t){var n,s=this.serviceManager.store.getState(),r=s.userID,a=s.identityToken,i=s.config;if(a&&!t)throw new Error('[WatsonAssistantChat] Unable to update the userID. Once the user is set in as the "sub" claim in your JWT identity token, it cannot be changed.');if((null===(n=i.remote.initConfig.authorization)||void 0===n?void 0:n.is_on)&&!t)throw new Error('[WatsonAssistantChat] Unable to update the userID directly. You must use the "sub" claim inside your JWT identity token.');if(e!==r){if(r){if(r!==Object(_.c)()||a){if(a){if(!t)throw new Error('[WatsonAssistantChat] Unable to update the userID directly. You must use the "sub" claim inside your JWT identity token.');throw new Error('[WatsonAssistantChat] The "sub" claim is already set and cannot be changed to "'+e+'"')}throw new Error('[WatsonAssistantChat] The userID is already set and cannot be changed to "'+e+'"')}var o=Object(B.c)(r);Object(B.a)(r),Object(B.e)(e,o)}this.serviceManager.store.dispatch(R.G.setAppStateValue("userID",e)),t&&this.serviceManager.store.dispatch(R.G.setAppStateValue("identityToken",t)),Object(_.a)()}else t&&this.serviceManager.store.dispatch(R.G.setAppStateValue("identityToken",t))},t.prototype.updateIdentityToken=function(e){var t=this.serviceManager.store.getState();if(t.config.remote.initConfig.authorization&&!t.config.remote.initConfig.authorization.is_on)throw new Error("You cannot add an identity token if security is not turned on.");var n=b()(e);Object(q.a)(n),this.updateUserID(n.sub,e)},t.prototype.updateCSSVariables=function(e,t,n){var s=this.serviceManager.store,r=s.getState().config;t=t||{},e&&("BASE-secondary-color"in e&&(t["BASE-secondary-color"]=e["BASE-secondary-color"]),"BASE-primary-color"in e&&(t["BASE-primary-color"]=e["BASE-primary-color"]),"BASE-accent-color"in e&&(t["BASE-accent-color"]=e["BASE-accent-color"]),e["BASE-font-family"]&&(t["BASE-font-family"]=e["BASE-font-family"]),delete e["BUTTON-SEND-icon-fill"],delete e["CHAT-HEADER-BUTTON-ghost-background-enabled-hover"],delete e["BASE-accent-secondary-color"],delete e["BASE-secondary-font-color"],delete e["BASE-secondary-color"],delete e["BASE-primary-color"],delete e["BASE-primary-font-color"],delete e["BASE-accent-color"]),e=Z(Z({},r.public.__ibm__.cssVariables),e),t=Z(Z({},r.remote.initConfig.css_variables),t);var a=Object(X.c)(e,t,s.getState().config.public.carbonTheme);s.dispatch(R.G.updateCSSVariables(a,e,t)),Object(X.a)(s.getState().cssVariables,this.id,this.styleElement,!0,n)},t.prototype.updateBotName=function(e){this.serviceManager.store.dispatch(R.G.updateBotName(e))},t.prototype.updateBotAvatarURL=function(e){this.serviceManager.store.dispatch(R.G.updateBotAvatarURL(e))},t.prototype.updateHomeScreenConfig=function(e){this.serviceManager.store.dispatch(R.G.updateHomeScreenConfig(e))},t.prototype.updateAlternateSuggestionsConfig=function(e){this.serviceManager.store.dispatch(R.G.updateAlternateSuggestionsConfig(e))},t.prototype.toggleOpen=function(){return this.serviceManager.store.getState().persistedToBrowserStorage.isOpen?this.closeWindow():this.openWindow()},t.prototype.openWindow=function(){return K(this,void 0,void 0,(function(){var e,t;return $(this,(function(n){switch(n.label){case 0:return e=this.serviceManager.store,(t=e.getState()).isHydrated||this.hydrateChat(!1).catch((function(e){Object(z.b)("Error hydrating the chat",e)})),t.persistedToBrowserStorage.isOpen?[3,2]:(e.dispatch(R.G.openLauncher()),[4,this.serviceManager.eventBus.fire({type:P.a.WINDOW_OPEN})]);case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.closeWindow=function(){return K(this,void 0,void 0,(function(){var e;return $(this,(function(t){switch(t.label){case 0:return this.serviceManager.store.getState().persistedToBrowserStorage.isOpen?(e={type:P.a.WINDOW_PRE_CLOSE,vetoClose:!1},[4,this.serviceManager.eventBus.fire(e)]):[3,3];case 1:return t.sent(),e.vetoClose?[3,3]:(this.serviceManager.store.dispatch(R.G.closeLauncher()),[4,this.serviceManager.eventBus.fire({type:P.a.WINDOW_CLOSE})]);case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},t.prototype.openProcess=function(e){return K(this,void 0,void 0,(function(){return $(this,(function(t){switch(t.label){case 0:return this.serviceManager.store.getState().persistedToBrowserStorage.processState.isProcessPanelOpen?[3,2]:(this.serviceManager.store.dispatch(R.G.openProcess(e)),[4,this.serviceManager.eventBus.fire({type:P.a.PROCESS_OPEN})]);case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.closeProcess=function(){return K(this,void 0,void 0,(function(){return $(this,(function(e){switch(e.label){case 0:return this.serviceManager.store.getState().persistedToBrowserStorage.processState.isProcessPanelOpen?(this.serviceManager.store.dispatch(R.G.closeProcess()),[4,this.serviceManager.eventBus.fire({type:P.a.PROCESS_CLOSE})]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.setCurrentProcess=function(e){return K(this,void 0,void 0,(function(){return $(this,(function(t){return this.serviceManager.store.dispatch(R.G.setCurrentProcess(e)),[2]}))}))},t.prototype.cancelProcess=function(e){return K(this,void 0,void 0,(function(){return $(this,(function(t){switch(t.label){case 0:return this.serviceManager.store.getState().persistedToBrowserStorage.processState.isProcessPanelOpen?[3,2]:(this.serviceManager.store.dispatch(R.G.cancelProcess(e)),[4,this.serviceManager.eventBus.fire({type:P.a.PROCESS_CANCEL})]);case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.errorOccurred=function(e,t){return K(this,void 0,void 0,(function(){return $(this,(function(n){switch(n.label){case 0:return Object(z.b)("An error has occurred",e,t),[4,this.serviceManager.eventBus.fire({type:P.a.ERROR,data:e,context:t})];case 1:return n.sent(),[2]}}))}))},t.prototype.resetChat=function(){return K(this,void 0,void 0,(function(){var e,t,n;return $(this,(function(s){switch(s.label){case 0:return[4,this.serviceManager.eventBus.fire({type:P.a.PRE_RESET})];case 1:return s.sent(),e=this.serviceManager.store.getState().agentState,t=e.isConnected,n=e.isConnecting,t||n?(t&&this.serviceManager.store.dispatch(Object(j.r)(!1)),this.serviceManager.humanAgentService?[4,this.serviceManager.humanAgentService.endChat()]:[3,3]):[3,3];case 2:s.sent(),s.label=3;case 3:return this.serviceManager.messageService.cancelAllMessageRequests(),this.destroySession(!0),this.serviceManager.store.dispatch(R.G.resetMessages()),[4,this.serviceManager.actions.hydrateChat(!0)];case 4:return s.sent(),[4,this.serviceManager.eventBus.fire({type:P.a.RESET})];case 5:return s.sent(),[2]}}))}))},t.prototype.destroySession=function(e){var t=this.serviceManager.store.getState(),n=t.userID,s=t.persistedToBrowserStorage,r=m()(C.e);this.serviceManager.messageService.cancelAllMessageRequests(),e&&(r.isOpen=s.isOpen),this.serviceManager.store.dispatch(R.G.setAppStateValue("persistedToBrowserStorage",r)),Object(B.a)(n)},t.prototype.sendSuggestionChoice=function(e,t,n){var s,r,a;return K(this,void 0,void 0,(function(){var i,o,c,u,l,d,g,p;return $(this,(function(h){switch(h.label){case 0:return i=t.thread_id,o=t.id,c=e.isContactSuggestion,u=e.option,l=Object(Y.b)(u,i,o),d=this.serviceManager.store.getState().persistedToBrowserStorage.sessionID,l.context=m()(t.context),(g=null===(a=null===(r=null===(s=l.context)||void 0===s?void 0:s.global)||void 0===r?void 0:r.system)||void 0===a?void 0:a.session_id)&&g!==d&&(p={global:{system:{session_id:d}}},w()(l.context,p)),this.serviceManager.store.dispatch(R.G.setSuggestionsSelectedIndex(n)),[4,this.serviceManager.actions.send(l,{trackEventProps:{eventName:"Suggestion Selected",eventDescription:"User chose an option from the suggestion menu.",suggestionsUserSelectedAgent:Boolean(c)},isSuggestion:!0,dontCopyContext:!0,additionalInputOptions:{restart:!0}})];case 1:return h.sent(),[2]}}))}))},t}();function te(e){return K(this,void 0,void 0,(function(){var t,n;return $(this,(function(s){switch(s.label){case 0:t={type:P.a.IDENTITY_EXPIRED,identityToken:null},s.label=1;case 1:return s.trys.push([1,3,,4]),[4,e.eventBus.fire(t)];case 2:return s.sent(),e.actions.updateIdentityToken(t.identityToken),[3,4];case 3:throw n=s.sent(),Object(z.b)("No valid identityToken was returned by a subscriber to "+P.a.IDENTITY_EXPIRED+" event and Web Chat cannot continue."),new Error(U.e+"  "+n);case 4:return[2]}}))}))}}).call(this,n(42))},508:function(e,t,n){e.exports=n(509)},509:function(e,t,n){e.exports=n(510)},510:function(e,t,n){n(511);var s=n(9);e.exports=s.Object.values},511:function(e,t,n){var s=n(3),r=n(169).values;s({target:"Object",stat:!0},{values:function(e){return r(e)}})},597:function(e,t,n){"use strict";n.r(t);var s=n(56),r=n.n(s),a=n(415),i=n.n(a),o=n(23),c=n.n(o),u=n(420),l=n.n(u),d=n(376),g=n.n(d),p=n(11),h=n.n(p),f=n(12),v=n.n(f),S=n(1),b=n.n(S),y=n(367),m=n(352),O=n(2),w=function(e,t,n,s){return new(n||(n=b.a))((function(r,a){function i(e){try{c(s.next(e))}catch(e){a(e)}}function o(e){try{c(s.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,o)}c((s=s.apply(e,t||[])).next())}))},M=function(e,t){var n,s,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof v.a&&(a[h.a]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,s&&(r=2&a[0]?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,s=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(r=(r=i.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){i.label=a[1];break}if(6===a[0]&&i.label<r[1]){i.label=r[1],r=a;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(a);break}r[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],s=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}},E=function(){function e(){this.handlersByType=new g.a}return e.prototype.fire=function(e){return w(this,void 0,void 0,(function(){var t,n=this;return M(this,(function(s){switch(s.label){case 0:return t=Object(m.b)(e),[4,Object(m.c)(t,(function(e){return w(n,void 0,void 0,(function(){var t,n,s,r;return M(this,(function(a){switch(a.label){case 0:return t=e.type,(n=this.handlersByType.get(t))&&n.length?(r=l()(n).call(n),[4,Object(m.c)(r,(function(t){return t(e)}))]):[3,2];case 1:a.sent(),a.label=2;case 2:return(s=this.handlersByType.get(y.a.ALL_EVENTS))&&s.length?(r=l()(s).call(s),[4,Object(m.c)(r,(function(t){return t(e)}))]):[3,4];case 3:a.sent(),a.label=4;case 4:return[2]}}))}))}))];case 1:return s.sent(),[2,this]}}))}))},e.prototype.on=function(e){var t=this,n=Object(m.b)(e);return c()(n).call(n,(function(e){var n=e.type,s=e.handler;"function"==typeof s?(t.handlersByType.has(n)||t.handlersByType.set(n,[]),t.handlersByType.get(n).push(s)):Object(O.b)("The event handler is not a function.",s)})),this},e.prototype.off=function(e){var t=this,n=Object(m.b)(e);return c()(n).call(n,(function(e){var n=e.type,s=e.handler,a=t.handlersByType.get(n);if(a)if(s){var o=r()(a).call(a,s);-1!==o&&i()(a).call(a,o,1)}else t.handlersByType.set(n,[])})),this},e.prototype.once=function(e){var t=this,n=Object(m.b)(e);return c()(n).call(n,(function(e){var n=e.type,s=e.handler;if("function"==typeof s){t.on({type:n,handler:function e(r){s(r),t.off({type:n,handler:e})}})}else Object(O.b)("The event handler is not a function.",s)})),this},e.prototype.clear=function(){return this.handlersByType.clear(),this},e}(),I=n(507),T=n(13),_=n.n(T),D=n(105),B=n.n(D),R=function(){return(R=_.a||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};var j,C=n(372),A=n.n(C),P=n(96),k=n(85),N=n.n(k),x=n(147),L=n.n(x),G=n(22),U=n.n(G);!function(e){e.HISTORY="HISTORY",e.MESSAGE="MESSAGE",e.ANSWER="ANSWER",e.FLOW="FLOW",e.ERROR="ERROR"}(j||(j={}));var q=n(38),W=n(93),V=n(0),H=n(88),F=n(350),Y=n(365),z=n(364),J=function(){return(J=_.a||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},X=function(e,t,n,s){return new(n||(n=b.a))((function(r,a){function i(e){try{c(s.next(e))}catch(e){a(e)}}function o(e){try{c(s.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,o)}c((s=s.apply(e,t||[])).next())}))},Q=function(e,t){var n,s,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof v.a&&(a[h.a]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,s&&(r=2&a[0]?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,s=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(r=(r=i.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){i.label=a[1];break}if(6===a[0]&&i.label<r[1]){i.label=r[1],r=a;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(a);break}r[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],s=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}};function Z(e,t,n){return X(this,void 0,void 0,(function(){var s,r;return Q(this,(function(a){switch(a.label){case 0:return[4,K(e,r={serviceManager:n,allMessages:[],allMessagesByID:{},allLocalMessagesByID:s={},threadMessagesByThreadID:{},responsesByRequestID:{},relatedMessageByID:{},localMessagesByOriginalMessageID:{},lastThreadID:null,loadedHistory:{allMessagesByID:s,botMessageState:null,agentMessageState:null,processesByID:null}},t)];case 1:return a.sent(),r.allMessages.length?(function(e){var t=e.allMessages,n=e.allLocalMessagesByID,s=e.localMessagesByOriginalMessageID;c()(t).call(t,(function(t){var r,a,i,o,u;if(Object(H.p)(t)){if(!(null===(r=t.history)||void 0===r?void 0:r.silent)){var l=(null===(a=t.history)||void 0===a?void 0:a.label)||t.input.text,d=Object(Y.a)(t,l,!0);s[t.id].push(d),n[d.ui_state.id]=d}}else if(Object(H.q)(t)&&(null===(o=null===(i=t.output)||void 0===i?void 0:i.generic)||void 0===o?void 0:o.length)){var g,p,h=!1;t.thread_id!==q.b&&t.thread_status===q.c.STARTED&&(h=!0),c()(g=t.output.generic).call(g,(function(e){if(!Object(H.o)(e)){var r=Object(z.c)(e,t,!0,!1,p);s[t.id].push(r),n[r.ui_state.id]=r,r.ui_state.processLauncher=h,p||(p=r.ui_state.id)}}))}(null===(u=s[t.id])||void 0===u?void 0:u.length)&&function e(t,n,s){var r=s.threadMessagesByThreadID,a=r[t];a||(a=[],r[t]=a);!Object(H.q)(n)||t===q.b||t===V.c||n.thread_status!==q.c.STARTED&&n.thread_status!==q.c.ENDED||e(q.b,n,s);a.push(n)}(t.thread_id||q.b,t,e)}))}(r),function(e){var t,n=e.loadedHistory,s=e.threadMessagesByThreadID,r=e.lastThreadID,a=e.localMessagesByOriginalMessageID;n.botMessageState=$(s[q.b],a),n.agentMessageState=$(s[V.c],a);var i={};c()(t=N()(s)).call(t,(function(e){var t,n,s,o,c=e[0],u=e[1];if(c!==q.b&&c!==V.c){var l=$(u,a);i[c]=l;var d=a[null===(n=null===(t=u)||void 0===t?void 0:t[0])||void 0===n?void 0:n.id];l.processTitle=Object(F.d)(null===(o=null===(s=d)||void 0===s?void 0:s[0])||void 0===o?void 0:o.originalMessage)||"";var g=u[u.length-1];u.length<=1?l.processStatus=F.a.PROCESS_NOT_STARTED:Object(H.q)(g)&&g.thread_status===q.c.ENDED?l.processStatus=F.a.PROCESS_COMPLETED:l.processStatus=c===r?F.a.PROCESS_ONGOING:F.a.PROCESS_CANCELLED}})),n.processesByID=i}(r),function(e){var t=e.responsesByRequestID,n=e.threadMessagesByThreadID,s=e.localMessagesByOriginalMessageID,r=n[q.b],a=Object(m.d)(r,(function(e){return Object(H.p)(e)&&e.history.getWelcome}));if(a){var i,o=t[a.id];if(o)c()(i=s[o.id]).call(i,(function(e){e.ui_state.isLatestWelcomeNode=!0}))}}(r),function(e){var t=e.allMessages,n=e.relatedMessageByID,s=e.localMessagesByOriginalMessageID;c()(t).call(t,(function(e){var t;Object(H.q)(e)&&c()(t=s[e.id]).call(t,(function(t){if(Object(H.n)(t)){var s=n[e.id];Object(H.p)(s)&&(t.ui_state.optionSelected=s)}}))}))}(r),[2,r.loadedHistory]):[2,null]}}))}))}function K(e,t,n){return X(this,void 0,void 0,(function(){var s,r,a,i,o,u,l=this;return Q(this,(function(d){switch(d.label){case 0:return s=t.allMessages,r=t.allMessagesByID,a=t.responsesByRequestID,i=t.relatedMessageByID,o=t.serviceManager,u=t.localMessagesByOriginalMessageID,c()(e).call(e,(function(e){if(e.type===j.HISTORY){var r=e.body;c()(r).call(r,(function(e){var r=e.message;(Object(H.p)(r)||Object(H.q)(r))&&(s.push(r),n||r.thread_id===V.c||(r.thread_id=q.b),r.history=r.history||{},r.history.timestamp=new Date(e.time).getTime(),r.thread_id!==q.b&&r.thread_id!==V.c&&(t.lastThreadID=r.thread_id))}))}})),s.length?(L()(s),[4,o.eventBus.fire({type:y.a.HISTORY_BEGIN,messages:s})]):[2];case 1:return d.sent(),[4,Object(m.c)(s,(function(e){return X(l,void 0,void 0,(function(){return Q(this,(function(t){switch(t.label){case 0:return Object(H.q)(e)?[4,o.eventBus.fire({type:y.a.PRE_RECEIVE,data:e})]:[3,3];case 1:return t.sent(),U()(e),[4,o.eventBus.fire({type:y.a.RECEIVE,data:e})];case 2:return t.sent(),[3,4];case 3:U()(e),t.label=4;case 4:return[2]}}))}))}))];case 2:return d.sent(),[4,o.eventBus.fire({type:y.a.HISTORY_END,messages:s})];case 3:return d.sent(),c()(s).call(s,(function(e){r[e.id]=e,u[e.id]=[],Object(H.q)(e)&&e.request_id&&(a[e.request_id]=e),e.history.relatedMessageID&&(i[e.history.relatedMessageID]=e)})),[2]}}))}))}function $(e,t){var n=[];return e&&c()(e).call(e,(function(e){var s;c()(s=t[e.id]).call(s,(function(e){n.push(e.ui_state.id)}))})),J(J({},W.c),{messageIDs:n})}var ee,te=n(354),ne=n(34),se=n(21),re=n(28),ae=n(422),ie=function(e,t,n,s){return new(n||(n=b.a))((function(r,a){function i(e){try{c(s.next(e))}catch(e){a(e)}}function o(e){try{c(s.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,o)}c((s=s.apply(e,t||[])).next())}))},oe=function(e,t){var n,s,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof v.a&&(a[h.a]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,s&&(r=2&a[0]?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,s=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(r=(r=i.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){i.label=a[1];break}if(6===a[0]&&i.label<r[1]){i.label=r[1],r=a;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(a);break}r[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],s=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}},ce=function(){function e(e){this.serviceManager=e}return e.prototype.loadHistory=function(){var e;return ie(this,void 0,void 0,(function(){var t,n,s,r,a,i,o,c,u,l,d,g,p=this;return oe(this,(function(h){switch(h.label){case 0:if(t=this.serviceManager.store.getState(),n=t.config,s=t.persistedToBrowserStorage,r=t.featureSet,!(a=n.public.sessionID||s.sessionID)||!r[te.a.SESSION_HISTORY])return[3,7];i=Object(ne.i)(n.public,a),o={headers:{Accept:"application/json","X-Global-Transaction-ID":Object(se.a)(re.a.MISCELLANEOUS)}},h.label=1;case 1:return h.trys.push([1,6,,7]),Object(O.d)('Retrieving conversation history from "'+i+'"'),[4,Object(ae.b)((function(){return p.doFetch(i,o)}),[1e3,1e3,1e3],"fetching history",5e3)];case 2:return(c=h.sent()).ok?[4,c.json()]:[3,5];case 3:return u=h.sent(),l=null===(e=u)||void 0===e?void 0:e.notes,d=r[te.a.THREADS],[4,Z(l,d,this.serviceManager)];case 4:return[2,h.sent()];case 5:return[3,7];case 6:return g=h.sent(),Object(O.b)("An error occurred while attempting to load the conversation history",g),[3,7];case 7:return[2,null]}}))}))},e.prototype.doFetch=function(e,t){return ie(this,void 0,void 0,(function(){return oe(this,(function(n){return[2,Object(ae.c)(Object(P.a)(e,t),new A.a([200,404]))]}))}))},e}(),ue=n(418),le=n.n(ue),de=n(89),ge=n.n(de),pe=n(51),he=n.n(pe),fe=n(351),ve=n.n(fe),Se=n(27),be=n(30),ye=n(419),me=n(353),Oe=n(104),we=n(347),Me=n(377),Ee=function(){return(Ee=_.a||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Ie=function(e,t,n,s){return new(n||(n=b.a))((function(r,a){function i(e){try{c(s.next(e))}catch(e){a(e)}}function o(e){try{c(s.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,o)}c((s=s.apply(e,t||[])).next())}))},Te=function(e,t){var n,s,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof v.a&&(a[h.a]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,s&&(r=2&a[0]?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,s=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(r=(r=i.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){i.label=a[1];break}if(6===a[0]&&i.label<r[1]){i.label=r[1],r=a;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(a);break}r[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],s=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}},_e={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}};!function(e){e[e.SILENT=1]="SILENT",e[e.VISIBLE=2]="VISIBLE"}(ee||(ee={}));var De,Be,Re=function(){function e(e,t){this.serviceManager=e,this.messageURL=t,this.queue={waiting:[],current:null}}return e.prototype.processSuccess=function(e,t){return Ie(this,void 0,void 0,(function(){var n,s,r,a,i,o,c,u;return Te(this,(function(l){switch(l.label){case 0:return n=e.message,s=e.sendMessagePromise,r=this.serviceManager.store.getState(),a=r.persistedToBrowserStorage,i=r.featureSet,o=a.sessionID,c=Boolean(n.history.getWelcome),u=i[te.a.SESSION_HISTORY],e.sendMessagePromise.isRejected||e.sendMessagePromise.isResolved?[2]:(this.setMessageErrorState(e.messageID,me.a.NONE),c?[3,2]:[4,this.serviceManager.progressBarService.end()]);case 1:l.sent(),l.label=2;case 2:return c&&u&&t.session_id&&t.session_id===o?(Object(O.d)("Session "+o+" still active."),[3,5]):[3,3];case 3:return t.session_id&&t.session_id!==o&&(this.serviceManager.store.dispatch(be.G.setPersistedToBrowserStorageValue("sessionID",t.session_id)),this.serviceManager.store.dispatch(be.G.setPersistedToBrowserStorageValue("sessionStartedTimestamp",ve()()))),t.history=t.history||{},t.history.timestamp=t.history.timestamp||ve()(),[4,this.serviceManager.actions.receive(t,c,e.message)];case 4:l.sent(),l.label=5;case 5:return s.doResolve(),this.finishCurrentQueueMessage(),[2]}}))}))},e.prototype.sendToAssistantAndUpdateErrorState=function(e){var t,n=this;e.sendMessagePromise.isRejected||e.sendMessagePromise.isResolved||(this.sendToAssistant(e),(3500>ve()()-e.timeMessageStarted?ee.SILENT:ee.VISIBLE)===ee.VISIBLE&&(this.setMessageErrorState(e.messageID,me.a.RETRYING),c()(t=this.queue.waiting).call(t,(function(e){n.setMessageErrorState(e.messageID,me.a.WAITING)}))))},e.prototype.processError=function(e,t,n){var s;return Ie(this,void 0,void 0,(function(){var a,i,o,c,u,l,d,g,p=this;return Te(this,(function(h){switch(h.label){case 0:if(a=e.message.history.getWelcome,i=t===Se.BAD_REQUEST&&a&&-1!==(null===(s=n)||void 0===s?void 0:r()(s).call(s,"No skills found for the assistant")),o=ve()(),c=o-e.timeMessageStarted,u=2e4>c,l=t===Se.TOO_MANY_REQUESTS,e.sendMessagePromise.isRejected||e.sendMessagePromise.isResolved)return[2];if(!Object(Oe.b)(t,n)||!u)return[3,5];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.getNewIdentityToken()];case 2:return h.sent(),this.sendToAssistantAndUpdateErrorState(e),[3,4];case 3:return h.sent(),Object(O.b)("No valid identityToken was returned by a subscriber to "+y.a.IDENTITY_EXPIRED+" event and web chat cannot continue."),a&&this.serviceManager.store.dispatch(be.G.setShowWelcomeError(ye.a.FAILED)),this.rejectFinalErrorOnMessage(e,n),[3,4];case 4:return[3,6];case 5:t===Se.NOT_FOUND&&r()(n).call(n,"session not found")>=0?(this.serviceManager.store.dispatch(be.G.setPersistedToBrowserStorageValue("sessionID",null)),he()((function(){return p.sendToAssistantAndUpdateErrorState(e)}),1e3)):i||!u||l?(l?a?this.serviceManager.store.dispatch(be.G.setShowWelcomeError(ye.a.THROTTLED)):(d=this.serviceManager.store.getState().languagePack,g=Object(z.a)(d.errors_busy,e.message.thread_id),this.serviceManager.store.dispatch(be.G.addMessage(g))):i?this.serviceManager.store.dispatch(be.G.setShowWelcomeError(ye.a.NO_SKILL)):a&&this.serviceManager.store.dispatch(be.G.setShowWelcomeError(ye.a.FAILED)),this.rejectFinalErrorOnMessage(e,n)):he()((function(){return p.sendToAssistantAndUpdateErrorState(e)}),1e3),h.label=6;case 6:return[2]}}))}))},e.prototype.getNewIdentityToken=function(){return Ie(this,void 0,void 0,(function(){var e;return Te(this,(function(t){switch(t.label){case 0:return e={type:y.a.IDENTITY_EXPIRED,identityToken:null},[4,Object(we.a)(this.serviceManager.eventBus.fire(e),3e4)];case 1:return t.sent(),this.serviceManager.actions.updateIdentityToken(e.identityToken),[2]}}))}))},e.prototype.rejectFinalErrorOnMessage=function(e,t){void 0===t&&(t="An undefined error occurred trying to send your message."),this.serviceManager.actions.errorOccurred(t,"src/services/MessageService => send"),this.setMessageErrorState(e.messageID,me.a.FAILED),e.message.history.getWelcome||this.serviceManager.progressBarService.end(!0),e.sendMessagePromise.doReject(),this.finishCurrentQueueMessage()},e.prototype.sendToAssistant=function(e){var t;return Ie(this,void 0,void 0,(function(){var n,s,r,a,i,o,c,u,l,d,g,p;return Te(this,(function(h){switch(h.label){case 0:if(n=e.message,s=this.serviceManager.store.getState().config,e.sendMessagePromise.isRejected||e.sendMessagePromise.isResolved)return[2];h.label=1;case 1:return h.trys.push([1,11,,12]),r=this.createChatRequest(n),a=this.createFetchParameters(),i=void 0,(null===(t=s.public.__ibm__)||void 0===t?void 0:t.mockFetchForMessageService)?[4,s.public.__ibm__.mockFetchForMessageService(Ee(Ee({},a),{body:ge()(r)}))]:[3,4];case 2:return o=h.sent(),c=o.responseData,u=o.extraValues,[4,Object(H.f)(c,u)];case 3:return i=h.sent(),[3,6];case 4:return[4,Object(P.a)(this.messageURL,Ee(Ee({},a),{body:ge()(r)}))];case 5:i=h.sent(),h.label=6;case 6:return i.ok?[4,i.json()]:[3,8];case 7:return l=h.sent(),this.processSuccess(e,l),[3,10];case 8:return[4,i.text()];case 9:d=h.sent(),this.processError(e,i.status,d),h.label=10;case 10:return[3,12];case 11:return g=h.sent(),Object(O.b)("An error occurred while sending a message",g),p=g&&("string"==typeof g?g:ge()(g))||"There was an unidentified error.",this.processError(e,0,p),[3,12];case 12:return[2]}}))}))},e.prototype.runQueueIfReady=function(){var e;return Ie(this,void 0,void 0,(function(){var t,n,s,r,a,i,o,c,u,l=this;return Te(this,(function(d){switch(d.label){case 0:return!this.queue.current&&this.queue.waiting.length>0?(t=this.serviceManager,n=t.eventBus,s=t.store,this.queue.current=this.queue.waiting.shift(),this.queue.current.timeMessageStarted=ve()(),r=this.queue.current,a=r.message,i=r.messageID,a.history.getWelcome?[3,2]:(o=function(e){return l.serviceManager.store.dispatch(be.G.setAppStateValue("sentMessagePercentage",e))},[4,this.serviceManager.progressBarService.start(o,(function(){return l.cancelMessageRequestByID(i)}),2500,2e4)])):[3,5];case 1:d.sent(),d.label=2;case 2:return c=(null===(e=a.history)||void 0===e?void 0:e.label)||a.input.text,[4,n.fire({type:y.a.PRE_SEND,data:a})];case 3:return d.sent(),u=Object(Y.a)(a,c,!1,this.queue.current.messageID),a.history.silent||(s.getState().persistedToBrowserStorage.processState.isProcessPanelOpen?s.dispatch(be.G.updateProcessMessage(u)):s.dispatch(be.G.updateMessage(u))),U()(a),[4,n.fire({type:y.a.SEND,data:a})];case 4:d.sent(),this.sendToAssistant(this.queue.current),d.label=5;case 5:return[2]}}))}))},e.prototype.addToMessageQueue=function(e,t,n){var s={messageID:e,message:t,sendMessagePromise:n};if(this.queue.waiting.push(s),this.queue.current){var r=this.serviceManager.store.getState().allMessagesByID[this.queue.current.messageID];r&&r.ui_state.errorState===me.a.RETRYING&&this.setMessageErrorState(s.messageID,me.a.WAITING)}},e.prototype.finishCurrentQueueMessage=function(){this.queue.current=null,this.runQueueIfReady()},e.prototype.setMessageErrorState=function(e,t){var n=this.serviceManager.store.getState().allMessagesByID[e];if(n&&n.ui_state.errorState!==t){var s=void 0;switch(t){case me.a.RETRYING:s="errors_ariaMessageRetrying";break;case me.a.FAILED:s="errors_ariaMessageFailed"}s&&this.serviceManager.store.dispatch(be.G.announceMessage({messageID:s}))}this.serviceManager.store.dispatch(be.G.setMessageErrorState(e,t))},e.prototype.send=function(e,t){t.history=t.history||{},t.history.timestamp=t.history.timestamp||ve()();var n=Object(Me.a)();return this.addToMessageQueue(e,t,n),this.runQueueIfReady(),n},e.prototype.cancelAllMessageRequests=function(){this.queue.waiting=[],this.queue.current&&this.cancelMessageRequestByID(this.queue.current.messageID)},e.prototype.cancelMessageRequestByID=function(e){var t,n;(null===(t=this.queue.current)||void 0===t?void 0:t.messageID)===e?this.rejectFinalErrorOnMessage(this.queue.current,"Message was cancelled."):this.queue.waiting=le()(n=this.queue.waiting).call(n,(function(t){return t.messageID!==e}))},e.prototype.createFetchParameters=function(){var e,t,n,s=this.serviceManager.store.getState(),r=s.identityToken,a=s.config,i=Ee(Ee({},_e),{headers:Ee(Ee({},_e.headers),{"X-Global-Transaction-ID":Object(se.a)(re.a.MISCELLANEOUS),authorization:r?"Bearer "+r:void 0})});return(null===(e=a.public.__ibm__)||void 0===e?void 0:e.isPreviewLink)&&(i.headers["x-watson-is-preview"]=!0),(null===(t=a.public.__ibm__)||void 0===t?void 0:t.isToolingPreview)&&(i.headers["x-watson-is-tooling-preview"]=!0),(null===(n=a.public.__ibm__)||void 0===n?void 0:n.isCitizenIntegration)&&(i.headers["x-watson-citizen-integration"]=!0),a.public.learningOptOut&&(i.headers["x-watson-learning-opt-out"]=!0),i},e.prototype.createChatRequest=function(e){var t=this.serviceManager.store.getState(),n=t.userID;return{value:e,session_id:t.persistedToBrowserStorage.sessionID,user_id:n}},e.prototype.sendAutoLearningMessage=function(e,t){return void 0===t&&(t=!0),Ie(this,void 0,void 0,(function(){var n,s,r,a;return Te(this,(function(i){switch(i.label){case 0:return this.serviceManager.store.getState().featureSet[te.a.AUTO_LEARNING]?(n=this.createChatRequest(e),s=this.createFetchParameters(),[4,Object(P.a)(this.messageURL,Ee(Ee({},s),{body:ge()(n)}))]):[3,4];case 1:return(r=i.sent()).ok||!t?[3,4]:[4,Object(O.e)(r)];case 2:return a=i.sent(),Object(Oe.b)(r.status,a)?[4,this.getNewIdentityToken()]:[3,4];case 3:i.sent(),this.sendAutoLearningMessage(e,!1),i.label=4;case 4:return[2]}}))}))},e}(),je=function(e,t,n,s){return new(n||(n=b.a))((function(r,a){function i(e){try{c(s.next(e))}catch(e){a(e)}}function o(e){try{c(s.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,o)}c((s=s.apply(e,t||[])).next())}))},Ce=function(e,t){var n,s,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof v.a&&(a[h.a]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,s&&(r=2&a[0]?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,s=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(r=(r=i.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){i.label=a[1];break}if(6===a[0]&&i.label<r[1]){i.label=r[1],r=a;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(a);break}r[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],s=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}},Ae=function(){function e(){}return e.prototype.start=function(e,t,n,s,r){return void 0===r&&(r=200),je(this,void 0,void 0,(function(){var a=this;return Ce(this,(function(i){switch(i.label){case 0:return this.percentageCompleted||this.updateIntervalID?[4,this.end(!0)]:[3,2];case 1:i.sent(),i.label=2;case 2:return this.animationTime=r,this.percentageCompleted=0,this.startTime=ve()(),this.msMaxSilentLoading=n,this.msMaxAttempt=s,this.onUpdate=e,this.onTimeout=t,this.updateIntervalID=window.setInterval((function(){return a.updateProgress()}),this.animationTime),this.onUpdate(this.percentageCompleted),[2]}}))}))},e.prototype.end=function(e){return void 0===e&&(e=!1),je(this,void 0,void 0,(function(){var t;return Ce(this,(function(n){switch(n.label){case 0:return window.clearInterval(this.updateIntervalID),this.updateIntervalID=null,t=ve()()-this.startTime,!e&&this.msMaxSilentLoading<t?(this.percentageCompleted=100,this.onUpdate(this.percentageCompleted),[4,Object(we.b)(this.animationTime)]):[3,2];case 1:n.sent(),n.label=2;case 2:return this.percentageCompleted=0,this.onUpdate(this.percentageCompleted),[2]}}))}))},e.prototype.updateProgress=function(){var e=ve()()-this.startTime,t=Math.ceil(e/this.msMaxAttempt*100);t<=100?this.msMaxSilentLoading<e&&(this.percentageCompleted=t,this.onUpdate(this.percentageCompleted)):this.onTimeout()},e}(),Pe=function(){this.customElementRegistry=new g.a},ke=n(414),Ne=n(40),xe=n.n(Ne),Le=n(408),Ge=n(143),Ue=n(140),qe=n(110),We=n(18),Ve=n(363),He=function(){return(He=_.a||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Fe=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var s=Array(e),r=0;for(t=0;t<n;t++)for(var a=arguments[t],i=0,o=a.length;i<o;i++,r++)s[r]=a[i];return s},Ye=((De={})[Ve.h]=function(e,t){var n=t.isConnecting;return He(He({},e),{agentState:He(He({},e.agentState),{isConnecting:n,hasSentMessageSinceConnecting:!1,numUnreadMessages:n?0:e.agentState.numUnreadMessages,lastUnreadMessage:n?null:e.agentState.lastUnreadMessage})})},De[Ve.c]=function(e,t){return e.agentState.isConnecting?He(He({},e),{agentState:He(He({},e.agentState),{availability:e.agentState.isConnecting?t.availability:null})}):e},De[Ve.e]=function(e,t){var n=!e.agentState.hasSentMessageSinceConnecting||e.agentState.isPanelOpen;return He(He({},e),{announceMessage:Object(W.h)(e,n),agentState:He(He({},e.agentState),{isPanelOpen:n,allowUserInput:!0,isConnecting:!1,isConnected:!0,wasConnected:!0,agentProfile:t.agentProfile,availability:null})})},De[Ve.i]=function(e,t){var n=t.isPanelOpen&&e.persistedToBrowserStorage.isOpen,s=n?null:e.agentState.lastUnreadMessage,r=n?0:e.agentState.numUnreadMessages;return He(He({},e),{announceMessage:Object(W.h)(e,t.isPanelOpen),agentState:He(He({},e.agentState),{isPanelOpen:t.isPanelOpen,lastUnreadMessage:s,numUnreadMessages:r})})},De[Ve.a]=function(e,t){var n,s,r,a=t.message,i=a.ui_state.id;if(e.agentState.isPanelOpen&&e.persistedToBrowserStorage.isOpen)s=null,r=0;else{var o=Object(H.m)(a);s=o?a:e.agentState.lastUnreadMessage,r=e.agentState.numUnreadMessages,o&&a.message.response_type!==We.a.AGENT_JOINED&&(r+=1)}return He(He({},e),{allMessagesByID:He(He({},e.allMessagesByID),(n={},n[i]=t.message,n)),agentMessageState:He(He({},e.agentMessageState),{messageIDs:Fe(e.agentMessageState.messageIDs,[i])}),agentState:He(He({},e.agentState),{lastUnreadMessage:s,numUnreadMessages:r})})},De[Ve.d]=function(e,t){return He(He({},e),{agentMessageState:He(He({},e.agentMessageState),{isTypingCounter:t.isTypingCounter})})},De[Ve.f]=function(e){return He(He({},e),{agentMessageState:He(He({},e.agentMessageState),{isTypingCounter:0}),agentState:He(He({},e.agentState),{agentProfile:null})})},De[Ve.b]=function(e){return He(He({},e),{agentMessageState:He(He({},e.agentMessageState),{isTypingCounter:0}),agentState:He(He({},e.agentState),{isConnecting:!1,isConnected:!1,allowUserInput:!1,availability:null,hasSentMessageSinceConnecting:!1})})},De[Ve.g]=function(e,t){var n;return He(He({},e),{agentState:He(He({},e.agentState),(n={},n[t.propertyName]=t.propertyValue,n))})},De),ze=n(100),Je=n.n(ze),Xe=n(7),Qe=n(357),Ze=n(366),Ke=function(){return(Ke=_.a||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},$e=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var s=Array(e),r=0;for(t=0;t<n;t++)for(var a=arguments[t],i=0,o=a.length;i<o;i++,r++)s[r]=a[i];return s},et=5,tt=((Be={})[be.o]=function(e,t){var n=nt(e,t);if("User"===t.suggestionsToggledReason){var s=Object(H.a)({message_type:"more_options_event",event:t.isOpen?"open":"closed"});n=Object(W.f)(s,n)}return n},Be[be.p]=function(e){if(!e.alternateSuggestionsState.config.is_on)return e;if(function(e){return 2===e.alternateSuggestionsState.numStrikes&&(e.agentState.isConnected||e.agentState.isConnecting)}(e))return e;return st(e,e.alternateSuggestionsState.isOpen,3,{eventName:"Assistant Message Sent to User with Suggestions",eventDescription:"A message was received by the user from the bot with suggestions enabled."})},Be[be.y]=function(e,t){var n=xe()({},e.alternateSuggestionsState.config,t.config);if(!n.is_on)return Ke(Ke({},e),{alternateSuggestionsState:Ke(Ke({},W.b),{config:n})});var s=Ke(Ke({},e),{alternateSuggestionsState:Ke(Ke({},e.alternateSuggestionsState),{config:n,showButton:n.is_on&&e.alternateSuggestionsState.showButton,isOpen:n.is_on&&e.alternateSuggestionsState.isOpen})}),r=s.alternateSuggestionsState,a=r.isOpen,i=r.numStrikes;return st(s,a,i)},Be[be.x]=function(e,t){var n=e.alternateSuggestionsState,s=n.isOpen,r=n.numStrikes;return st(Ke(Ke({},e),{alternateSuggestionsState:Ke(Ke({},n),{selectedIndex:t.index})}),s,r)},Be);function nt(e,t){var n=t.isOpen,s=t.suggestionsToggledReason;if(e.alternateSuggestionsState.isOpen!==n){var r={eventName:"Suggestions Menu Opened or Closed",eventDescription:"The suggestions menu was opened or closed.",suggestionsToggledReason:s};return st(e,n,e.alternateSuggestionsState.numStrikes,r)}return e}function st(e,t,n,s){var r=e.allMessagesByID,a=e.languagePack,i=e.botMessageState,o=e.alternateSuggestionsState,u=i.messageIDs,l=o.config,d=o.selectedIndex,g=l.contact_option,p=Qe.a.NEVER,h=function(e){var t=e.allMessagesByID,n=e.botMessageState.messageIDs,s=!1,r=Object(m.e)(n,(function(e){var n,r=t[e].originalMessage;return Object(H.q)(r)&&(s=!0),s&&Object(H.p)(r)&&!(null===(n=r.history)||void 0===n?void 0:n.isSuggestion)}));if(-1!==r){var a=t[n[r]].originalMessage;for(r++;r<n.length;r++){var i=t[n[r]].originalMessage;if(Object(H.q)(i)&&i.request===a)return i}}return null}(e),f=e.pendingLogs.autoLearning,v=function(e){var t,n,s,r=[];if(null===(t=e)||void 0===t?void 0:t.output.alternate_responses){var a,i=e.thread_id===q.b||(null===(n=e.request)||void 0===n?void 0:n.thread_id)===q.b,o="fallback"===(null===(s=e.output.debug)||void 0===s?void 0:s.branch_exited_reason);if(i||o)c()(a=e.output.alternate_responses).call(a,(function(e){var t;e.suggestions&&c()(t=e.suggestions).call(t,(function(e){var t,n,s;(null===(s=null===(n=null===(t=e.value)||void 0===t?void 0:t.input)||void 0===n?void 0:n.intents)||void 0===s?void 0:s.length)&&r.push({isContactSuggestion:!1,isSelected:!1,option:e})}))}))}return r}(h)||[];s&&(s.suggestionsNumAlternateResponses=v.length,s.suggestionsNumStrikes=n);var S=function(e,t,n){var s,r;if(n)return!0;var a=e.allMessagesByID,i=e.agentState,o=e.botMessageState,c=e.alternateSuggestionsState,u=o.messageIDs,l=c.config.contact_option,d=Qe.a.NEVER,g=Qe.a.ONE_STRIKE;if(l===d||l===g&&0===t)return!1;if(i.isConnecting||i.isConnected)return!1;var p=null===(r=a[Object(m.a)(u)])||void 0===r?void 0:r.originalMessage;return!Object(H.q)(p)||!Je()(s=p.output.generic).call(s,(function(e){return e.response_type===Xe.b.CONNECT_TO_AGENT}))}(e,n,d===v.length),b=S?et-1:et;v.length>b&&(v.length=b),s&&(s.suggestionsConnectToAgentAvailable=S),S&&v.push(Object(Ze.b)(Object(Ze.c)(l,a))),v[d]&&(v[d].isSelected=!0);var y=void 0!==Je()(v).call(v,(function(e){return!e.isSelected}));s&&(s.suggestionsNumAvailable=v.length);var O,w,M=t&&y;if(n!==o.numStrikes&&(1===n||2===n||n>0&&g===p)&&(M=!0,!o.isOpen&&s&&(s.suggestionsToggledReason="Strike")),y&&Object(H.h)(u,r))if(M)O=!0;else{var E=r[Object(m.a)(u)];O=!E||!Object(H.l)(E)||e.alternateSuggestionsState.showButton}else O=!1,M=!1;if(O&&O!==e.alternateSuggestionsState.showButton&&(w={messageID:"suggestions_ariaAnnounceButtonShow"}),M!==e.alternateSuggestionsState.isOpen)if(s&&(s.suggestionsMenuIsOpened=M?"Opened":"Closed"),M){if(w={messageID:"suggestions_ariaAnnounceListOpen",messageValues:{count:v.length}},n>o.numStrikes){var I=Object(H.a)({message_type:"more_options_event",event:"automatic"});f=$e(f,[I])}}else w={messageID:"suggestions_ariaAnnounceListClosed"};var T=s?$e(e.pendingLogs.trackEvents,[s]):e.pendingLogs.trackEvents;return Ke(Ke({},e),{announceMessage:w||e.announceMessage,alternateSuggestionsState:Ke(Ke({},e.alternateSuggestionsState),{suggestionListItems:v,sourceResponse:h,isOpen:M,showButton:O,numStrikes:n}),pendingLogs:Ke(Ke({},e.pendingLogs),{autoLearning:f,trackEvents:T})})}var rt,at=function(){return(at=_.a||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},it=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var s=Array(e),r=0;for(t=0;t<n;t++)for(var a=arguments[t],i=0,o=a.length;i<o;i++,r++)s[r]=a[i];return s},ot=((rt={})[be.i]=function(e,t){return at(at({},e),{isHydrated:!0,config:at(at({},e.config),{remote:at(at({},e.config.remote),{mainConfig:t.mainConfig})})})},rt[be.n]=function(e){var t=at(at(at(at({},e),{agentState:at({},W.a)}),W.d),{isHydrated:!1,persistedToBrowserStorage:at(at({},W.e),{isOpen:e.persistedToBrowserStorage.isOpen})});return t.homeScreenConfig.is_on&&(t=Object(W.m)(t)),function(e){return e.alternateSuggestionsState.config.is_on?st(e,!1,0,null):e}(t)},rt[be.j]=function(e,t){var n=t.history,s=n.allMessagesByID,r=n.agentMessageState,a=n.botMessageState,i=n.processesByID;return function(e){return st(Ke(Ke({},e),{alternateSuggestionsState:W.b}),W.b.isOpen,W.b.numStrikes)}(at(at({},e),{allMessagesByID:s,botMessageState:a,agentMessageState:r,processesByID:i}))},rt[be.b]=function(e,t){var n,s=t.id,r=t.message,a=e;return r.originalMessage.history.silent||(a=at(at({},e),{allMessagesByID:at(at({},e.allMessagesByID),(n={},n[s]=r,n)),botMessageState:at(at({},e.botMessageState),{messageIDs:it(e.botMessageState.messageIDs,[s])}),agentState:at(at({},e.agentState),{hasSentMessageSinceConnecting:!0})}),e.persistedToBrowserStorage.homeScreenState.isHomeScreenOpen&&(a=Object(W.k)(a)),a=function(e,t){var n,s=t.message,r=e.alternateSuggestionsState,a=r.isOpen,i=r.config,o=r.numStrikes,c=r.selectedIndex;if(!i.is_on)return e;var u=s.originalMessage;if(!s.ui_state.isLatestWelcomeNode&&Object(H.q)(u)&&function(e,t){var n=e.allMessagesByID,s=e.botMessageState.messageIDs,r=n[s[s.length-2]];return!r||r.originalMessage!==t.originalMessage}(e,s)){var l=o,d={eventName:"Assistant Message Sent to User with Suggestions",eventDescription:"A message was received by the user from the bot with suggestions enabled."};return Object(Ze.d)(u,e,d)?l++:l=0,st(e,a,l,d)}if(Object(H.l)(s)){var g=(null===(n=s.originalMessage.history)||void 0===n?void 0:n.isSuggestion)?c:-1;return st(Ke(Ke({},e),{alternateSuggestionsState:Ke(Ke({},e.alternateSuggestionsState),{selectedIndex:g})}),!1,o)}return e}(a,t)),a},rt[be.E]=function(e,t){var n,s=t.id,r=t.message;return at(at({},e),{allMessagesByID:at(at({},e.allMessagesByID),(n={},n[s]=r,n))})},rt[be.c]=function(e,t){var n=t.message,s=t.chatType,r=Object(W.l)(e,s).originalMessages,a=it(r,[n]);return Object(W.g)(e,s,{originalMessages:a})},rt[be.l]=function(e,t){var n=at({},e.allMessagesByID);return n[t.messageID]=at(at({},e.allMessagesByID[t.messageID]),{ui_state:at(at({},e.allMessagesByID[t.messageID].ui_state),{optionSelected:t.sentMessage})}),at(at({},e),{allMessagesByID:n})},rt[be.r]=function(e,t){return at(at({},e),{botMessageState:at(at({},e.botMessageState),{isTypingCounter:e.botMessageState.isTypingCounter+t.addToIsTyping})})},rt[be.q]=function(e,t){var n;return at(at({},e),((n={})[t.key]=t.value,n))},rt[be.v]=function(e,t){var n;return at(at({},e),{persistedToBrowserStorage:at(at({},e.persistedToBrowserStorage),(n={},n[t.key]=t.value,n))})},rt[be.w]=function(e,t){var n=e.agentState;return t.isOpen&&n.isPanelOpen&&0!==n.numUnreadMessages&&(n=at(at({},n),{lastUnreadMessage:null,numUnreadMessages:0})),at(at({},e),{announceMessage:Object(W.j)(e,t.isOpen),agentState:n,persistedToBrowserStorage:at(at({},e.persistedToBrowserStorage),{isOpen:t.isOpen})})},rt[be.D]=function(e,t){return at(at({},e),{languagePack:xe()({},e.languagePack,t.languagePack)})},rt[be.A]=function(e,t){return at(at({},e),{botName:t.name})},rt[be.z]=function(e,t){return at(at({},e),{botAvatarURL:t.url})},rt[be.B]=function(e,t){var n=e.config,s=t.publicVars,r=t.remoteStyles,a=t.variables,i={public:at(at({},n.public),{__ibm__:at(at({},n.public.__ibm__),{cssVariables:s})}),remote:at(at({},n.remote),{initConfig:at(at({},n.remote.initConfig),{css_variables:r})})};return at(at({},e),{config:i,cssVariables:a})},rt[be.C]=function(e,t){return at(at({},e),{homeScreenConfig:t.homeScreenConfig})},rt[be.m]=function(e,t){var n,s=at({},e.processesByID);if(s[t.processID].processStatus===F.a.PROCESS_NOT_STARTED){var r;c()(r=N()(s)).call(r,(function(e){var t=e[0],n=e[1];n.processStatus===F.a.PROCESS_ONGOING&&(s[t]=at(at({},n),{processStatus:F.a.PROCESS_CANCELLED}))})),s=at(at({},s),((n={})[t.processID]=at(at({},s[t.processID]),{processStatus:F.a.PROCESS_ONGOING}),n))}return at(at({},e),{announceMessage:Object(W.i)(e,!0,!1),processesByID:s,persistedToBrowserStorage:at(at({},e.persistedToBrowserStorage),{processState:at(at({},e.persistedToBrowserStorage.processState),{isProcessPanelOpen:!0,currentViewedProcessId:t.processID})})})},rt[be.g]=function(e){return at(at({},e),{announceMessage:Object(W.i)(e,!1,e.persistedToBrowserStorage.processState.currentOngoingProcessId===e.persistedToBrowserStorage.processState.currentViewedProcessId),persistedToBrowserStorage:at(at({},e.persistedToBrowserStorage),{processState:at(at({},e.persistedToBrowserStorage.processState),{isProcessPanelOpen:!1,currentViewedProcessId:null})})})},rt[be.s]=function(e,t){var n=e.processesByID[t.processID],s=n?n.processStatus:null,r=e.persistedToBrowserStorage.processState.currentOngoingProcessId;return s!==F.a.PROCESS_NOT_STARTED&&s!==F.a.PROCESS_ONGOING||(r=t.processID),at(at({},e),{persistedToBrowserStorage:at(at({},e.persistedToBrowserStorage),{processState:at(at({},e.persistedToBrowserStorage.processState),{currentOngoingProcessId:r,currentViewedProcessId:t.processID})})})},rt[be.f]=function(e,t){var n=at({},e.processesByID);return n[t.processID]=at({},n[t.processID]),n[t.processID].processStatus=F.a.PROCESS_CANCELLED,at(at({},e),{processesByID:n,persistedToBrowserStorage:at(at({},e.persistedToBrowserStorage),{processState:at(at({},e.persistedToBrowserStorage.processState),{isProcessPanelOpen:!1,currentOngoingProcessId:null,currentViewedProcessId:null})})})},rt[be.d]=function(e,t){var n,s=t.threadID,r=at({},e.processesByID),a=at({},r[s]),i=t.message;a=at(at({},a),{messageIDs:it(a.messageIDs,[i.ui_state.id])}),r[s]=a;var o=e.persistedToBrowserStorage.processState.currentOngoingProcessId;return e.persistedToBrowserStorage.processState.currentOngoingProcessId&&a.processStatus===F.a.PROCESS_NOT_STARTED||(o=s),at(at({},e),{allMessagesByID:at(at({},e.allMessagesByID),(n={},n[i.ui_state.id]=i,n)),processesByID:r,persistedToBrowserStorage:at(at({},e.persistedToBrowserStorage),{processState:at(at({},e.persistedToBrowserStorage.processState),{currentOngoingProcessId:o}),homeScreenState:at(at({},e.persistedToBrowserStorage.homeScreenState),{isHomeScreenOpen:!1})})})},rt[be.F]=function(e,t){var n,s=t.message;return at(at({},e),{allMessagesByID:at(at({},e.allMessagesByID),(n={},n[s.ui_state.id]=s,n))})},rt[be.k]=function(e,t){var n=at({},e.processesByID);return n[t.processID]=at(at({},W.c),{processStatus:F.a.PROCESS_NOT_STARTED,processTitle:t.processTitle}),at(at({},e),{processesByID:n})},rt[be.h]=function(e,t){var n=at({},e.processesByID),s=at({},n[t.processID]);return s.processStatus=F.a.PROCESS_COMPLETED,n[t.processID]=s,at(at({},e),{processesByID:n,persistedToBrowserStorage:at(at({},e.persistedToBrowserStorage),{processState:at(at({},e.persistedToBrowserStorage.processState),{currentOngoingProcessId:null})})})},rt[be.u]=function(e,t){var n,s,r=t.messageID,a=t.propertyName,i=t.propertyValue,o=e.allMessagesByID[r];return o?at(at({},e),{allMessagesByID:at(at({},e.allMessagesByID),(n={},n[r]=at(at({},o),{ui_state:at(at({},o.ui_state),(s={},s[a]=i,s))}),n))}):e},rt[be.e]=function(e,t){return at(at({},e),{announceMessage:t.message})},rt[be.t]=function(e,t){var n=t.isScrollAnchored,s=t.chatType;return function(e,t,n){if(!e.alternateSuggestionsState.config.is_on)return e;var s=n.isScrollAnchored,r=n.chatType,a=n.fromAutoScroll;return r===V.a.BOT&&!s&&t&&e.alternateSuggestionsState.isOpen&&!a?nt(e,{isOpen:!1,suggestionsToggledReason:"Event"}):e}(Object(W.g)(e,s,{isScrollAnchored:n}),e.botMessageState.isScrollAnchored,t)},rt[be.a]=function(e){var t;return at(at({},e),{persistedToBrowserStorage:at(at({},e.persistedToBrowserStorage),{disclaimersAccepted:at(at({},e.persistedToBrowserStorage.disclaimersAccepted),(t={},t[window.location.hostname]=!0,t))})})},rt);_()(ot,Ye,tt);var ct=function(){return(ct=_.a||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function ut(e,t){return t&&ot[t.type]?ot[t.type](e,t):e}var lt=n(378);function dt(e,t){var n,s=new Pe,a=Object(ne.j)(e.public),i=r()(a).call(a,"?")>-1?a+"&version=2020-09-24":a+"?version=2020-09-24",o=function(e){var t,n={};return(null===(t=e.public.__ibm__)||void 0===t?void 0:t.enableFeatures)&&(n=R(R({},n),B()(e.public.__ibm__.enableFeatures))),n}(e);return s.actions=new I.a(s),s.store=function(e,t,n){var s,r,a,i,o,c,u,l=e.remote.initConfig,d=ct(ct({},W.d),{agentState:ct({},W.a),botName:(null===(s=e.public.__ibm__)||void 0===s?void 0:s.botNameOverride)||l.botName||"Watson Assistant",botAvatarURL:(null===(r=e.public.__ibm__)||void 0===r?void 0:r.botAvatarURLOverride)||l.botAvatarURL||null,cssVariables:Object(qe.c)(null===(a=e.public.__ibm__)||void 0===a?void 0:a.cssVariables,l.css_variables,e.public.carbonTheme),isHydrated:!1,languagePack:Ge.a,locale:"en",config:e,accountOwnerDomain:l.accountOwnerDomain||l.account_owner_domain||"",userID:null,identityToken:e.public.identityToken||null,sentMessagePercentage:0,showWelcomeError:null,alternateSuggestionsState:xe()({},W.b,{config:l.alternate_suggestions}),suspendScrollDetection:!1,homeScreenConfig:Object(Ue.b)(null===(i=e.public.__ibm__)||void 0===i?void 0:i.homeScreenConfig,l.home_screen),persistedToBrowserStorage:ct(ct({},W.e),{isOpen:e.public.openChatByDefault,homeScreenState:ct(ct({},W.e.homeScreenState),{isHomeScreenOpen:(null===(c=null===(o=e.public.__ibm__)||void 0===o?void 0:o.homeScreenConfig)||void 0===c?void 0:c.is_on)||(null===(u=l.home_screen)||void 0===u?void 0:u.is_on)})}),pendingLogs:{trackEvents:[],autoLearning:[]},featureSet:n}),g=e.public.debug?window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__({name:"WebChat",instanceId:"WebChat-"+t}):void 0;return Object(Le.createStore)(ut,d,g)}(e,t,o),s.eventBus=new E,s.trackService=new ke.b(s),s.historyService=new ce(s),s.messageService=new Re(s,i),s.progressBarService=new Ae,s.store.subscribe(Object(lt.b)(s)),s.store.subscribe(Object(lt.d)(s)),s.writeableElements=((n={})[V.f.WELCOME_NODE_BEFORE_ELEMENT]=document.createElement("div"),n[V.f.HEADER_BOTTOM_ELEMENT]=document.createElement("div"),n[V.f.BEFORE_INPUT_ELEMENT]=document.createElement("div"),n[V.f.HOME_SCREEN_AFTER_STARTERS_ELEMENT]=document.createElement("div"),n),e.public.debug&&(s.eventBus.on({type:y.a.ALL_EVENTS,handler:gt}),Object(O.f)(!0)),Object(ne.e)(s,e.public),s}function gt(e){Object(O.d)("[Debug]",e)}n.d(t,"createServiceManager",(function(){return dt})),Object(O.a)(dt)}}]);